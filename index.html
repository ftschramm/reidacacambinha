<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="theme-color" content="#22c55e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUmVpIGRhIENhw6dhbWJpbmhhIC0gU2lzdGVtYSBkZSBHZXN0w6NvIiwic2hvcnRfbmFtZSI6IlJlaSBkYSBDYcOnYW1iaW5oYSIsImRlc2NyaXB0aW9uIjoiU2lzdGVtYSBkZSBnZXN0w6NvIHBhcmEgdHJhbnNwb3J0ZSBkZSBtaW7DqXJpb3MiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzIyYzU1ZSIsInRoZW1lX2NvbG9yIjoiIzIyYzU1ZSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhNakFpSUdobGFXZG9kRDBpTVRJd0lpQjJhV1YzUW05NFBTSXdJREFnTVRJd0lERXlNQ0krUEhCaGRHZ2dZMnhoYzNNOUltRndhV2x2YmlJZ1pEMGlUVFl3SURGV05EaGhOUzQxTFRVdU5TMHhNaTQwTFRFeUxqUWdNalF3ZEROd2NIQnNJRGh0T0MweElHZ3lNSGd5TkhZeU1HZ3lNSGcxTW5NeU5DNHhJREl6TGprZ05UQWdORGcxYnkwME9TNDBMVGs1THpGak5pNDBMVEl1TlNBeE1pNDBMVGt1TVNBeU5DMDJORFV6VmpRNFdpSWdhV3d5ZkdoaUlpQm1hV3hzUFNJaU1qSmpOVFZsSWlBK1BDOXdZWFJvUGp3dmMzWm5QZz09IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjEyMHgxMjAifV19">
    <title>Rei da Ca√ßambinha - Sistema de Gest√£o</title>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('data:application/javascript;base64,' + btoa(`
                    const CACHE_NAME = 'rei-cacambinha-v1.0';
                    const urlsToCache = [
                        '/',
                        'https://cdn.tailwindcss.com',
                        'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js',
                        'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js',
                        'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js'
                    ];

                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });

                    self.addEventListener('sync', function(event) {
                        if (event.tag === 'background-sync') {
                            event.waitUntil(syncOfflineData());
                        }
                    });

                    async function syncOfflineData() {
                        // Sincronizar dados offline quando voltar online
                        const offlineData = await getOfflineData();
                        if (offlineData.length > 0) {
                            for (const item of offlineData) {
                                try {
                                    await syncToFirebase(item);
                                    await removeFromOfflineQueue(item.id);
                                } catch (error) {
                                    console.error('Erro ao sincronizar:', error);
                                }
                            }
                        }
                    }
                `))
                .then(function(registration) {
                    console.log('Service Worker registrado com sucesso:', registration.scope);
                }, function(err) {
                    console.log('Falha ao registrar Service Worker:', err);
                });
            });
        }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, push, update, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Configura√ß√£o do Firebase (substitua pela sua configura√ß√£o)
        const firebaseConfig = {
  apiKey: "AIzaSyBMnDtw3oILvCe9YgMtiRjkP4T3BoGMXsU",
  authDomain: "rei-da-cacambinha-9d0d2.firebaseapp.com",
  projectId: "rei-da-cacambinha-9d0d2",
  storageBucket: "rei-da-cacambinha-9d0d2.firebasestorage.app",
  messagingSenderId: "487675625239",
  appId: "1:487675625239:web:5668a8889385ec1b15c152",
  measurementId: "G-TJEVMJK4VC"
};

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);
        
        // Tornar dispon√≠vel globalmente
        window.firebaseDB = database;
        window.firebaseAuth = auth;
        window.firebaseRefs = { ref, set, get, onValue, push, update, remove };
        window.firebaseAuthFunctions = { signInAnonymously, onAuthStateChanged };
        
        // Sistema Offline - IndexedDB
        class OfflineManager {
            constructor() {
                this.db = null;
                this.isOnline = navigator.onLine;
                this.syncQueue = [];
                this.init();
            }
            
            async init() {
                await this.initIndexedDB();
                this.setupNetworkListeners();
                this.setupBackgroundSync();
                
                // Auto-sync quando voltar online
                if (this.isOnline) {
                    await this.syncOfflineData();
                }
            }
            
            async initIndexedDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('ReiCacambinhaDB', 1);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Store para vendas offline
                        if (!db.objectStoreNames.contains('vendas_offline')) {
                            const vendasStore = db.createObjectStore('vendas_offline', { keyPath: 'id' });
                            vendasStore.createIndex('timestamp', 'timestamp', { unique: false });
                            vendasStore.createIndex('synced', 'synced', { unique: false });
                        }
                        
                        // Store para clientes offline
                        if (!db.objectStoreNames.contains('clientes_offline')) {
                            const clientesStore = db.createObjectStore('clientes_offline', { keyPath: 'id' });
                            clientesStore.createIndex('synced', 'synced', { unique: false });
                        }
                        
                        // Store para materiais offline
                        if (!db.objectStoreNames.contains('materiais_offline')) {
                            const materiaisStore = db.createObjectStore('materiais_offline', { keyPath: 'id' });
                            materiaisStore.createIndex('synced', 'synced', { unique: false });
                        }
                        
                        // Store para sync queue
                        if (!db.objectStoreNames.contains('sync_queue')) {
                            const syncStore = db.createObjectStore('sync_queue', { keyPath: 'id' });
                            syncStore.createIndex('type', 'type', { unique: false });
                            syncStore.createIndex('timestamp', 'timestamp', { unique: false });
                        }
                    };
                });
            }
            
            setupNetworkListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.showNetworkStatus('üü¢ Online - Sincronizando dados...', 'success');
                    setTimeout(() => this.syncOfflineData(), 1000);
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.showNetworkStatus('üî¥ Offline - Dados salvos localmente', 'warning');
                });
            }
            
            setupBackgroundSync() {
                if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
                    navigator.serviceWorker.ready.then(registration => {
                        window.backgroundSyncRegistration = registration;
                    });
                }
            }
            
            showNetworkStatus(message, type = 'info') {
                const statusDiv = document.createElement('div');
                statusDiv.className = \`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 \${
                    type === 'success' ? 'bg-green-500 text-white' :
                    type === 'warning' ? 'bg-yellow-500 text-white' :
                    'bg-blue-500 text-white'
                }\`;
                statusDiv.textContent = message;
                document.body.appendChild(statusDiv);
                
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    setTimeout(() => statusDiv.remove(), 300);
                }, 3000);
            }
            
            async saveOffline(storeName, data) {
                if (!this.db) await this.init();
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    
                    data.synced = false;
                    data.offline_timestamp = Date.now();
                    
                    const request = store.put(data);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async getOfflineData(storeName, filter = null) {
                if (!this.db) await this.init();
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.getAll();
                    
                    request.onsuccess = () => {
                        let result = request.result;
                        if (filter) {
                            result = result.filter(filter);
                        }
                        resolve(result);
                    };
                    request.onerror = () => reject(request.error);
                });
            }
            
            async addToSyncQueue(type, data, action = 'create') {
                const queueItem = {
                    id: \`\${type}_\${Date.now()}_\${Math.random().toString(36).substr(2, 9)}\`,
                    type,
                    action,
                    data,
                    timestamp: Date.now(),
                    retries: 0
                };
                
                await this.saveOffline('sync_queue', queueItem);
                
                // Tentar sync imediato se online
                if (this.isOnline) {
                    setTimeout(() => this.syncOfflineData(), 500);
                }
                
                return queueItem.id;
            }
            
            async syncOfflineData() {
                if (!this.isOnline) return;
                
                try {
                    const syncQueue = await this.getOfflineData('sync_queue');
                    let syncedCount = 0;
                    
                    for (const item of syncQueue) {
                        try {
                            await this.syncSingleItem(item);
                            await this.removeFromStore('sync_queue', item.id);
                            syncedCount++;
                        } catch (error) {
                            console.error('Erro ao sincronizar item:', error);
                            // Incrementar tentativas
                            item.retries = (item.retries || 0) + 1;
                            if (item.retries < 3) {
                                await this.saveOffline('sync_queue', item);
                            } else {
                                // Remover ap√≥s 3 tentativas
                                await this.removeFromStore('sync_queue', item.id);
                            }
                        }
                    }
                    
                    if (syncedCount > 0) {
                        this.showNetworkStatus(\`‚úÖ \${syncedCount} itens sincronizados!\`, 'success');
                        // Recarregar dados
                        if (window.carregarDados) {
                            window.carregarDados();
                        }
                    }
                } catch (error) {
                    console.error('Erro na sincroniza√ß√£o:', error);
                }
            }
            
            async syncSingleItem(item) {
                const { ref, set, push, update, remove } = window.firebaseRefs;
                const db = window.firebaseDB;
                
                switch (item.action) {
                    case 'create':
                        if (item.type === 'vendas') {
                            await push(ref(db, 'vendas'), item.data);
                        } else if (item.type === 'clientes') {
                            await push(ref(db, 'clientes'), item.data);
                        } else if (item.type === 'materiais') {
                            await push(ref(db, 'materiais'), item.data);
                        } else if (item.type === 'despesas') {
                            await push(ref(db, 'despesas'), item.data);
                        }
                        break;
                        
                    case 'update':
                        await update(ref(db, \`\${item.type}/\${item.data.id}\`), item.data);
                        break;
                        
                    case 'delete':
                        await remove(ref(db, \`\${item.type}/\${item.data.id}\`));
                        break;
                }
            }
            
            async removeFromStore(storeName, id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.delete(id);
                    
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }
            
            // M√©todos p√∫blicos para usar no app
            async saveVendaOffline(venda) {
                await this.addToSyncQueue('vendas', venda, 'create');
                this.showNetworkStatus('üíæ Venda salva offline', 'info');
            }
            
            async saveClienteOffline(cliente) {
                await this.addToSyncQueue('clientes', cliente, 'create');
                this.showNetworkStatus('üíæ Cliente salvo offline', 'info');
            }
            
            async saveMaterialOffline(material) {
                await this.addToSyncQueue('materiais', material, 'create');
                this.showNetworkStatus('üíæ Material salvo offline', 'info');
            }
            
            async saveDespesaOffline(despesa) {
                await this.addToSyncQueue('despesas', despesa, 'create');
                this.showNetworkStatus('üíæ Despesa salva offline', 'info');
            }
            
            getNetworkStatus() {
                return {
                    isOnline: this.isOnline,
                    statusText: this.isOnline ? 'Online' : 'Offline',
                    statusIcon: this.isOnline ? 'üü¢' : 'üî¥'
                };
            }
        }
        
        // Inicializar sistema offline
        window.offlineManager = new OfflineManager();
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'empresa-verde': '#22c55e',
                        'empresa-amarelo': '#eab308',
                        'empresa-azul': '#3b82f6',
                        'empresa-verde-dark': '#16a34a',
                        'empresa-amarelo-dark': '#ca8a04',
                        'empresa-azul-dark': '#2563eb'
                    }
                }
            }
        }
    </script>
    <style>
        .payment-option input[type="radio"]:checked + div {
            background-color: #a855f7 !important;
            color: white !important;
            border-color: #7c3aed !important;
            transform: scale(1.05);
        }
        
        .animate-pulse-custom {
            animation: pulse-custom 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse-custom {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: .8;
                transform: scale(1.02);
            }
        }
        
        #modal-venda-rapida {
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Estilos dos Alertas */
        #modal-alerta {
            animation: alertaSlideIn 0.4s ease-out;
        }
        
        @keyframes alertaSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }
        
        /* Responsividade para alertas */
        @media (max-width: 640px) {
            #modal-alerta {
                top: 1rem;
                right: 1rem;
                left: 1rem;
                max-width: none;
                width: auto;
            }
            
            @keyframes alertaSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(-100%) scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }
        }
        
        .toast {
            animation: toastSlideIn 0.3s ease-out;
            max-width: 400px;
        }
        
        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .toast-warning {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }
        
        .toast-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .toast-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .alerta-criticidade-alta {
            animation: alertaGiradaRapida 1s ease-in-out;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }
        
        .alerta-girada-entrada {
            animation: alertaGiradaEntrada 1s ease-in-out;
        }
        
        @keyframes alertaGiradaRapida {
            0% {
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
            }
            25% {
                transform: scale(1.05) rotate(90deg);
                box-shadow: 0 0 30px rgba(239, 68, 68, 0.8);
            }
            50% {
                transform: scale(1.02) rotate(180deg);
                box-shadow: 0 0 25px rgba(239, 68, 68, 0.6);
            }
            75% {
                transform: scale(1.05) rotate(270deg);
                box-shadow: 0 0 30px rgba(239, 68, 68, 0.8);
            }
            100% {
                transform: scale(1) rotate(360deg);
                box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
            }
        }
        
        @keyframes alertaGiradaEntrada {
            0% {
                transform: scale(1) rotate(0deg);
            }
            25% {
                transform: scale(1.03) rotate(90deg);
            }
            50% {
                transform: scale(1.01) rotate(180deg);
            }
            75% {
                transform: scale(1.03) rotate(270deg);
            }
            100% {
                transform: scale(1) rotate(360deg);
            }
        }
        
        .checkbox-custom {
            appearance: none;
            background-color: #fff;
            border: 2px solid #d1d5db;
            padding: 0;
            width: 1rem;
            height: 1rem;
            border-radius: 0.25rem;
            display: inline-block;
            position: relative;
        }
        
        .checkbox-custom:checked {
            background-color: #22c55e;
            border-color: #22c55e;
        }
        
        .checkbox-custom:checked::before {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-4 sm:py-6">
        <!-- Cabe√ßalho -->
        <header class="bg-white shadow-sm rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-empresa-verde">üöõ REI DA CA√áAMBINHA 2.0</h1>
            <p class="text-empresa-azul text-sm sm:text-base mt-1 sm:mt-2 font-medium">Sistema de Gest√£o - Transporte de Min√©rios</p>
        </header>

        <!-- Menu de Navega√ß√£o -->
        <nav class="bg-white shadow-sm rounded-lg p-3 sm:p-4 mb-4 sm:mb-6">
            <!-- Menu Desktop -->
            <div class="hidden lg:flex flex-wrap gap-2">
                <button id="btn-dashboard" class="btn-nav bg-empresa-azul text-white px-4 py-2 rounded text-sm font-medium">Dashboard</button>
                <button id="btn-minerios" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-verde hover:text-white">Min√©rios</button>
                <button id="btn-clientes" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-verde hover:text-white">Clientes</button>
                <button id="btn-vendas" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-amarelo hover:text-white">Vendas</button>
                <button id="btn-veiculos" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-azul hover:text-white">Ve√≠culos</button>
                <button id="btn-motoristas" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-verde hover:text-white">Motoristas</button>
                <button id="btn-estoque" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-amarelo hover:text-white">Estoque</button>
                <button id="btn-despesas" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-red-500 hover:text-white">Despesas</button>
                <button id="btn-cobranca" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-amarelo hover:text-white">Cobran√ßa</button>
                <button id="btn-relatorios" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-azul hover:text-white">Relat√≥rios</button>
                <button id="btn-previsao" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-purple-500 hover:text-white">üìà Previs√£o</button>
                <button id="btn-config" class="btn-nav bg-gray-100 text-gray-700 px-4 py-2 rounded text-sm font-medium hover:bg-empresa-verde hover:text-white">Config</button>
            </div>
            
            <!-- Menu Mobile/Tablet -->
            <div class="lg:hidden">
                <select id="mobile-nav" class="w-full p-3 border border-gray-300 rounded-lg text-sm font-medium bg-white focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                    <option value="dashboard">üìä Dashboard</option>
                    <option value="minerios">‚õèÔ∏è Min√©rios</option>
                    <option value="clientes">üë• Clientes</option>
                    <option value="vendas">üí∞ Vendas</option>
                    <option value="veiculos">üöõ Ve√≠culos</option>
                    <option value="motoristas">üë®‚Äçüíº Motoristas</option>
                    <option value="estoque">üì¶ Estoque</option>
                    <option value="despesas">üí∏ Despesas</option>
                    <option value="cobranca">üìã Cobran√ßa</option>
                    <option value="relatorios">üìä Relat√≥rios</option>
                    <option value="previsao">üìà Previs√£o de Demanda</option>
                    <option value="config">‚öôÔ∏è Config</option>
                </select>
            </div>
        </nav>

        <!-- √Årea de Conte√∫do -->
        <main class="bg-white shadow-sm rounded-lg p-4 sm:p-6">
            <div id="dashboard-content" class="content-section">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-empresa-verde">üìä Dashboard Executivo</h2>
                    <div class="text-sm text-gray-500">
                        <span id="data-atual"></span> ‚Ä¢ <span id="hora-atual"></span>
                    </div>
                </div>

                <!-- Configura√ß√£o R√°pida do Dia -->
                <div class="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-xl border-2 border-empresa-azul mb-6">
                    <h3 class="text-lg font-bold text-empresa-azul mb-4">üöÄ Configura√ß√£o R√°pida do Dia</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üöõ Ve√≠culo Padr√£o</label>
                            <select id="veiculo-padrao-dia" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                                <option value="">Selecione o ve√≠culo padr√£o</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üë®‚Äçüíº Motorista Padr√£o</label>
                            <select id="motorista-padrao-dia" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                                <option value="">Selecione o motorista padr√£o</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button id="btn-salvar-padrao" class="bg-empresa-azul text-white px-4 py-2 rounded-lg font-medium hover:bg-empresa-azul-dark">
                            üíæ Salvar Configura√ß√£o
                        </button>
                        <button id="btn-limpar-padrao" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-600">
                            üóëÔ∏è Limpar
                        </button>
                    </div>
                </div>

                <!-- Performance Financeira -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-lg font-bold text-empresa-verde mb-4">üí∞ Performance Financeira</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <div class="text-sm text-green-700 font-medium">Receita Total</div>
                                <div id="receita-total" class="text-2xl font-bold text-green-600">R$ 0,00</div>
                                <div id="variacao-receita" class="text-xs text-green-500">üìà +0%</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg text-center">
                                <div class="text-sm text-red-700 font-medium">Custos Totais</div>
                                <div id="custos-totais" class="text-2xl font-bold text-red-600">R$ 0,00</div>
                                <div id="variacao-custos" class="text-xs text-red-500">üìä 0%</div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <div class="text-sm text-blue-700 font-medium">Lucro L√≠quido</div>
                                <div id="lucro-liquido" class="text-2xl font-bold text-blue-600">R$ 0,00</div>
                                <div id="margem-lucro" class="text-xs text-blue-500">üìä 0% margem</div>
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <div class="text-sm text-gray-600">üí≥ Recebido Hoje</div>
                                <div id="recebido-hoje" class="text-lg font-bold text-gray-800">R$ 0,00</div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <div class="text-sm text-gray-600">‚è∞ A Receber</div>
                                <div id="a-receber" class="text-lg font-bold text-gray-800">R$ 0,00</div>
                            </div>
                        </div>
                    </div>

                    <!-- A√ß√µes R√°pidas -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-lg font-bold text-empresa-amarelo mb-4">‚ö° A√ß√µes R√°pidas</h3>
                        <div class="space-y-3">
                            <button id="btn-nova-venda-rapida" class="w-full bg-empresa-verde text-white p-3 rounded-lg font-medium hover:bg-empresa-verde-dark transition-colors transform hover:scale-105">
                                <div class="flex items-center justify-center gap-2">
                                    <span class="text-lg">üí∞</span>
                                    <div>
                                        <div class="font-bold">Nova Venda</div>
                                        <div class="text-xs opacity-90">Registro r√°pido</div>
                                    </div>
                                </div>
                            </button>
                            <button id="btn-adicionar-pagamento-rapido" class="w-full bg-empresa-azul text-white p-3 rounded-lg font-medium hover:bg-empresa-azul-dark transition-colors">
                                üí≥ Adicionar Pagamento
                            </button>
                            <button id="btn-adicionar-credito-rapido" class="w-full bg-empresa-amarelo text-white p-3 rounded-lg font-medium hover:bg-empresa-amarelo-dark transition-colors">
                                üì¶ Adicionar ao Estoque
                            </button>
                            <button id="btn-via-cliente-rapida" class="w-full bg-purple-500 text-white p-3 rounded-lg font-medium hover:bg-purple-600 transition-colors">
                                üìã Via do Cliente
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Resumo Operacional e Estoque -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Resumo Operacional -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-lg font-bold text-empresa-azul mb-4">üöö Resumo Operacional</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <div class="text-sm text-blue-700 font-medium">Cargas Hoje</div>
                                <div id="cargas-hoje" class="text-3xl font-bold text-blue-600">0</div>
                                <div class="text-xs text-blue-500">üöõ entregas</div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <div class="text-sm text-green-700 font-medium">Peso Total</div>
                                <div id="peso-total-hoje" class="text-3xl font-bold text-green-600">0t</div>
                                <div class="text-xs text-green-500">‚öñÔ∏è hoje</div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg text-center">
                                <div class="text-sm text-yellow-700 font-medium">Clientes Ativos</div>
                                <div id="clientes-ativos" class="text-2xl font-bold text-yellow-600">0</div>
                                <div class="text-xs text-yellow-500">üë• cadastrados</div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg text-center">
                                <div class="text-sm text-purple-700 font-medium">Frota Ativa</div>
                                <div id="frota-ativa" class="text-2xl font-bold text-purple-600">0</div>
                                <div class="text-xs text-purple-500">üöõ ve√≠culos</div>
                            </div>
                        </div>
                    </div>

                    <!-- Controle de Estoque -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-lg font-bold text-empresa-verde mb-4">üì¶ Controle de Estoque</h3>
                        <div class="space-y-4">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="text-sm text-green-700 font-medium">Estoque Total (R$)</div>
                                        <div id="estoque-total-valor" class="text-2xl font-bold text-green-600">R$ 0,00</div>
                                    </div>
                                    <div class="text-3xl">üí∞</div>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-3">
                                    <div>
                                        <div class="text-sm text-gray-700 font-medium">Estoque Material (Aprox.)</div>
                                        <div id="estoque-material-toneladas" class="text-xl font-bold text-gray-800">0 toneladas</div>
                                    </div>
                                    <div class="text-2xl">‚õèÔ∏è</div>
                                </div>
                                <select id="select-material-estoque" class="w-full p-2 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-empresa-verde">
                                    <option value="">Selecione um material</option>
                                </select>
                                <div id="info-material-estoque" class="text-xs text-gray-500 mt-1">Selecione um material para calcular</div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="bg-blue-50 p-3 rounded text-center">
                                    <div class="text-xs text-blue-600">Cr√©ditos</div>
                                    <div id="total-creditos-dash" class="text-sm font-bold text-blue-700">R$ 0,00</div>
                                </div>
                                <div class="bg-red-50 p-3 rounded text-center">
                                    <div class="text-xs text-red-600">D√©bitos</div>
                                    <div id="total-debitos-dash" class="text-sm font-bold text-red-700">R$ 0,00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alertas e Notifica√ß√µes -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h3 class="text-lg font-bold text-orange-600 mb-4">üö® Alertas e Notifica√ß√µes</h3>
                    <div id="alertas-dashboard" class="space-y-2">
                        <div class="bg-green-50 border border-green-200 p-3 rounded-lg">
                            <div class="text-sm text-green-700">‚úÖ Sistema operacional - Tudo funcionando perfeitamente</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de Venda R√°pida -->
            <div id="modal-venda-rapida" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                    <!-- Header do Modal -->
                    <div class="bg-gradient-to-r from-empresa-verde to-empresa-azul p-6 rounded-t-2xl">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                                    <span class="text-3xl">üí∞</span>
                                    Nova Venda R√°pida
                                </h2>
                                <p class="text-white/80 mt-1">Registre uma nova venda de forma r√°pida e intuitiva</p>
                            </div>
                            <button id="fechar-modal-venda" class="text-white/80 hover:text-white text-3xl transition-colors">
                                &times;
                            </button>
                        </div>
                    </div>

                    <!-- Conte√∫do do Modal -->
                    <div class="p-6">
                        <form id="form-venda-rapida" class="space-y-6">
                            <!-- Etapa 1: Sele√ß√µes B√°sicas -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Sele√ß√£o de Material -->
                                <div class="bg-yellow-50 p-4 rounded-xl border-2 border-yellow-200">
                                    <label class="block text-sm font-bold text-yellow-800 mb-3 flex items-center gap-2">
                                        <span class="text-lg">‚õèÔ∏è</span>
                                        Material
                                    </label>
                                    <select id="material-venda-modal" class="w-full p-3 border-2 border-yellow-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-colors" required>
                                        <option value="">Selecione o material</option>
                                    </select>
                                    <div id="info-material-modal" class="mt-2 text-xs text-yellow-700 bg-yellow-100 p-2 rounded hidden">
                                        <!-- Informa√ß√µes do material aparecer√£o aqui -->
                                    </div>
                                </div>

                                <!-- Sele√ß√£o de Cliente -->
                                <div class="bg-blue-50 p-4 rounded-xl border-2 border-blue-200">
                                    <label class="block text-sm font-bold text-blue-800 mb-3 flex items-center gap-2">
                                        <span class="text-lg">üë•</span>
                                        Cliente
                                    </label>
                                    <select id="cliente-venda-modal" class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" required>
                                        <option value="">Selecione o cliente</option>
                                    </select>
                                    <div id="info-cliente-modal" class="mt-2 text-xs text-blue-700 bg-blue-100 p-2 rounded hidden">
                                        <!-- Informa√ß√µes do cliente aparecer√£o aqui -->
                                    </div>
                                </div>
                            </div>

                            <!-- Etapa 2: Ve√≠culo e Motorista -->
                            <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                                <label class="block text-sm font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="text-lg">üöõ</span>
                                    Ve√≠culo e Motorista
                                </label>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <select id="veiculo-venda-modal" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition-colors" required>
                                        <option value="">Selecione o ve√≠culo</option>
                                    </select>
                                    <div id="info-motorista-modal" class="flex items-center justify-center bg-gray-100 p-3 rounded-lg border-2 border-gray-300">
                                        <span class="text-gray-500 text-sm">üë®‚Äçüíº Motorista ser√° selecionado automaticamente</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Etapa 3: Pesos -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Peso Pedreira -->
                                <div class="bg-blue-50 p-4 rounded-xl border-2 border-blue-200">
                                    <label class="block text-sm font-bold text-blue-800 mb-3 flex items-center gap-2">
                                        <span class="text-lg">‚öñÔ∏è</span>
                                        Peso Pedreira
                                    </label>
                                    <div class="relative">
                                        <input type="number" id="peso-pedreira-modal" class="w-full p-4 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-lg font-semibold" placeholder="0,0" step="0.1" min="0" required>
                                        <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-blue-600 font-medium">t</span>
                                    </div>
                                    <div id="info-peso-pedreira" class="mt-2 text-xs text-blue-700 space-y-1">
                                        <div>üì¶ Volume: <span id="volume-pedreira-modal">0,0 m¬≥</span></div>
                                        <div>üí∞ Custo: R$ <span id="custo-total-modal">0,00</span></div>
                                    </div>
                                </div>

                                <!-- Peso Cliente -->
                                <div class="bg-green-50 p-4 rounded-xl border-2 border-green-200">
                                    <label class="block text-sm font-bold text-green-800 mb-3 flex items-center gap-2">
                                        <span class="text-lg">‚öñÔ∏è</span>
                                        Peso Cliente
                                    </label>
                                    <div class="relative">
                                        <input type="number" id="peso-cliente-modal" class="w-full p-4 border-2 border-green-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors text-lg font-semibold" placeholder="0,0" step="0.1" min="0" required>
                                        <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-green-600 font-medium">t</span>
                                    </div>
                                    <div id="info-peso-cliente" class="mt-2 text-xs text-green-700 space-y-1">
                                        <div>üì¶ Volume: <span id="volume-cliente-modal">0,0 m¬≥</span></div>
                                        <div>üí∞ Pre√ßo: R$ <span id="preco-tonelada-modal">0,00</span>/t <span id="indicador-preco-modal" class="bg-green-200 px-2 py-1 rounded text-xs hidden"></span></div>
                                        <div class="font-semibold">üéØ Total: R$ <span id="valor-total-modal">0,00</span></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Etapa 4: Pagamento -->
                            <div class="bg-purple-50 p-4 rounded-xl border-2 border-purple-200">
                                <label class="block text-sm font-bold text-purple-800 mb-3 flex items-center gap-2">
                                    <span class="text-lg">üí≥</span>
                                    Forma de Pagamento
                                </label>
                                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                                    <label class="payment-option cursor-pointer">
                                        <input type="radio" name="tipo-pagamento-modal" value="pix" class="hidden">
                                        <div class="p-3 border-2 border-purple-300 rounded-lg text-center transition-all hover:border-purple-500 hover:bg-purple-100">
                                            <div class="text-2xl mb-1">üì±</div>
                                            <div class="text-sm font-medium">PIX</div>
                                        </div>
                                    </label>
                                    <label class="payment-option cursor-pointer">
                                        <input type="radio" name="tipo-pagamento-modal" value="dinheiro" class="hidden">
                                        <div class="p-3 border-2 border-purple-300 rounded-lg text-center transition-all hover:border-purple-500 hover:bg-purple-100">
                                            <div class="text-2xl mb-1">üíµ</div>
                                            <div class="text-sm font-medium">Dinheiro</div>
                                        </div>
                                    </label>
                                    <label class="payment-option cursor-pointer">
                                        <input type="radio" name="tipo-pagamento-modal" value="cheque" class="hidden">
                                        <div class="p-3 border-2 border-purple-300 rounded-lg text-center transition-all hover:border-purple-500 hover:bg-purple-100">
                                            <div class="text-2xl mb-1">üí∞</div>
                                            <div class="text-sm font-medium">Cheque</div>
                                        </div>
                                    </label>
                                    <label class="payment-option cursor-pointer">
                                        <input type="radio" name="tipo-pagamento-modal" value="prazo" class="hidden">
                                        <div class="p-3 border-2 border-purple-300 rounded-lg text-center transition-all hover:border-purple-500 hover:bg-purple-100">
                                            <div class="text-2xl mb-1">üìÖ</div>
                                            <div class="text-sm font-medium">A Prazo</div>
                                        </div>
                                    </label>
                                </div>
                                <div id="campo-prazo-modal" class="mt-4 hidden">
                                    <label class="block text-sm font-medium text-purple-700 mb-2">Prazo em dias</label>
                                    <input type="number" id="prazo-dias-modal" class="w-full p-3 border-2 border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="30" min="1">
                                </div>
                            </div>

                            <!-- Preview Final -->
                            <div id="preview-venda-modal" class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl border-2 border-green-200">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <span class="text-xl">üìä</span>
                                    Preview da Venda
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="text-center">
                                        <div class="text-sm text-gray-600">Valor da Venda</div>
                                        <div class="text-2xl font-bold text-green-600">R$ <span id="preview-valor-modal">0,00</span></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm text-gray-600">Custo Total</div>
                                        <div class="text-2xl font-bold text-blue-600">R$ <span id="preview-custo-modal">0,00</span></div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm text-gray-600">Lucro Estimado</div>
                                        <div id="preview-lucro-container" class="text-2xl font-bold text-yellow-600">R$ <span id="preview-lucro-modal">0,00</span></div>
                                    </div>
                                </div>
                                <div class="mt-4 text-xs text-gray-500 text-center">
                                    üí° <strong>F√≥rmula:</strong> Peso Cliente √ó Pre√ßo Individual = Valor da Venda
                                </div>
                            </div>

                            <!-- Observa√ß√µes -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <span class="text-lg">üìù</span>
                                    Observa√ß√µes (opcional)
                                </label>
                                <textarea id="observacoes-venda-modal" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde focus:border-empresa-verde transition-colors" rows="3" placeholder="Informa√ß√µes adicionais sobre a venda..."></textarea>
                            </div>

                            <!-- Bot√µes de A√ß√£o -->
                            <div class="flex gap-4 pt-4 border-t-2 border-gray-200">
                                <button type="button" id="cancelar-venda-modal" class="flex-1 bg-gray-500 text-white p-4 rounded-xl font-medium hover:bg-gray-600 transition-colors">
                                    ‚ùå Cancelar
                                </button>
                                <button type="submit" class="flex-2 bg-gradient-to-r from-empresa-verde to-empresa-azul text-white p-4 rounded-xl font-bold hover:shadow-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <div class="flex items-center justify-center gap-2">
                                        <span class="text-lg">‚úÖ</span>
                                        <span>Registrar Venda</span>
                                    </div>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Sistema de Alertas Popup -->
            <div id="sistema-alertas">
                <!-- Modal de Alerta -->
                <div id="modal-alerta" class="fixed top-4 right-4 hidden z-50 max-w-md w-full sm:w-96 mx-4 sm:mx-0">
                    <div class="bg-white rounded-2xl shadow-2xl border-4 border-gray-200 animate-bounce">
                        <!-- Header do Alerta -->
                        <div id="alerta-header" class="bg-gradient-to-r from-yellow-500 to-red-500 p-4 rounded-t-2xl">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <span id="alerta-icone" class="text-3xl">‚ö†Ô∏è</span>
                                    <div>
                                        <h3 id="alerta-titulo" class="text-lg font-bold text-white">Alerta do Sistema</h3>
                                        <p id="alerta-subtitulo" class="text-white/80 text-sm">Aten√ß√£o necess√°ria</p>
                                    </div>
                                </div>
                                <button id="fechar-alerta" class="text-white/80 hover:text-white text-2xl transition-colors">
                                    &times;
                                </button>
                            </div>
                        </div>

                        <!-- Conte√∫do do Alerta -->
                        <div class="p-6">
                            <div id="alerta-conteudo" class="text-gray-700 mb-6">
                                <!-- Conte√∫do do alerta ser√° inserido aqui -->
                            </div>

                            <!-- Bot√µes de A√ß√£o -->
                            <div class="flex gap-3">
                                <button id="alerta-acao-principal" class="flex-1 bg-empresa-verde text-white p-3 rounded-lg font-medium hover:bg-empresa-verde-dark transition-colors">
                                    ‚úÖ Entendi
                                </button>
                                <button id="alerta-nao-mostrar" class="flex-1 bg-gray-500 text-white p-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">
                                    üîï N√£o mostrar mais
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Toast de Notifica√ß√£o -->
                <div id="toast-container" class="fixed top-4 right-4 z-40 space-y-2">
                    <!-- Toasts ser√£o inseridos aqui dinamicamente -->
                </div>
            </div>

            <div id="minerios-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-verde">‚õèÔ∏è Gest√£o de Min√©rios</h2>
                
                <!-- Formul√°rio de Cadastro -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üìù Cadastrar Novo Material</h3>
                    <form id="form-minerio" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Material</label>
                            <input type="text" id="nome-minerio" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="Ex: Areia M√©dia" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select id="categoria-minerio" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="">Selecione uma categoria</option>
                                <option value="Areia">Areia</option>
                                <option value="Brita">Brita</option>
                                <option value="Pedra">Pedra</option>
                                <option value="Cascalho">Cascalho</option>
                                <option value="Pedrisco">Pedrisco</option>
                                <option value="Rach√£o">Rach√£o</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Custo por Tonelada (R$)</label>
                            <input type="number" id="preco-tonelada" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" placeholder="0,00" step="0.01" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo por m¬≥ (Calculado)</label>
                            <input type="text" id="preco-metro-calculado" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100" placeholder="Ser√° calculado automaticamente" readonly>
                            <p class="text-xs text-gray-500 mt-1">Calculado como: Custo por Tonelada √ó Densidade</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Densidade (t/m¬≥)</label>
                            <select id="densidade-material" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="">Selecione a densidade</option>
                                <option value="1.4">Areia Seca - 1,4 t/m¬≥</option>
                                <option value="1.6">Areia √ömida - 1,6 t/m¬≥</option>
                                <option value="1.5">Brita 0 - 1,5 t/m¬≥</option>
                                <option value="1.6">Brita 1 - 1,6 t/m¬≥</option>
                                <option value="1.7">Brita 2 - 1,7 t/m¬≥</option>
                                <option value="1.8">Brita 3 - 1,8 t/m¬≥</option>
                                <option value="1.3">Pedrisco - 1,3 t/m¬≥</option>
                                <option value="1.2">Rach√£o - 1,2 t/m¬≥</option>
                                <option value="1.1">Cascalho - 1,1 t/m¬≥</option>
                                <option value="1.5">Pedra Britada - 1,5 t/m¬≥</option>
                                <option value="2.0">Brita Pesada - 2,0 t/m¬≥</option>
                                <option value="1.0">Material Leve - 1,0 t/m¬≥</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </div>
                        <div id="campo-densidade-custom" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Densidade Personalizada (t/m¬≥)</label>
                            <input type="number" id="densidade-custom" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" placeholder="0,00" step="0.01" min="0.1" max="5.0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Unidade Principal</label>
                            <select id="unidade-principal" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="tonelada">Tonelada</option>
                                <option value="metro">Metro C√∫bico</option>
                                <option value="carga">Carga</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="status-minerio" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                            <textarea id="observacoes-minerio" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" rows="3" placeholder="Informa√ß√µes adicionais sobre o material..."></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark w-full sm:w-auto">
                                ‚úÖ Cadastrar Material
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Lista de Materiais -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Materiais Cadastrados</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Material</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Categoria</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Custo/Ton</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pre√ßo/m¬≥</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Densidade</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-minerios" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                                        üì¶ Nenhum material cadastrado ainda
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="clientes-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-verde">üë• Gest√£o de Clientes</h2>
                
                <!-- Formul√°rio de Cadastro -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üìù Cadastrar/Editar Cliente</h3>
                    <form id="form-cliente" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome/Raz√£o Social</label>
                            <input type="text" id="nome-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="Ex: Construtora ABC Ltda" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CNPJ</label>
                            <input type="text" id="cnpj-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="00.000.000/0000-00" maxlength="18">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero de Telefone</label>
                            <input type="tel" id="telefone-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="(11) 99999-9999" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bairro/Cidade</label>
                            <input type="text" id="endereco-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="Ex: Centro, S√£o Paulo - SP" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dist√¢ncia (km)</label>
                            <input type="number" id="distancia-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" placeholder="0" step="0.1" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="status-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark w-full sm:w-auto">
                                ‚úÖ Cadastrar Cliente
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Lista de Clientes -->
                <div class="bg-white border border-gray-200 rounded-lg mb-6">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Clientes Cadastrados</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pre√ßo 5/8</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pre√ßo 3/8</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Telefone</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Localiza√ß√£o</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Dist√¢ncia</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-clientes" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                        üë• Nenhum cliente cadastrado ainda
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Modal de Pre√ßos do Cliente -->
                <div id="modal-precos" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-empresa-azul">üí∞ Pre√ßos Espec√≠ficos do Cliente</h3>
                            <button id="fechar-modal" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                        </div>
                        
                        <div id="info-cliente-modal" class="mb-4 p-3 bg-gray-50 rounded-lg">
                            <!-- Informa√ß√µes do cliente ser√£o inseridas aqui -->
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Selecionar Material</label>
                                <select id="select-material" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                    <option value="">Selecione um material</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Pre√ßo</label>
                                <select id="tipo-preco" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                    <option value="tonelada">Por Tonelada</option>
                                    <option value="metro">Por Metro C√∫bico</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$)</label>
                                <input type="number" id="preco-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" placeholder="0,00" step="0.01" min="0">
                            </div>
                            <div class="flex items-end">
                                <button id="btn-add-preco" class="bg-empresa-verde text-white px-4 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark w-full">
                                    ‚ûï Adicionar Pre√ßo
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tabela de Pre√ßos -->
                        <div class="bg-white border border-gray-200 rounded-lg">
                            <div class="p-3 border-b border-gray-200">
                                <h4 class="font-semibold text-gray-800">Pre√ßos Configurados</h4>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Material</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Categoria</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Pre√ßo</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-precos-cliente" class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="5" class="px-4 py-6 text-center text-gray-500">
                                                üí∞ Nenhum pre√ßo configurado ainda
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4 flex justify-end">
                            <button id="salvar-precos" class="bg-empresa-azul text-white px-6 py-2 rounded-lg font-medium hover:bg-empresa-azul-dark">
                                üíæ Salvar Pre√ßos
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="vendas-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-amarelo">üí∞ Gest√£o de Vendas</h2>
                
                <!-- Filtros -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üîç Filtros</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                            <select id="filtro-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo">
                                <option value="">Todos os clientes</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data Inicial</label>
                            <input type="date" id="filtro-data-inicio" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data Final</label>
                            <input type="date" id="filtro-data-fim" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo">
                        </div>
                    </div>
                </div>
                
                <!-- Cadastro de Venda -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üìù Nova Venda</h3>
                    <form id="form-venda" class="space-y-4">
                        <!-- Linha 1 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Material</label>
                                <select id="material-venda" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" required>
                                    <option value="">Selecione um material</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                                <select id="cliente-venda" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" required>
                                    <option value="">Selecione um cliente</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Linha 2 -->
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ve√≠culo e Motorista</label>
                                <select id="veiculo-venda" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" required>
                                    <option value="">Selecione um ve√≠culo</option>
                                </select>
                                <div id="info-motorista" class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg hidden">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <span class="text-sm font-medium text-blue-700">üë®‚Äçüíº Motorista: </span>
                                            <span id="nome-motorista-vinculado" class="text-sm text-blue-600">-</span>
                                        </div>
                                        <button type="button" id="btn-trocar-motorista" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                                            üîÑ Trocar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Linha 3 - Sistema de Duplo Peso -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg border border-empresa-azul">
                                <h4 class="text-sm font-semibold text-empresa-azul mb-3">‚öñÔ∏è Peso Pedreira</h4>
                                <div class="space-y-2">
                                    <input type="number" id="peso-pedreira" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-empresa-azul" placeholder="Peso em toneladas" step="0.1" min="0" required>
                                    <div class="text-xs text-gray-600">
                                        <span>Volume aproximado: </span>
                                        <span id="volume-pedreira">0,00 m¬≥</span>
                                    </div>
                                    <div class="text-xs text-gray-600">
                                        <span>Custo do material: R$ </span>
                                        <span id="custo-tonelada">0,00</span>
                                        <span>/t</span>
                                    </div>
                                    <div class="text-sm font-medium text-empresa-azul">
                                        <span>Custo Total: R$ </span>
                                        <span id="custo-total">0,00</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <span>Custo/t √ó Peso = Total</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg border border-empresa-verde">
                                <h4 class="text-sm font-semibold text-empresa-verde mb-3">‚öñÔ∏è Peso Cliente</h4>
                                <div class="space-y-2">
                                    <input type="number" id="peso-cliente" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="Peso em toneladas" step="0.1" min="0" required>
                                    <div class="text-xs text-gray-600">
                                        <span>Volume aproximado: </span>
                                        <span id="volume-cliente">0,00 m¬≥</span>
                                    </div>
                                    <div class="text-xs text-gray-600">
                                        <span>Pre√ßo individual/tonelada: R$ </span>
                                        <span id="preco-cliente-ton">0,00</span>
                                        <span id="indicador-preco-especifico" class="ml-1 text-xs text-green-600 font-medium hidden">‚úÖ Espec√≠fico</span>
                                        <span id="indicador-tipo-preco" class="ml-1 text-xs text-blue-600 font-medium hidden"></span>
                                        <span id="indicador-tipo-preco" class="ml-1 text-xs text-blue-600 font-medium hidden"></span>
                                        <span id="indicador-tipo-preco" class="ml-1 text-xs text-blue-600 font-medium hidden"></span>
                                    </div>
                                    <div class="text-sm font-medium text-empresa-verde">
                                        <span>Valor de Venda: R$ </span>
                                        <span id="valor-venda">0,00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Linha 4 - Pagamento -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Pagamento</label>
                                <select id="tipo-pagamento" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" required>
                                    <option value="">Selecione o tipo</option>
                                    <option value="pix">PIX</option>
                                    <option value="dinheiro">Dinheiro</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="prazo">A Prazo</option>
                                </select>
                            </div>
                            <div id="campo-prazo" class="hidden">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Prazo (dias)</label>
                                <input type="number" id="prazo-dias" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" placeholder="0" min="1">
                            </div>
                        </div>
                        
                        <!-- Linha 5 - Observa√ß√µes -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                            <textarea id="observacoes-venda" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" rows="3" placeholder="Informa√ß√µes adicionais sobre a venda..."></textarea>
                        </div>
                        
                        <!-- Preview de Lucro -->
                        <div class="bg-yellow-50 p-4 rounded-lg border border-empresa-amarelo">
                            <h4 class="text-sm font-semibold text-empresa-amarelo mb-3">üìä Preview da Venda</h4>
                            <div class="text-xs text-gray-500 mb-2">
                                üí° <strong>F√≥rmula:</strong> Peso Cliente √ó Pre√ßo Individual = Total da Venda
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600">Valor de Venda:</span>
                                    <div class="text-lg font-semibold text-empresa-verde">R$ <span id="preview-venda">0,00</span></div>
                                </div>
                                <div>
                                    <span class="text-gray-600">Custo Total:</span>
                                    <div class="text-lg font-semibold text-empresa-azul">R$ <span id="preview-custo">0,00</span></div>
                                </div>
                                <div>
                                    <span class="text-gray-600">Lucro Aproximado:</span>
                                    <div class="text-lg font-semibold text-empresa-amarelo">R$ <span id="preview-lucro">0,00</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bot√£o de Salvar -->
                        <div class="flex justify-end">
                            <button type="submit" class="bg-empresa-amarelo text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-amarelo-dark">
                                ‚úÖ Registrar Venda
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Lista de Vendas -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Vendas Registradas</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Material</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ve√≠culo</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Motorista</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Peso P./C.</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Lucro</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pagamento</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-vendas" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="10" class="px-4 py-8 text-center text-gray-500">
                                        üí∞ Nenhuma venda registrada ainda
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="veiculos-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-azul">üöõ Gest√£o de Ve√≠culos</h2>
                
                <!-- Formul√°rio de Cadastro -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üìù Cadastrar/Editar Ve√≠culo</h3>
                    <form id="form-veiculo" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Placa</label>
                            <input type="text" id="placa-veiculo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul" placeholder="ABC-1234" required maxlength="8">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Modelo</label>
                            <input type="text" id="modelo-veiculo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul" placeholder="Ex: Mercedes-Benz 1620" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tara (kg)</label>
                            <input type="number" id="tara-veiculo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" placeholder="0" step="1" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Motorista</label>
                            <select id="motorista-veiculo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul" required>
                                <option value="">Selecione um motorista</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="status-veiculo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                                <option value="ativo">Ativo</option>
                                <option value="manutencao">Em Manuten√ß√£o</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                            <textarea id="observacoes-veiculo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul" rows="3" placeholder="Informa√ß√µes adicionais sobre o ve√≠culo..."></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-empresa-azul text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-azul-dark w-full sm:w-auto">
                                ‚úÖ Cadastrar Ve√≠culo
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Lista de Ve√≠culos -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Ve√≠culos Cadastrados</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Placa</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Modelo</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Motorista</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tara (kg)</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-veiculos" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                                        üöõ Nenhum ve√≠culo cadastrado ainda
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="motoristas-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-verde">üë®‚Äçüíº Gest√£o de Motoristas</h2>
                
                <!-- Formul√°rio de Cadastro -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üìù Cadastrar/Editar Motorista</h3>
                    <form id="form-motorista" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                            <input type="text" id="nome-motorista" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="Ex: Jo√£o da Silva" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CNH (Opcional)</label>
                            <input type="text" id="cnh-motorista" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="Ex: 12345678901" maxlength="11">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Vencimento da CNH</label>
                            <input type="date" id="vencimento-cnh" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Vencimento do Toxicol√≥gico</label>
                            <input type="date" id="vencimento-toxicologico" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                            <input type="tel" id="telefone-motorista" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="(11) 99999-9999">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="status-motorista" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="ativo">Ativo</option>
                                <option value="afastado">Afastado</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                            <textarea id="observacoes-motorista" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" rows="3" placeholder="Informa√ß√µes adicionais sobre o motorista..."></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark w-full sm:w-auto">
                                ‚úÖ Cadastrar Motorista
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Lista de Motoristas -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Motoristas Cadastrados</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">CNH</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Venc. CNH</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Venc. Toxicol√≥gico</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Telefone</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Situa√ß√£o</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-motoristas" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                                        üë®‚Äçüíº Nenhum motorista cadastrado ainda
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="estoque-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-verde">üì¶ Controle de Estoque</h2>
                
                <!-- Saldo Atual do Estoque -->
                <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 sm:p-6 rounded-lg border-2 border-empresa-verde mb-6">
                    <div class="text-center">
                        <h3 class="text-lg font-semibold text-empresa-verde mb-2">üí∞ Saldo do Estoque</h3>
                        <div class="text-3xl sm:text-4xl font-bold text-empresa-azul mb-2">
                            R$ <span id="saldo-estoque">0,00</span>
                        </div>
                        <div id="alerta-estoque" class="text-sm font-medium hidden">
                            ‚ö†Ô∏è Estoque abaixo do m√≠nimo configurado!
                        </div>
                    </div>
                </div>
                
                <!-- Adicionar Cr√©dito ao Estoque -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">‚ûï Adicionar Cr√©dito ao Estoque</h3>
                    <form id="form-credito-estoque" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                            <input type="number" id="valor-credito" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="0,00" step="0.01" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                            <input type="text" id="descricao-credito" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="Ex: Compra de materiais, Reposi√ß√£o..." required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                            <textarea id="observacoes-credito" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" rows="3" placeholder="Informa√ß√µes adicionais sobre o cr√©dito..."></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark w-full sm:w-auto">
                                ‚úÖ Adicionar Cr√©dito
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Hist√≥rico de Movimenta√ß√µes -->
                <div class="bg-white border border-gray-200 rounded-lg mb-6">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Hist√≥rico de Movimenta√ß√µes</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Descri√ß√£o</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Saldo</th>
                                </tr>
                            </thead>
                            <tbody id="lista-movimentacoes" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                        üì¶ Nenhuma movimenta√ß√£o registrada ainda
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Estat√≠sticas do Estoque -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-green-50 p-4 rounded-lg border border-empresa-verde">
                        <h4 class="font-medium text-empresa-verde-dark mb-2">üí≥ Total de Cr√©ditos</h4>
                        <p class="text-2xl font-bold text-empresa-verde">R$ <span id="total-creditos">0,00</span></p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg border border-red-400">
                        <h4 class="font-medium text-red-700 mb-2">üí∏ Total de D√©bitos</h4>
                        <p class="text-2xl font-bold text-red-600">R$ <span id="total-debitos">0,00</span></p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-empresa-azul">
                        <h4 class="font-medium text-empresa-azul-dark mb-2">üìä Movimenta√ß√µes</h4>
                        <p class="text-2xl font-bold text-empresa-azul"><span id="total-movimentacoes">0</span></p>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o de Despesas -->
            <div id="despesas-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-red-600">üí∏ Controle de Despesas</h2>
                
                <!-- Resumo de Despesas -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-red-50 p-4 rounded-lg border-2 border-red-200">
                        <h3 class="text-sm font-medium text-red-700 mb-2">üí∏ Total do M√™s</h3>
                        <p id="despesas-total-mes" class="text-2xl font-bold text-red-600">R$ 0,00</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg border-2 border-orange-200">
                        <h3 class="text-sm font-medium text-orange-700 mb-2">üìÖ Esta Semana</h3>
                        <p id="despesas-semana" class="text-2xl font-bold text-orange-600">R$ 0,00</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200">
                        <h3 class="text-sm font-medium text-yellow-700 mb-2">üìä Hoje</h3>
                        <p id="despesas-hoje" class="text-2xl font-bold text-yellow-600">R$ 0,00</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                        <h3 class="text-sm font-medium text-blue-700 mb-2">üìã Quantidade</h3>
                        <p id="despesas-quantidade" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                </div>
                
                <!-- Bot√£o para Adicionar Despesa -->
                <div class="mb-6">
                    <button id="btn-adicionar-despesa" class="bg-red-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-red-600 transition-colors">
                        üí∏ Nova Despesa
                    </button>
                </div>
                
                <!-- Filtros -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üîç Filtros</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select id="filtro-categoria-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">Todas as categorias</option>
                                <option value="combustivel">‚õΩ Combust√≠vel</option>
                                <option value="manutencao">üîß Manuten√ß√£o</option>
                                <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                                <option value="pedagio">üõ£Ô∏è Ped√°gio</option>
                                <option value="seguro">üõ°Ô∏è Seguro</option>
                                <option value="impostos">üìã Impostos</option>
                                <option value="equipamentos">‚öôÔ∏è Equipamentos</option>
                                <option value="outros">üìù Outros</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Per√≠odo</label>
                            <select id="filtro-periodo-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">Todos</option>
                                <option value="hoje">Hoje</option>
                                <option value="semana">Esta Semana</option>
                                <option value="mes">Este M√™s</option>
                                <option value="personalizado">Personalizado</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ve√≠culo</label>
                            <select id="filtro-veiculo-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">Todos os ve√≠culos</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-filtrar-despesas" class="bg-red-500 text-white px-4 py-3 rounded-lg font-medium hover:bg-red-600 w-full transition-colors">
                                üîç Filtrar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de Despesas -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Hist√≥rico de Despesas</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Categoria</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Descri√ß√£o</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ve√≠culo</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-despesas" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                        üí∏ Nenhuma despesa registrada ainda
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="cobranca-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-amarelo">üìã Gest√£o de Cobran√ßa</h2>
                
                <!-- Resumo de Cobran√ßas -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-red-50 p-4 rounded-lg border-2 border-red-200">
                        <h3 class="text-sm font-medium text-red-700 mb-2">üí∏ Total em Aberto</h3>
                        <p id="total-aberto" class="text-2xl font-bold text-red-600">R$ 0,00</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200">
                        <h3 class="text-sm font-medium text-green-700 mb-2">‚úÖ Total Pago</h3>
                        <p id="total-pago" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                        <h3 class="text-sm font-medium text-blue-700 mb-2">üìä Pend√™ncias</h3>
                        <p id="total-pendencias" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                </div>
                
                <!-- Bot√£o para Adicionar Pagamento -->
                <div class="mb-6">
                    <button id="btn-adicionar-pagamento" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark">
                        üí∞ Adicionar Pagamento
                    </button>
                </div>
                
                <!-- Filtros -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üîç Filtros</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                            <select id="filtro-cliente-cobranca" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo">
                                <option value="">Todos os clientes</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="filtro-status-cobranca" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo">
                                <option value="">Todos</option>
                                <option value="aberto">Em Aberto</option>
                                <option value="pago">Pago</option>
                                <option value="parcial">Parcialmente Pago</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-filtrar-cobranca" class="bg-empresa-amarelo text-white px-4 py-3 rounded-lg font-medium hover:bg-empresa-amarelo-dark w-full">
                                üîç Filtrar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de Cobran√ßas -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-empresa-azul">üìã Cobran√ßas Pendentes</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data Venda</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Material</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor Original</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor Pago</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Saldo</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-cobrancas" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                                        üìã Nenhuma cobran√ßa pendente
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Modal para Adicionar Pagamento -->
                <div id="modal-adicionar-pagamento" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-empresa-azul">üí∞ Adicionar Pagamento</h3>
                            <button id="fechar-modal-pagamento" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                        </div>
                        
                        <form id="form-adicionar-pagamento" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                                <select id="cliente-pagamento" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" required>
                                    <option value="">Selecione um cliente</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Valor Pago (R$)</label>
                                <input type="number" id="valor-pagamento" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" placeholder="0,00" step="0.01" min="0" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Forma de Pagamento</label>
                                <select id="forma-pagamento" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" required>
                                    <option value="">Selecione a forma</option>
                                    <option value="pix">PIX</option>
                                    <option value="dinheiro">Dinheiro</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="transferencia">Transfer√™ncia</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                                <textarea id="observacoes-pagamento" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde" rows="3" placeholder="Informa√ß√µes adicionais sobre o pagamento..."></textarea>
                            </div>
                            
                            <div id="preview-pagamento" class="hidden bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="text-sm font-semibold text-blue-700 mb-2">üìä Preview do Pagamento</h4>
                                <div id="preview-aplicacao" class="text-sm text-gray-600"></div>
                            </div>
                            
                            <div class="flex justify-end gap-3">
                                <button type="button" id="cancelar-pagamento" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Cancelar
                                </button>
                                <button type="submit" class="px-4 py-2 bg-empresa-verde text-white rounded-lg hover:bg-empresa-verde-dark">
                                    ‚úÖ Confirmar Pagamento
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div id="relatorios-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-azul">üìä Relat√≥rios</h2>
                
                <!-- Filtros dos Relat√≥rios -->
                <div class="bg-gray-50 p-4 sm:p-6 rounded-lg border border-gray-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-empresa-azul">üîç Filtros</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data Inicial</label>
                            <input type="date" id="filtro-relatorio-inicio" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data Final</label>
                            <input type="date" id="filtro-relatorio-fim" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                            <select id="filtro-relatorio-cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                                <option value="">Todos os clientes</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Relat√≥rio</label>
                            <select id="tipo-relatorio" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                                <option value="vendas">üìà Vendas</option>
                                <option value="clientes">üë• Clientes</option>
                                <option value="despesas">üí∏ Despesas</option>
                                <option value="estoque">üì¶ Estoque</option>
                                <option value="completo">üìã Completo</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button id="btn-gerar-relatorio" class="bg-empresa-azul text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-azul-dark">
                            üìä Gerar Relat√≥rio
                        </button>
                        <button id="btn-imprimir-pdf" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark">
                            üìÑ Imprimir PDF
                        </button>
                        <button id="btn-via-cliente" class="bg-empresa-amarelo text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-amarelo-dark">
                            üìã Via do Cliente
                        </button>
                    </div>
                </div>
                
                <!-- √Årea do Relat√≥rio -->
                <div id="area-relatorio" class="bg-white border border-gray-200 rounded-lg p-6 min-h-[400px]">
                    <div class="text-center text-gray-500 py-20">
                        <div class="text-6xl mb-4">üìä</div>
                        <h3 class="text-xl font-medium mb-2">Selecione um tipo de relat√≥rio</h3>
                        <p class="text-sm">Escolha o tipo de relat√≥rio e clique em "Gerar Relat√≥rio"</p>
                    </div>
                </div>
            </div>

            <div id="config-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-empresa-verde">‚öôÔ∏è Configura√ß√µes</h2>
                
                <!-- Se√ß√£o de Importa√ß√£o -->
                <div class="mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-empresa-azul">üì• Importar Dados</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6">
                        <!-- Importar Clientes -->
                        <div class="bg-green-50 p-4 rounded-lg border border-empresa-verde">
                            <h4 class="font-medium text-empresa-verde-dark mb-3">üë• Clientes</h4>
                            <input type="file" id="import-clientes" accept=".json,.csv" class="mb-3 block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-empresa-verde file:text-white">
                            <button id="btn-import-clientes" class="w-full bg-empresa-verde text-white px-4 py-2 rounded text-sm font-medium">Importar</button>
                        </div>
                        
                        <!-- Importar Materiais -->
                        <div class="bg-yellow-50 p-4 rounded-lg border border-empresa-amarelo">
                            <h4 class="font-medium text-empresa-amarelo-dark mb-3">‚õèÔ∏è Materiais</h4>
                            <input type="file" id="import-materiais" accept=".json,.csv" class="mb-3 block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-empresa-amarelo file:text-white">
                            <button id="btn-import-materiais" class="w-full bg-empresa-amarelo text-white px-4 py-2 rounded text-sm font-medium">Importar</button>
                        </div>
                        
                        <!-- Importar Dados Completos -->
                        <div class="bg-blue-50 p-4 rounded-lg border border-empresa-azul">
                            <h4 class="font-medium text-empresa-azul-dark mb-3">üìä Dados Completos</h4>
                            <input type="file" id="import-completo" accept=".json" class="mb-3 block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-empresa-azul file:text-white">
                            <button id="btn-import-completo" class="w-full bg-empresa-azul text-white px-4 py-2 rounded text-sm font-medium">Importar</button>
                        </div>
                    </div>
                    
                    <!-- Bot√£o para Gerar Dados de Exemplo -->
                    <div class="mt-4 text-center">
                        <button id="btn-gerar-dados-exemplo" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark">
                            üìã Gerar Dados de Exemplo
                        </button>
                        <p class="text-sm text-gray-600 mt-2">Clique para popular o sistema com dados de exemplo para teste</p>
                    </div>
                </div>
                
                <!-- Se√ß√£o de Exporta√ß√£o -->
                <div class="mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-empresa-azul">üì§ Exportar</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                        <button id="btn-export-json" class="bg-empresa-verde text-white px-4 py-3 rounded text-sm font-medium">üìÑ JSON</button>
                        <button id="btn-export-csv" class="bg-empresa-amarelo text-white px-4 py-3 rounded text-sm font-medium">üìä CSV</button>
                        <button id="btn-backup" class="bg-empresa-azul text-white px-4 py-3 rounded text-sm font-medium">üíæ Backup</button>
                        <button id="btn-sync-firebase" class="bg-purple-500 text-white px-4 py-3 rounded text-sm font-medium">üîÑ Sincronizar</button>
                        <button id="btn-force-upload" class="bg-orange-500 text-white px-4 py-3 rounded text-sm font-medium">üì§ Upload For√ßado</button>
                    </div>
                </div>
                
                <!-- Se√ß√£o de Configura√ß√µes de Estoque -->
                <div class="mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-empresa-azul">üì¶ Configura√ß√µes de Estoque</h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <form id="form-config-estoque" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Alerta de Estoque M√≠nimo (R$)</label>
                                <input type="number" id="estoque-minimo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-amarelo" placeholder="0,00" step="0.01" min="0" value="1000">
                            </div>
                            <div class="flex items-end">
                                <button type="submit" class="bg-empresa-amarelo text-white px-4 py-3 rounded-lg font-medium hover:bg-empresa-amarelo-dark w-full">
                                    ‚öôÔ∏è Salvar Configura√ß√£o
                                </button>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                                <p class="text-xs text-gray-600">Defina o valor m√≠nimo em R$ para o estoque. Quando o saldo ficar abaixo deste valor, ser√° exibido um alerta.</p>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Se√ß√£o de Configura√ß√µes de Alertas -->
                <div class="mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-empresa-azul">üö® Configura√ß√µes de Alertas</h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="space-y-4">
                            <!-- Configura√ß√µes de Popup -->
                            <div class="bg-white p-4 rounded-lg border border-gray-200">
                                <h4 class="text-md font-semibold text-empresa-verde mb-3">üì¢ Alertas Popup</h4>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="popup-estoque-baixo" class="form-checkbox h-4 w-4 text-empresa-verde">
                                        <span class="text-sm text-gray-700">‚ö†Ô∏è Alerta de estoque baixo</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="popup-cnh-vencimento" class="form-checkbox h-4 w-4 text-empresa-verde">
                                        <span class="text-sm text-gray-700">üìã Vencimento de CNH (30 dias)</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="popup-toxicologico-vencimento" class="form-checkbox h-4 w-4 text-empresa-verde">
                                        <span class="text-sm text-gray-700">üß™ Vencimento de Toxicol√≥gico (30 dias)</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="popup-vendas-atraso" class="form-checkbox h-4 w-4 text-empresa-verde">
                                        <span class="text-sm text-gray-700">üí∞ Vendas em atraso no pagamento</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="popup-vendas-vencendo" class="form-checkbox h-4 w-4 text-empresa-verde">
                                        <span class="text-sm text-gray-700">‚è∞ Vendas vencendo em 3 dias</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Configura√ß√µes de Frequ√™ncia -->
                            <div class="bg-white p-4 rounded-lg border border-gray-200">
                                <h4 class="text-md font-semibold text-empresa-azul mb-3">‚è±Ô∏è Frequ√™ncia dos Alertas</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Verificar alertas a cada:</label>
                                        <select id="frequencia-alertas" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                                            <option value="60000">1 minuto</option>
                                            <option value="300000" selected>5 minutos</option>
                                            <option value="600000">10 minutos</option>
                                            <option value="1800000">30 minutos</option>
                                            <option value="3600000">1 hora</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">N√£o repetir alerta por:</label>
                                        <select id="timeout-alertas" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-azul">
                                            <option value="3600000">1 hora</option>
                                            <option value="21600000" selected>6 horas</option>
                                            <option value="43200000">12 horas</option>
                                            <option value="86400000">24 horas</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Bot√µes de A√ß√£o -->
                            <div class="flex gap-3">
                                <button id="btn-salvar-alertas" class="bg-empresa-verde text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-verde-dark">
                                    ‚úÖ Salvar Configura√ß√µes
                                </button>
                                <button id="btn-testar-alertas" class="bg-empresa-azul text-white px-6 py-3 rounded-lg font-medium hover:bg-empresa-azul-dark">
                                    üß™ Testar Alertas
                                </button>
                                <button id="btn-desativar-todos" class="bg-red-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-red-600">
                                    üîï Desativar Todos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o de Status -->
                <div class="mb-6 sm:mb-8">
                    <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-empresa-azul">üìä Status do Sistema</h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div id="status-dados" class="text-sm text-gray-600 space-y-1">
                            <p>üü¢ Sistema operacional</p>
                            <p>üìÅ Formatos: JSON, CSV</p>
                            <p id="status-firebase">üî• Firebase: <span id="firebase-status">Conectando...</span></p>
                            <p id="status-sync">üîÑ √öltima sync: <span id="ultima-sync">Verificando...</span></p>
                            <p id="status-queue">üìã Fila de sync: <span id="sync-queue-count">0</span> itens</p>
                            <p>üì¶ Saldo do estoque: R$ <span id="status-saldo-estoque">0,00</span></p>
                        </div>
                    </div>
                    
                    <!-- Controles de Sincroniza√ß√£o -->
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h4 class="font-medium text-blue-800 mb-3">üîÑ Controles de Sincroniza√ß√£o</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <button id="btn-check-connection" class="bg-blue-500 text-white px-4 py-2 rounded text-sm font-medium hover:bg-blue-600">
                                üì° Verificar Conex√£o
                            </button>
                            <button id="btn-manual-sync" class="bg-green-500 text-white px-4 py-2 rounded text-sm font-medium hover:bg-green-600">
                                üîÑ Sincronizar Agora
                            </button>
                            <button id="btn-reset-firebase" class="bg-red-500 text-white px-4 py-2 rounded text-sm font-medium hover:bg-red-600">
                                üîß Reset Firebase
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o de Estrutura de Dados -->
                <div>
                    <h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-empresa-azul">üìã Estrutura</h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <details class="mb-4">
                            <summary class="cursor-pointer font-medium text-empresa-verde text-sm">JSON - Clientes</summary>
                            <pre class="mt-2 text-xs bg-white p-3 rounded border overflow-x-auto">
{
  "clientes": [
    {
      "id": 1,
      "nome": "Construtora ABC",
      "cnpj": "12.345.678/0001-90",
      "endereco": "Rua das Pedras, 123",
      "cidade": "S√£o Paulo",
      "telefone": "(11) 9999-9999",
      "email": "contato@construtorabc.com",
      "observacoes": "Cliente preferencial"
    }
  ]
}
                            </pre>
                        </details>
                        
                        <details class="mb-4">
                            <summary class="cursor-pointer font-medium text-empresa-amarelo text-sm">JSON - Pre√ßos</summary>
                            <pre class="mt-2 text-xs bg-white p-3 rounded border overflow-x-auto">
{
  "precos": [
    {
      "tipo_minerio": "Areia",
      "preco_tonelada": 25.50,
      "preco_metro": 35.00,
      "cliente_id": 1,
      "data_vigencia": "2025-01-01"
    }
  ]
}
                            </pre>
                        </details>
                        
                        <details>
                            <summary class="cursor-pointer font-medium text-empresa-azul text-sm">CSV - Exemplo</summary>
                            <pre class="mt-2 text-xs bg-white p-3 rounded border overflow-x-auto">
nome,cnpj,endereco,cidade,telefone,email,observacoes
Construtora ABC,12.345.678/0001-90,Rua das Pedras 123,S√£o Paulo,(11) 9999-9999,contato@abc.com,Cliente preferencial
                            </pre>
                        </details>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o de Previs√£o de Demanda -->
            <div id="previsao-content" class="content-section hidden">
                <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-purple-600">üìà Previs√£o de Demanda - Machine Learning</h2>
                
                <!-- Controles de An√°lise -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 sm:p-6 rounded-lg border-2 border-purple-200 mb-6">
                    <h3 class="text-lg font-semibold mb-4 text-purple-700">ü§ñ Configura√ß√µes da An√°lise</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Material/Min√©rio</label>
                            <select id="material-previsao" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="">Todos os materiais</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Per√≠odo de An√°lise</label>
                            <select id="periodo-analise" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="30">√öltimos 30 dias</option>
                                <option value="60" selected>√öltimos 60 dias</option>
                                <option value="90">√öltimos 90 dias</option>
                                <option value="120">√öltimos 120 dias</option>
                                <option value="180">√öltimos 180 dias</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Previs√£o para</label>
                            <select id="horizonte-previsao" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="7">7 dias</option>
                                <option value="14">14 dias</option>
                                <option value="30" selected>30 dias</option>
                                <option value="60">60 dias</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex gap-3">
                        <button id="btn-gerar-previsao" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-purple-700 transition-colors">
                            üîÆ Gerar Previs√£o
                        </button>
                        <button id="btn-treinar-modelo" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                            üß† Treinar Modelo
                        </button>
                        <button id="btn-exportar-previsao" class="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50" disabled>
                            üìä Exportar Dados
                        </button>
                    </div>
                </div>

                <!-- M√©tricas do Modelo -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6" id="metricas-modelo" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                        <h4 class="text-sm font-medium text-blue-700 mb-2">üéØ Precis√£o</h4>
                        <p id="precisao-modelo" class="text-2xl font-bold text-blue-600">0%</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200">
                        <h4 class="text-sm font-medium text-green-700 mb-2">üìä R¬≤ Score</h4>
                        <p id="r2-score" class="text-2xl font-bold text-green-600">0.00</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200">
                        <h4 class="text-sm font-medium text-yellow-700 mb-2">‚ö†Ô∏è MAE</h4>
                        <p id="mae-score" class="text-2xl font-bold text-yellow-600">0.00</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
                        <h4 class="text-sm font-medium text-purple-700 mb-2">üîç Tend√™ncia</h4>
                        <p id="tendencia" class="text-xl font-bold text-purple-600">-</p>
                    </div>
                </div>

                <!-- Gr√°fico de Previs√£o -->
                <div class="bg-white border border-gray-200 rounded-lg mb-6" id="container-grafico" style="display: none;">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-purple-600">üìà Gr√°fico de Previs√£o</h3>
                        <p class="text-sm text-gray-500">Hist√≥rico vs Previs√£o com intervalo de confian√ßa</p>
                    </div>
                    <div class="p-4">
                        <canvas id="grafico-previsao" width="800" height="400"></canvas>
                    </div>
                </div>

                <!-- Tabela de Previs√µes -->
                <div class="bg-white border border-gray-200 rounded-lg mb-6" id="container-tabela" style="display: none;">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-purple-600">üìã Detalhes da Previs√£o</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Material</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Demanda Prev.</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Intervalo Conf.</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Sazonalidade</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Confian√ßa</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-previsoes" class="bg-white divide-y divide-gray-200">
                                <!-- Dados ser√£o inseridos dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Insights e Recomenda√ß√µes -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="container-insights" style="display: none;">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                        <h4 class="text-lg font-semibold text-blue-700 mb-4">üí° Insights do Modelo</h4>
                        <div id="insights-modelo" class="space-y-2 text-sm text-blue-600">
                            <!-- Insights ser√£o inseridos dinamicamente -->
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200">
                        <h4 class="text-lg font-semibold text-green-700 mb-4">üìã Recomenda√ß√µes</h4>
                        <div id="recomendacoes" class="space-y-2 text-sm text-green-600">
                            <!-- Recomenda√ß√µes ser√£o inseridas dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Status do Treinamento -->
                <div id="status-treinamento" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200" style="display: none;">
                    <div class="flex items-center space-x-3">
                        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-purple-600"></div>
                        <span class="text-sm font-medium text-gray-700">Processando dados e treinando modelo...</span>
                    </div>
                    <div class="mt-2 bg-gray-200 rounded-full h-2">
                        <div id="barra-progresso" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal para Adicionar Despesa -->
        <div id="modal-adicionar-despesa" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-screen overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-red-600">üí∏ Nova Despesa</h3>
                    <button id="fechar-modal-despesa" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                
                <form id="form-adicionar-despesa" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data da Despesa</label>
                            <input type="date" id="data-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select id="categoria-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                <option value="">Selecione a categoria</option>
                                <option value="combustivel">‚õΩ Combust√≠vel</option>
                                <option value="manutencao">üîß Manuten√ß√£o</option>
                                <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                                <option value="pedagio">üõ£Ô∏è Ped√°gio</option>
                                <option value="seguro">üõ°Ô∏è Seguro</option>
                                <option value="impostos">üìã Impostos</option>
                                <option value="equipamentos">‚öôÔ∏è Equipamentos</option>
                                <option value="outros">üìù Outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                        <input type="text" id="descricao-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Ex: Abastecimento, Revis√£o do motor..." required>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                            <input type="number" id="valor-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0,00" step="0.01" min="0" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ve√≠culo</label>
                            <select id="veiculo-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">N√£o espec√≠fico</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Forma de Pagamento</label>
                        <select id="forma-pagamento-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" required>
                            <option value="">Selecione a forma</option>
                            <option value="dinheiro">üíµ Dinheiro</option>
                            <option value="pix">üì± PIX</option>
                            <option value="debito">üí≥ Cart√£o de D√©bito</option>
                            <option value="credito">üí≥ Cart√£o de Cr√©dito</option>
                            <option value="transferencia">üè¶ Transfer√™ncia</option>
                            <option value="boleto">üìã Boleto</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
                        <textarea id="observacoes-despesa" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" rows="3" placeholder="Informa√ß√µes adicionais sobre a despesa..."></textarea>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="despesa-recorrente" class="w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">üîÑ Despesa recorrente</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="despesa-urgente" class="w-4 h-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">‚ö° Urgente</span>
                        </label>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelar-despesa" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-red-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors">
                            üí∏ Salvar Despesa
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module">
        document.addEventListener('DOMContentLoaded', function() {
            // Sistema de navega√ß√£o
            const navButtons = document.querySelectorAll('.btn-nav');
            const contentSections = document.querySelectorAll('.content-section');

            navButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const targetId = e.target.id.replace('btn-', '') + '-content';
                    
                    // Remover classe ativa de todos os bot√µes
                    navButtons.forEach(btn => {
                        btn.classList.remove('bg-empresa-azul', 'text-white');
                        btn.classList.add('bg-gray-100', 'text-gray-700');
                    });
                    
                    // Adicionar classe ativa ao bot√£o clicado
                    e.target.classList.remove('bg-gray-100', 'text-gray-700');
                    e.target.classList.add('bg-empresa-azul', 'text-white');
                    
                    // Ocultar todas as se√ß√µes
                    contentSections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    
                    // Mostrar se√ß√£o correspondente
                    document.getElementById(targetId).classList.remove('hidden');
                });
            });

            // ===== SISTEMA DE DADOS COM FIREBASE =====
            
            // Vari√°veis locais dos dados
            let dadosClientes = [];
            let dadosPrecos = [];
            let dadosMinerios = [];
            let dadosVendas = [];
            let dadosVeiculos = [];
            let dadosMotoristas = [];
            let dadosEstoque = [];
            let dadosPagamentos = [];
            let dadosDespesas = [];
            let modeloPrevisao = null;
            let historicoPreviso = [];
            let configEstoque = {"minimo": 1000};
            let configDia = {"veiculoPadrao": "", "motoristaPadrao": ""};
            let configAlertas = {
                "popupEstoqueBaixo": true,
                "popupCnhVencimento": true,
                "popupToxicologicoVencimento": true,
                "popupVendasAtraso": true,
                "popupVendasVencendo": true,
                "frequencia": 300000, // 5 minutos
                "timeout": 21600000,   // 6 horas
                "ultimosAlertas": {}   // Controle de quando cada alerta foi mostrado
            };
            
            // Estado da conex√£o
            let isOnline = navigator.onLine;
            let isFirebaseConnected = false;
            let userId = null;
            let syncQueue = []; // Fila de sincroniza√ß√£o para quando estiver offline
            
            // Classe para gerenciar Firebase
            class FirebaseManager {
                constructor() {
                    this.isInitialized = false;
                    this.listeners = new Map();
                    this.init();
                }
                
                async init() {
                    try {
                        // Aguardar Firebase estar dispon√≠vel
                        while (!window.firebaseDB) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                        
                        // Autenticar anonimamente
                        await window.firebaseAuthFunctions.signInAnonymously(window.firebaseAuth);
                        
                        // Configurar listener de autentica√ß√£o
                        window.firebaseAuthFunctions.onAuthStateChanged(window.firebaseAuth, (user) => {
                            if (user) {
                                userId = user.uid;
                                isFirebaseConnected = true;
                                this.setupRealtimeListeners();
                                this.loadInitialData();
                                this.processSyncQueue();
                                this.showConnectionStatus(true);
                            } else {
                                isFirebaseConnected = false;
                                this.showConnectionStatus(false);
                            }
                        });
                        
                        this.isInitialized = true;
                        console.log('üî• Firebase inicializado com sucesso!');
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao inicializar Firebase:', error);
                        this.showConnectionStatus(false, error.message);
                        // Continuar com funcionalidade offline
                        this.loadFromLocalStorage();
                    }
                }
                
                // Configurar listeners em tempo real
                setupRealtimeListeners() {
                    const collections = [
                        'clientes', 'minerios', 'motoristas', 'veiculos', 
                        'vendas', 'estoque', 'pagamentos', 'precos',
                        'configEstoque', 'configDia', 'configAlertas'
                    ];
                    
                    collections.forEach(collection => {
                        const dataRef = window.firebaseRefs.ref(window.firebaseDB, `sistema/${collection}`);
                        
                        const unsubscribe = window.firebaseRefs.onValue(dataRef, (snapshot) => {
                            const data = snapshot.val();
                            if (data) {
                                this.updateLocalData(collection, data);
                            }
                        }, (error) => {
                            console.error(`Erro ao escutar ${collection}:`, error);
                        });
                        
                        this.listeners.set(collection, unsubscribe);
                    });
                }
                
                // Atualizar dados locais quando receber do Firebase
                updateLocalData(collection, data) {
                    switch(collection) {
                        case 'clientes':
                            dadosClientes = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'minerios':
                            dadosMinerios = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'motoristas':
                            dadosMotoristas = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'veiculos':
                            dadosVeiculos = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'vendas':
                            dadosVendas = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'estoque':
                            dadosEstoque = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'pagamentos':
                            dadosPagamentos = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'precos':
                            dadosPrecos = Array.isArray(data) ? data : Object.values(data);
                            break;
                        case 'configEstoque':
                            configEstoque = data;
                            break;
                        case 'configDia':
                            configDia = data;
                            break;
                        case 'configAlertas':
                            configAlertas = data;
                            break;
                    }
                    
                    // Atualizar interface apenas se n√£o estamos salvando no momento
                    if (!this.isSaving) {
                        this.updateAllInterfaces();
                    }
                }
                
                // Carregar dados iniciais
                async loadInitialData() {
                    try {
                        const sistemaRef = window.firebaseRefs.ref(window.firebaseDB, 'sistema');
                        const snapshot = await window.firebaseRefs.get(sistemaRef);
                        
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            
                            // Atualizar todos os dados locais
                            Object.keys(data).forEach(collection => {
                                this.updateLocalData(collection, data[collection]);
                            });
                            
                            console.log('üì• Dados carregados do Firebase');
                        } else {
                            // Se n√£o h√° dados no Firebase, fazer upload dos dados locais
                            console.log('üì§ Fazendo upload inicial dos dados para o Firebase');
                            this.uploadLocalData();
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados iniciais:', error);
                        this.loadFromLocalStorage();
                    }
                }
                
                // Salvar dados no Firebase
                async saveToFirebase(collection, data) {
                    if (!isFirebaseConnected) {
                        // Adicionar √† fila de sincroniza√ß√£o
                        syncQueue.push({ collection, data, action: 'save', timestamp: Date.now() });
                        this.saveToLocalStorage();
                        return;
                    }
                    
                    try {
                        this.isSaving = true;
                        const dataRef = window.firebaseRefs.ref(window.firebaseDB, `sistema/${collection}`);
                        await window.firebaseRefs.set(dataRef, data);
                        
                        // Tamb√©m salvar localmente como backup
                        this.saveToLocalStorage();
                        
                    } catch (error) {
                        console.error(`‚ùå Erro ao salvar ${collection} no Firebase:`, error);
                        // Em caso de erro, salvar localmente
                        syncQueue.push({ collection, data, action: 'save', timestamp: Date.now() });
                        this.saveToLocalStorage();
                    } finally {
                        this.isSaving = false;
                    }
                }
                
                // Processar fila de sincroniza√ß√£o
                async processSyncQueue() {
                    if (!isFirebaseConnected || syncQueue.length === 0) return;
                    
                    console.log(`üîÑ Sincronizando ${syncQueue.length} itens pendentes...`);
                    
                    for (const item of syncQueue) {
                        try {
                            await this.saveToFirebase(item.collection, item.data);
                        } catch (error) {
                            console.error('‚ùå Erro na sincroniza√ß√£o:', error);
                            break; // Para a sincroniza√ß√£o se houver erro
                        }
                    }
                    
                    // Limpar fila ap√≥s sincroniza√ß√£o bem-sucedida
                    syncQueue = [];
                    localStorage.removeItem('syncQueue');
                    
                    this.showSyncStatus('‚úÖ Sincroniza√ß√£o conclu√≠da');
                }
                
                // Fazer upload de todos os dados locais
                async uploadLocalData() {
                    const allData = {
                        clientes: dadosClientes,
                        minerios: dadosMinerios,
                        motoristas: dadosMotoristas,
                        veiculos: dadosVeiculos,
                        vendas: dadosVendas,
                        estoque: dadosEstoque,
                        pagamentos: dadosPagamentos,
                        precos: dadosPrecos,
                        configEstoque: configEstoque,
                        configDia: configDia,
                        configAlertas: configAlertas
                    };
                    
                    for (const [collection, data] of Object.entries(allData)) {
                        await this.saveToFirebase(collection, data);
                    }
                }
                
                // Salvar no localStorage
                saveToLocalStorage() {
                    try {
                        localStorage.setItem('clientes', JSON.stringify(dadosClientes));
                        localStorage.setItem('precos', JSON.stringify(dadosPrecos));
                        localStorage.setItem('minerios', JSON.stringify(dadosMinerios));
                        localStorage.setItem('vendas', JSON.stringify(dadosVendas));
                        localStorage.setItem('veiculos', JSON.stringify(dadosVeiculos));
                        localStorage.setItem('motoristas', JSON.stringify(dadosMotoristas));
                        localStorage.setItem('estoque', JSON.stringify(dadosEstoque));
                        localStorage.setItem('pagamentos', JSON.stringify(dadosPagamentos));
                        localStorage.setItem('configEstoque', JSON.stringify(configEstoque));
                        localStorage.setItem('configDia', JSON.stringify(configDia));
                        localStorage.setItem('configAlertas', JSON.stringify(configAlertas));
                        localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
                    } catch (error) {
                        console.error('‚ùå Erro ao salvar no localStorage:', error);
                    }
                }
                
                // Carregar do localStorage
                loadFromLocalStorage() {
                    try {
                        const stored = {
                            clientes: localStorage.getItem('clientes'),
                            precos: localStorage.getItem('precos'),
                            minerios: localStorage.getItem('minerios'),
                            vendas: localStorage.getItem('vendas'),
                            veiculos: localStorage.getItem('veiculos'),
                            motoristas: localStorage.getItem('motoristas'),
                            estoque: localStorage.getItem('estoque'),
                            pagamentos: localStorage.getItem('pagamentos'),
                            configEstoque: localStorage.getItem('configEstoque'),
                            configDia: localStorage.getItem('configDia'),
                            configAlertas: localStorage.getItem('configAlertas'),
                            syncQueue: localStorage.getItem('syncQueue')
                        };
                        
                        if (stored.clientes) dadosClientes = JSON.parse(stored.clientes);
                        if (stored.precos) dadosPrecos = JSON.parse(stored.precos);
                        if (stored.minerios) dadosMinerios = JSON.parse(stored.minerios);
                        if (stored.vendas) dadosVendas = JSON.parse(stored.vendas);
                        if (stored.veiculos) dadosVeiculos = JSON.parse(stored.veiculos);
                        if (stored.motoristas) dadosMotoristas = JSON.parse(stored.motoristas);
                        if (stored.estoque) dadosEstoque = JSON.parse(stored.estoque);
                        if (stored.pagamentos) dadosPagamentos = JSON.parse(stored.pagamentos);
                        if (stored.configEstoque) configEstoque = JSON.parse(stored.configEstoque);
                        if (stored.configDia) configDia = JSON.parse(stored.configDia);
                        if (stored.configAlertas) configAlertas = JSON.parse(stored.configAlertas);
                        if (stored.syncQueue) syncQueue = JSON.parse(stored.syncQueue);
                        
                        console.log('üì± Dados carregados do armazenamento local');
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar do localStorage:', error);
                    }
                }
                
                // Atualizar todas as interfaces
                updateAllInterfaces() {
                    // Aguardar um pouco para evitar m√∫ltiplas atualiza√ß√µes simult√¢neas
                    if (this.updateTimeout) clearTimeout(this.updateTimeout);
                    this.updateTimeout = setTimeout(() => {
                        atualizarDashboard();
                        atualizarListaMinerios();
                        atualizarListaClientes();
                        atualizarListaVeiculos();
                        atualizarListaMotoristas();
                        atualizarListaVendas();
                        atualizarListaMovimentacoes();
                        atualizarListaCobrancas();
                        atualizarSelectsVenda();
                        atualizarSelectsCobranca();
                        atualizarSelectsRelatorio();
                        atualizarSelectsPrevisao();
                        atualizarResumoCobrancas();
                    }, 300);
                }
                
                // Mostrar status da conex√£o
                showConnectionStatus(connected, error = null) {
                    const statusDiv = document.getElementById('connection-status') || this.createStatusDiv();
                    
                    if (connected) {
                        statusDiv.innerHTML = 'üü¢ Online - Sincronizado';
                        statusDiv.className = 'fixed top-4 left-4 bg-green-100 text-green-800 px-3 py-2 rounded-lg text-sm border border-green-200 z-50';
                    } else {
                        statusDiv.innerHTML = `üî¥ Offline ${error ? '- ' + error : ''}`;
                        statusDiv.className = 'fixed top-4 left-4 bg-red-100 text-red-800 px-3 py-2 rounded-lg text-sm border border-red-200 z-50';
                    }
                    
                    // Auto-esconder ap√≥s 5 segundos se estiver online
                    if (connected) {
                        setTimeout(() => {
                            if (statusDiv && statusDiv.innerHTML.includes('Online')) {
                                statusDiv.style.opacity = '0.6';
                            }
                        }, 5000);
                    }
                }
                
                // Mostrar status de sincroniza√ß√£o
                showSyncStatus(message) {
                    const syncDiv = document.getElementById('sync-status') || this.createSyncStatusDiv();
                    syncDiv.textContent = message;
                    syncDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        syncDiv.style.display = 'none';
                    }, 3000);
                }
                
                // Criar div de status
                createStatusDiv() {
                    const div = document.createElement('div');
                    div.id = 'connection-status';
                    document.body.appendChild(div);
                    return div;
                }
                
                // Criar div de status de sincroniza√ß√£o
                createSyncStatusDiv() {
                    const div = document.createElement('div');
                    div.id = 'sync-status';
                    div.className = 'fixed top-16 left-4 bg-blue-100 text-blue-800 px-3 py-2 rounded-lg text-sm border border-blue-200 z-50';
                    div.style.display = 'none';
                    document.body.appendChild(div);
                    return div;
                }
            }
            
            // Instanciar o gerenciador Firebase
            const firebaseManager = new FirebaseManager();
            
            // Carregar dados do Firebase/localStorage na inicializa√ß√£o
            setTimeout(() => {
                if (firebaseManager.isInitialized && !isFirebaseConnected) {
                    firebaseManager.loadFromLocalStorage();
                    firebaseManager.updateAllInterfaces();
                }
            }, 1000);
            
            // Atualizar campo de configura√ß√£o
            const campoMinimo = document.getElementById('estoque-minimo');
            if (campoMinimo) {
                campoMinimo.value = configEstoque.minimo;
            }
            
            // Menu mobile
            const mobileNav = document.getElementById('mobile-nav');
            if (mobileNav) {
                mobileNav.addEventListener('change', function() {
                    const targetId = this.value + '-content';
                    
                    // Ocultar todas as se√ß√µes
                    contentSections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    
                    // Mostrar se√ß√£o correspondente
                    document.getElementById(targetId).classList.remove('hidden');
                });
            }

            // Fun√ß√£o para salvar dados (agora com Firebase)
            function salvarDados() {
                // Salvar cada cole√ß√£o no Firebase
                if (firebaseManager.isInitialized) {
                    firebaseManager.saveToFirebase('clientes', dadosClientes);
                    firebaseManager.saveToFirebase('precos', dadosPrecos);
                    firebaseManager.saveToFirebase('minerios', dadosMinerios);
                    firebaseManager.saveToFirebase('vendas', dadosVendas);
                    firebaseManager.saveToFirebase('veiculos', dadosVeiculos);
                    firebaseManager.saveToFirebase('motoristas', dadosMotoristas);
                    firebaseManager.saveToFirebase('estoque', dadosEstoque);
                    firebaseManager.saveToFirebase('pagamentos', dadosPagamentos);
                    firebaseManager.saveToFirebase('configEstoque', configEstoque);
                    firebaseManager.saveToFirebase('configDia', configDia);
                    firebaseManager.saveToFirebase('configAlertas', configAlertas);
                } else {
                    // Fallback para localStorage se Firebase n√£o estiver dispon√≠vel
                    firebaseManager.saveToLocalStorage();
                }
            }

            // Fun√ß√£o para atualizar o dashboard executivo
            function atualizarDashboard() {
                atualizarDataHora();
                atualizarPerformanceFinanceira();
                atualizarResumoOperacional();
                atualizarControleEstoque();
                atualizarAlertas();
                atualizarSelectsPadrao();
            }
            
            // Fun√ß√£o para atualizar data e hora
            function atualizarDataHora() {
                const agora = new Date();
                const data = agora.toLocaleDateString('pt-BR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                const hora = agora.toLocaleTimeString('pt-BR');
                
                document.getElementById('data-atual').textContent = data;
                document.getElementById('hora-atual').textContent = hora;
            }
            
            // Fun√ß√£o para atualizar performance financeira
            function atualizarPerformanceFinanceira() {
                const hoje = new Date().toISOString().split('T')[0];
                
                // Calcular receita total
                const receitaTotal = dadosVendas.reduce((sum, v) => sum + v.valorTotal, 0);
                
                // Calcular custos totais
                const custosTotal = dadosVendas.reduce((sum, v) => sum + (v.custoTotal || 0), 0);
                
                // Calcular lucro l√≠quido
                const lucroLiquido = receitaTotal - custosTotal;
                const margemLucro = receitaTotal > 0 ? (lucroLiquido / receitaTotal * 100) : 0;
                
                // Recebido hoje
                const recebidoHoje = dadosPagamentos
                    .filter(p => p.data.startsWith(hoje))
                    .reduce((sum, p) => sum + p.valorPago, 0);
                
                // A receber (saldo em aberto)
                const aReceber = dadosVendas.reduce((sum, v) => sum + v.saldo, 0);
                
                // Atualizar interface
                document.getElementById('receita-total').textContent = `R$ ${receitaTotal.toFixed(2)}`;
                document.getElementById('custos-totais').textContent = `R$ ${custosTotal.toFixed(2)}`;
                document.getElementById('lucro-liquido').textContent = `R$ ${lucroLiquido.toFixed(2)}`;
                document.getElementById('margem-lucro').textContent = `üìä ${margemLucro.toFixed(1)}% margem`;
                document.getElementById('recebido-hoje').textContent = `R$ ${recebidoHoje.toFixed(2)}`;
                document.getElementById('a-receber').textContent = `R$ ${aReceber.toFixed(2)}`;
                
                // Atualizar cores baseado no lucro
                const lucroElement = document.getElementById('lucro-liquido');
                if (lucroLiquido > 0) {
                    lucroElement.className = 'text-2xl font-bold text-green-600';
                } else if (lucroLiquido < 0) {
                    lucroElement.className = 'text-2xl font-bold text-red-600';
                } else {
                    lucroElement.className = 'text-2xl font-bold text-gray-600';
                }
            }
            
            // Fun√ß√£o para atualizar resumo operacional
            function atualizarResumoOperacional() {
                const hoje = new Date().toISOString().split('T')[0];
                
                // Cargas de hoje
                const cargasHoje = dadosVendas.filter(v => v.dataVenda.startsWith(hoje)).length;
                
                // Peso total de hoje
                const pesoTotalHoje = dadosVendas
                    .filter(v => v.dataVenda.startsWith(hoje))
                    .reduce((sum, v) => sum + v.pesoCliente, 0);
                
                // Clientes ativos
                const clientesAtivos = dadosClientes.filter(c => c.status === 'ativo').length;
                
                // Frota ativa
                const frotaAtiva = dadosVeiculos.filter(v => v.status === 'ativo').length;
                
                // Atualizar interface
                document.getElementById('cargas-hoje').textContent = cargasHoje;
                document.getElementById('peso-total-hoje').textContent = `${pesoTotalHoje.toFixed(1)}t`;
                document.getElementById('clientes-ativos').textContent = clientesAtivos;
                document.getElementById('frota-ativa').textContent = frotaAtiva;
            }
            
            // Fun√ß√£o para atualizar controle de estoque
            function atualizarControleEstoque() {
                // Calcular saldo do estoque
                let saldoEstoque = 0;
                let totalCreditos = 0;
                let totalDebitos = 0;
                
                dadosEstoque.forEach(mov => {
                    if (mov.tipo === 'credito') {
                        saldoEstoque += mov.valor;
                        totalCreditos += mov.valor;
                    } else {
                        saldoEstoque -= mov.valor;
                        totalDebitos += mov.valor;
                    }
                });
                
                // Atualizar interface
                document.getElementById('estoque-total-valor').textContent = `R$ ${saldoEstoque.toFixed(2)}`;
                document.getElementById('total-creditos-dash').textContent = `R$ ${totalCreditos.toFixed(2)}`;
                document.getElementById('total-debitos-dash').textContent = `R$ ${totalDebitos.toFixed(2)}`;
                
                // Atualizar select de materiais e calcular estoque aproximado
                atualizarSelectMaterialEstoque(saldoEstoque);
                
                // Compatibilidade com dashboard antigo
                if (document.getElementById('saldo-estoque')) {
                    document.getElementById('saldo-estoque').textContent = saldoEstoque.toFixed(2);
                }
                if (document.getElementById('count-estoque')) {
                    document.getElementById('count-estoque').textContent = `R$ ${saldoEstoque.toFixed(2)}`;
                }
            }
            
            // Fun√ß√£o para atualizar select de material no estoque
            function atualizarSelectMaterialEstoque(saldoEstoque) {
                const selectMaterial = document.getElementById('select-material-estoque');
                if (!selectMaterial) return;
                
                // Limpar e popular select
                selectMaterial.innerHTML = '<option value="">Selecione um material</option>';
                dadosMinerios.filter(m => m.status === 'ativo').forEach(material => {
                    selectMaterial.innerHTML += `<option value="${material.id}">${material.nome} - R$ ${material.precoTonelada.toFixed(2)}/t</option>`;
                });
                
                // Calcular estoque aproximado para o material selecionado
                calcularEstoqueMaterial(saldoEstoque);
            }
            
            // Fun√ß√£o para calcular estoque aproximado do material
            function calcularEstoqueMaterial(saldoEstoque) {
                const selectMaterial = document.getElementById('select-material-estoque');
                const infoMaterial = document.getElementById('info-material-estoque');
                const estoqueToneladas = document.getElementById('estoque-material-toneladas');
                
                if (!selectMaterial || !selectMaterial.value) {
                    estoqueToneladas.textContent = '0 toneladas';
                    infoMaterial.textContent = 'Selecione um material para calcular';
                    return;
                }
                
                const materialId = parseInt(selectMaterial.value);
                const material = dadosMinerios.find(m => m.id === materialId);
                
                if (!material) {
                    estoqueToneladas.textContent = '0 toneladas';
                    infoMaterial.textContent = 'Material n√£o encontrado';
                    return;
                }
                
                // Calcular quantas toneladas seria poss√≠vel comprar
                const toneladasPossivel = saldoEstoque > 0 ? (saldoEstoque / material.precoTonelada) : 0;
                
                // Calcular volume em m¬≥ se houver densidade
                let infoVolume = '';
                if (material.densidade && material.densidade > 0) {
                    const volumeM3 = toneladasPossivel / material.densidade;
                    infoVolume = ` (‚âà ${volumeM3.toFixed(1)} m¬≥)`;
                }
                
                estoqueToneladas.textContent = `${toneladasPossivel.toFixed(1)} toneladas`;
                infoMaterial.innerHTML = `
                    <div>${material.nome} - R$ ${material.precoTonelada.toFixed(2)}/t${infoVolume}</div>
                    <div class="text-gray-400">Se comprar tudo deste material</div>
                `;
            }
            
            // Fun√ß√£o para atualizar alertas
            function atualizarAlertas() {
                const alertasContainer = document.getElementById('alertas-dashboard');
                let alertas = [];
                
                // Verificar estoque baixo
                let saldoEstoque = dadosEstoque.reduce((sum, mov) => 
                    sum + (mov.tipo === 'credito' ? mov.valor : -mov.valor), 0);
                
                if (saldoEstoque < configEstoque.minimo) {
                    alertas.push({
                        tipo: 'warning',
                        icone: '‚ö†Ô∏è',
                        mensagem: `Estoque baixo: R$ ${saldoEstoque.toFixed(2)} (m√≠nimo: R$ ${configEstoque.minimo.toFixed(2)})`
                    });
                }
                
                // Verificar cobran√ßas em atraso
                const vendasEmAtraso = dadosVendas.filter(v => {
                    if (v.saldo > 0 && v.prazoDias > 0) {
                        const dataVencimento = new Date(v.dataVenda);
                        dataVencimento.setDate(dataVencimento.getDate() + v.prazoDias);
                        return dataVencimento < new Date();
                    }
                    return false;
                });
                
                if (vendasEmAtraso.length > 0) {
                    alertas.push({
                        tipo: 'danger',
                        icone: 'üö®',
                        mensagem: `${vendasEmAtraso.length} venda(s) em atraso no pagamento`
                    });
                }
                
                // Verificar vencimento de CNH
                const cnhsVencendo = dadosMotoristas.filter(m => {
                    if (m.vencimentoCnh) {
                        const vencimento = new Date(m.vencimentoCnh);
                        const hoje = new Date();
                        const diasParaVencer = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                        return diasParaVencer <= 30 && diasParaVencer > 0;
                    }
                    return false;
                });
                
                if (cnhsVencendo.length > 0) {
                    alertas.push({
                        tipo: 'warning',
                        icone: 'üìã',
                        mensagem: `${cnhsVencendo.length} CNH(s) vencendo em 30 dias`
                    });
                }
                
                // Se n√£o h√° alertas, mostrar status OK
                if (alertas.length === 0) {
                    alertas.push({
                        tipo: 'success',
                        icone: '‚úÖ',
                        mensagem: 'Sistema operacional - Tudo funcionando perfeitamente'
                    });
                }
                
                // Renderizar alertas
                alertasContainer.innerHTML = alertas.map(alerta => {
                    const cores = {
                        success: 'bg-green-50 border-green-200 text-green-700',
                        warning: 'bg-yellow-50 border-yellow-200 text-yellow-700',
                        danger: 'bg-red-50 border-red-200 text-red-700'
                    };
                    
                    return `
                        <div class="${cores[alerta.tipo]} border p-3 rounded-lg">
                            <div class="text-sm">${alerta.icone} ${alerta.mensagem}</div>
                        </div>
                    `;
                }).join('');
            }
            
            // Fun√ß√£o para atualizar selects de padr√£o do dia
            function atualizarSelectsPadrao() {
                // Atualizar select de ve√≠culos
                const selectVeiculo = document.getElementById('veiculo-padrao-dia');
                selectVeiculo.innerHTML = '<option value="">Selecione o ve√≠culo padr√£o</option>';
                dadosVeiculos.filter(v => v.status === 'ativo').forEach(veiculo => {
                    selectVeiculo.innerHTML += `<option value="${veiculo.placa}" ${configDia.veiculoPadrao === veiculo.placa ? 'selected' : ''}>${veiculo.placa} - ${veiculo.modelo}</option>`;
                });
                
                // Atualizar select de motoristas
                const selectMotorista = document.getElementById('motorista-padrao-dia');
                selectMotorista.innerHTML = '<option value="">Selecione o motorista padr√£o</option>';
                dadosMotoristas.filter(m => m.status === 'ativo').forEach(motorista => {
                    selectMotorista.innerHTML += `<option value="${motorista.nome}" ${configDia.motoristaPadrao === motorista.nome ? 'selected' : ''}>${motorista.nome}</option>`;
                });
            }

            // Event listeners para formul√°rios
            
            // Event listener para mostrar/ocultar campo de densidade personalizada
            document.getElementById('densidade-material').addEventListener('change', function() {
                const campoDensidadeCustom = document.getElementById('campo-densidade-custom');
                if (this.value === 'custom') {
                    campoDensidadeCustom.classList.remove('hidden');
                } else {
                    campoDensidadeCustom.classList.add('hidden');
                }
                calcularPrecoMetro();
            });
            
            // Event listeners para calcular pre√ßo por m¬≥ automaticamente
            document.getElementById('preco-tonelada').addEventListener('input', calcularPrecoMetro);
            document.getElementById('densidade-custom').addEventListener('input', calcularPrecoMetro);
            
            // Fun√ß√£o para calcular pre√ßo por m¬≥ baseado na densidade
            function calcularPrecoMetro() {
                const precoTonelada = parseFloat(document.getElementById('preco-tonelada').value) || 0;
                let densidade = 0;
                
                const densidadeSelect = document.getElementById('densidade-material').value;
                if (densidadeSelect === 'custom') {
                    densidade = parseFloat(document.getElementById('densidade-custom').value) || 0;
                } else if (densidadeSelect) {
                    densidade = parseFloat(densidadeSelect) || 0;
                }
                
                const precoMetro = densidade > 0 ? precoTonelada * densidade : 0;
                document.getElementById('preco-metro-calculado').value = precoMetro > 0 ? `R$ ${precoMetro.toFixed(2)}` : 'R$ 0,00';
            }
            
            // Formul√°rio de Min√©rios
            document.getElementById('form-minerio').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Obter densidade
                let densidade = 0;
                const densidadeSelect = document.getElementById('densidade-material').value;
                
                if (densidadeSelect === 'custom') {
                    densidade = parseFloat(document.getElementById('densidade-custom').value) || 0;
                } else if (densidadeSelect) {
                    densidade = parseFloat(densidadeSelect) || 0;
                }
                
                // Calcular pre√ßo por m¬≥ automaticamente
                const precoTonelada = parseFloat(document.getElementById('preco-tonelada').value) || 0;
                const precoMetro = densidade > 0 ? precoTonelada * densidade : 0;
                
                const novoMinerio = {
                    id: Date.now(),
                    nome: document.getElementById('nome-minerio').value,
                    categoria: document.getElementById('categoria-minerio').value,
                    precoTonelada: precoTonelada,
                    precoMetro: precoMetro,
                    densidade: densidade,
                    unidadePrincipal: document.getElementById('unidade-principal').value,
                    status: document.getElementById('status-minerio').value,
                    observacoes: document.getElementById('observacoes-minerio').value,
                    dataCadastro: new Date().toISOString()
                };
                
                dadosMinerios.push(novoMinerio);
                salvarDados();
                atualizarDashboard();
                atualizarListaMinerios();
                atualizarSelectsVenda();
                
                // Limpar formul√°rio
                this.reset();
                document.getElementById('campo-densidade-custom').classList.add('hidden');
                document.getElementById('preco-metro-calculado').value = 'R$ 0,00';
                
                alert('‚úÖ Material cadastrado com sucesso!');
            });

            // Formul√°rio de Clientes
            document.getElementById('form-cliente').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const novoCliente = {
                    id: Date.now(),
                    nome: document.getElementById('nome-cliente').value,
                    cnpj: document.getElementById('cnpj-cliente').value,
                    telefone: document.getElementById('telefone-cliente').value,
                    endereco: document.getElementById('endereco-cliente').value,
                    distancia: parseFloat(document.getElementById('distancia-cliente').value) || 0,
                    status: document.getElementById('status-cliente').value,
                    dataCadastro: new Date().toISOString()
                };
                
                dadosClientes.push(novoCliente);
                salvarDados();
                atualizarDashboard();
                atualizarListaClientes();
                atualizarSelectsVenda();
                
                // Limpar formul√°rio
                this.reset();
                
                alert('‚úÖ Cliente cadastrado com sucesso!');
            });

            // Formul√°rio de Ve√≠culos
            document.getElementById('form-veiculo').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const novoVeiculo = {
                    id: Date.now(),
                    placa: document.getElementById('placa-veiculo').value,
                    modelo: document.getElementById('modelo-veiculo').value,
                    motorista: document.getElementById('motorista-veiculo').value,
                    tara: parseInt(document.getElementById('tara-veiculo').value) || 0,
                    status: document.getElementById('status-veiculo').value,
                    observacoes: document.getElementById('observacoes-veiculo').value,
                    dataCadastro: new Date().toISOString()
                };
                
                dadosVeiculos.push(novoVeiculo);
                salvarDados();
                atualizarDashboard();
                atualizarListaVeiculos();
                atualizarSelectsVenda();
                
                // Limpar formul√°rio
                this.reset();
                
                alert('‚úÖ Ve√≠culo cadastrado com sucesso!');
            });

            // Formul√°rio de Motoristas
            document.getElementById('form-motorista').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const novoMotorista = {
                    id: Date.now(),
                    nome: document.getElementById('nome-motorista').value,
                    cnh: document.getElementById('cnh-motorista').value,
                    vencimentoCnh: document.getElementById('vencimento-cnh').value,
                    vencimentoToxicologico: document.getElementById('vencimento-toxicologico').value,
                    telefone: document.getElementById('telefone-motorista').value,
                    status: document.getElementById('status-motorista').value,
                    observacoes: document.getElementById('observacoes-motorista').value,
                    dataCadastro: new Date().toISOString()
                };
                
                dadosMotoristas.push(novoMotorista);
                salvarDados();
                atualizarDashboard();
                atualizarListaMotoristas();
                atualizarSelectsVenda();
                
                // Limpar formul√°rio
                this.reset();
                
                alert('‚úÖ Motorista cadastrado com sucesso!');
            });

            // Formul√°rio de Venda
            document.getElementById('form-venda').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const materialNome = document.getElementById('material-venda').value;
                const clienteNome = document.getElementById('cliente-venda').value;
                const pesoPedreira = parseFloat(document.getElementById('peso-pedreira').value) || 0;
                const pesoCliente = parseFloat(document.getElementById('peso-cliente').value) || 0;
                
                // Encontrar o material selecionado
                const materialSelecionado = dadosMinerios.find(m => m.nome === materialNome);
                if (!materialSelecionado) {
                    alert('‚ö†Ô∏è Material n√£o encontrado!');
                    return;
                }
                
                // DETERMINAR: Pre√ßo individual por tonelada para este cliente
                let precoClienteTonelada = materialSelecionado.precoTonelada; // Pre√ßo padr√£o do material
                
                // PRIORIDADE: Verificar se existe pre√ßo individual na tabela de pre√ßos espec√≠ficos
                const precoEspecificoTon = dadosPrecos.find(p => 
                    p.cliente === clienteNome && 
                    p.material === materialNome && 
                    p.tipo === 'tonelada'
                );
                
                const precoEspecificoM3 = dadosPrecos.find(p => 
                    p.cliente === clienteNome && 
                    p.material === materialNome && 
                    p.tipo === 'metro'
                );
                
                if (precoEspecificoTon) {
                    // Usar pre√ßo espec√≠fico por tonelada
                    precoClienteTonelada = precoEspecificoTon.preco;
                } else if (precoEspecificoM3 && materialSelecionado.densidade > 0) {
                    // Converter pre√ßo por m¬≥ para pre√ßo por tonelada: Pre√ßo m¬≥ √∑ Densidade = Pre√ßo tonelada
                    precoClienteTonelada = precoEspecificoM3.preco / materialSelecionado.densidade;
                }
                
                // CORRE√á√ÉO: Usar o pre√ßo de tonelada do material como custo
                const custoPorTonelada = materialSelecionado.precoTonelada; // Custo real do material
                const custoTotal = pesoPedreira * custoPorTonelada;
                
                // F√ìRMULA CORRETA: Peso Cliente √ó Pre√ßo Individual = Total da Venda
                const valorVenda = pesoCliente * precoClienteTonelada;
                const lucro = valorVenda - custoTotal;
                
                // Encontrar o ve√≠culo selecionado e seu motorista
                const veiculoSelecionado = dadosVeiculos.find(v => v.placa === document.getElementById('veiculo-venda').value);
                const motoristaNome = veiculoSelecionado ? veiculoSelecionado.motorista : '-';
                
                // Determinar status de pagamento
                const tipoPagamento = document.getElementById('tipo-pagamento').value;
                let statusPagamento = 'aberto';
                let valorPago = 0;
                let saldo = valorVenda;
                
                if (tipoPagamento === 'pix' || tipoPagamento === 'dinheiro' || tipoPagamento === 'cheque') {
                    statusPagamento = 'pago';
                    valorPago = valorVenda;
                    saldo = 0;
                }
                
                const novaVenda = {
                    id: Date.now(),
                    material: materialNome,
                    cliente: clienteNome,
                    veiculo: document.getElementById('veiculo-venda').value,
                    motorista: motoristaNome,
                    pesoPedreira: pesoPedreira,
                    pesoCliente: pesoCliente,
                    valorTotal: valorVenda,
                    valorPago: valorPago,
                    saldo: saldo,
                    custoTotal: custoTotal,
                    lucro: lucro,
                    precoTonelada: precoClienteTonelada,
                    tipoPagamento: tipoPagamento,
                    prazoDias: parseInt(document.getElementById('prazo-dias').value) || 0,
                    observacoes: document.getElementById('observacoes-venda').value,
                    dataVenda: new Date().toISOString(),
                    statusPagamento: statusPagamento
                };
                
                dadosVendas.push(novaVenda);
                
                // Se foi pago √† vista, registrar o pagamento
                if (statusPagamento === 'pago') {
                    const pagamento = {
                        id: Date.now() + 1,
                        cliente: clienteNome,
                        valorPago: valorVenda,
                        valorAplicado: valorVenda,
                        valorResidual: 0,
                        formaPagamento: tipoPagamento,
                        data: new Date().toISOString(),
                        observacoes: 'Pagamento √† vista na venda',
                        vendasAfetadas: [novaVenda.id]
                    };
                    dadosPagamentos.push(pagamento);
                    
                    // Adicionar cr√©dito ao estoque
                    const movimentacaoEstoque = {
                        id: Date.now() + 2,
                        tipo: 'credito',
                        valor: valorVenda,
                        descricao: `Venda para ${clienteNome} - ${materialNome}`,
                        observacoes: `Pagamento √† vista - ${tipoPagamento}`,
                        data: new Date().toISOString()
                    };
                    dadosEstoque.push(movimentacaoEstoque);
                }
                
                // Sempre registrar o d√©bito do custo no estoque
                const movimentacaoCusto = {
                    id: Date.now() + 3,
                    tipo: 'debito',
                    valor: custoTotal,
                    descricao: `Custo de material - ${materialNome}`,
                    observacoes: `Custo da venda para ${clienteNome} - ${pesoPedreira}t`,
                    data: new Date().toISOString()
                };
                dadosEstoque.push(movimentacaoCusto);
                
                salvarDados();
                atualizarDashboard();
                atualizarListaVendas();
                atualizarListaCobrancas();
                atualizarSelectsCobranca();
                atualizarResumoCobrancas();
                atualizarListaMovimentacoes();
                
                // Limpar formul√°rio
                this.reset();
                document.getElementById('info-motorista').classList.add('hidden');
                
                // Limpar campos de c√°lculo
                document.getElementById('custo-tonelada').textContent = '0,00';
                document.getElementById('custo-total').textContent = '0,00';
                document.getElementById('preco-cliente-ton').textContent = '0,00';
                document.getElementById('valor-venda').textContent = '0,00';
                document.getElementById('preview-venda').textContent = '0,00';
                document.getElementById('preview-custo').textContent = '0,00';
                document.getElementById('preview-lucro').textContent = '0,00';
                
                alert(`‚úÖ Venda registrada com sucesso!\n\nüí∞ Valor: R$ ${valorVenda.toFixed(2)}\nüìä Lucro: R$ ${lucro.toFixed(2)}\nüí≥ Pagamento: ${statusPagamento === 'pago' ? '√Ä vista' : 'A prazo'}`);
            });

            // Formul√°rio de Cr√©dito Estoque
            document.getElementById('form-credito-estoque').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const novoCredito = {
                    id: Date.now(),
                    tipo: 'credito',
                    valor: parseFloat(document.getElementById('valor-credito').value) || 0,
                    descricao: document.getElementById('descricao-credito').value,
                    observacoes: document.getElementById('observacoes-credito').value,
                    data: new Date().toISOString()
                };
                
                dadosEstoque.push(novoCredito);
                salvarDados();
                atualizarDashboard();
                atualizarListaMovimentacoes();
                
                // Limpar formul√°rio
                this.reset();
                
                alert('‚úÖ Cr√©dito adicionado ao estoque!');
            });

            // Fun√ß√µes para atualizar listas
            function atualizarListaMinerios() {
                const tbody = document.getElementById('lista-minerios');
                if (dadosMinerios.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">üì¶ Nenhum material cadastrado ainda</td></tr>';
                    return;
                }
                
                tbody.innerHTML = dadosMinerios.map(minerio => `
                    <tr>
                        <td class="px-4 py-4 text-sm font-medium text-gray-900">${minerio.nome}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${minerio.categoria}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">R$ ${minerio.precoTonelada.toFixed(2)}</td>
                        <td class="px-4 py-4 text-sm text-empresa-azul font-medium">R$ ${minerio.precoMetro.toFixed(2)}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${minerio.densidade ? minerio.densidade.toFixed(2) + ' t/m¬≥' : '-'}</td>
                        <td class="px-4 py-4 text-sm">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${minerio.status === 'ativo' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${minerio.status}
                            </span>
                        </td>
                        <td class="px-4 py-4 text-sm text-gray-500">
                            <button onclick="editarMinerio(${minerio.id})" class="text-blue-600 hover:text-blue-900 mr-3">‚úèÔ∏è</button>
                            <button onclick="excluirMinerio(${minerio.id})" class="text-red-600 hover:text-red-900">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            }

            function atualizarListaClientes() {
                const tbody = document.getElementById('lista-clientes');
                if (dadosClientes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">üë• Nenhum cliente cadastrado ainda</td></tr>';
                    return;
                }
                
                tbody.innerHTML = dadosClientes.map(cliente => `
                    <tr>
                        <td class="px-4 py-4 text-sm font-medium text-gray-900">${cliente.nome}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">-</td>
                        <td class="px-4 py-4 text-sm text-gray-500">-</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${cliente.telefone}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${cliente.endereco}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${cliente.distancia} km</td>
                        <td class="px-4 py-4 text-sm text-gray-500">
                            <button onclick="editarCliente(${cliente.id})" class="text-blue-600 hover:text-blue-900 mr-2" title="Editar cliente">‚úèÔ∏è</button>
                            <button onclick="editarPrecosCliente('${cliente.nome}')" class="text-green-600 hover:text-green-900 mr-2" title="Pre√ßos espec√≠ficos">üí∞</button>
                            <button onclick="excluirCliente(${cliente.id})" class="text-red-600 hover:text-red-900" title="Excluir cliente">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            }

            function atualizarListaVeiculos() {
                const tbody = document.getElementById('lista-veiculos');
                if (dadosVeiculos.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">üöõ Nenhum ve√≠culo cadastrado ainda</td></tr>';
                    return;
                }
                
                tbody.innerHTML = dadosVeiculos.map(veiculo => `
                    <tr>
                        <td class="px-4 py-4 text-sm font-medium text-gray-900">${veiculo.placa}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${veiculo.modelo}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${veiculo.motorista || '-'}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${veiculo.tara} kg</td>
                        <td class="px-4 py-4 text-sm">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${veiculo.status === 'ativo' ? 'bg-green-100 text-green-800' : veiculo.status === 'manutencao' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                ${veiculo.status}
                            </span>
                        </td>
                        <td class="px-4 py-4 text-sm text-gray-500">
                            <button onclick="editarVeiculo(${veiculo.id})" class="text-blue-600 hover:text-blue-900 mr-2" title="Editar ve√≠culo">‚úèÔ∏è</button>
                            <button onclick="editarMotoristaVeiculo(${veiculo.id})" class="text-green-600 hover:text-green-900 mr-2" title="Trocar motorista">üë®‚Äçüíº</button>
                            <button onclick="excluirVeiculo(${veiculo.id})" class="text-red-600 hover:text-red-900" title="Excluir ve√≠culo">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            }

            function atualizarListaMotoristas() {
                const tbody = document.getElementById('lista-motoristas');
                if (dadosMotoristas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="px-4 py-8 text-center text-gray-500">üë®‚Äçüíº Nenhum motorista cadastrado ainda</td></tr>';
                    return;
                }
                
                tbody.innerHTML = dadosMotoristas.map(motorista => `
                    <tr>
                        <td class="px-4 py-4 text-sm font-medium text-gray-900">${motorista.nome}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${motorista.cnh || '-'}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${motorista.vencimentoCnh || '-'}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${motorista.vencimentoToxicologico || '-'}</td>
                        <td class="px-4 py-4 text-sm text-gray-500">${motorista.telefone}</td>
                        <td class="px-4 py-4 text-sm">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${motorista.status === 'ativo' ? 'bg-green-100 text-green-800' : motorista.status === 'afastado' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                ${motorista.status}
                            </span>
                        </td>
                        <td class="px-4 py-4 text-sm text-gray-500">
                            <span class="text-green-600">‚úÖ OK</span>
                        </td>
                        <td class="px-4 py-4 text-sm text-gray-500">
                            <button onclick="editarMotorista(${motorista.id})" class="text-blue-600 hover:text-blue-900 mr-3">‚úèÔ∏è</button>
                            <button onclick="excluirMotorista(${motorista.id})" class="text-red-600 hover:text-red-900">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            }

            function atualizarListaVendas() {
                const tbody = document.getElementById('lista-vendas');
                if (dadosVendas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="10" class="px-4 py-8 text-center text-gray-500">üí∞ Nenhuma venda registrada ainda</td></tr>';
                    return;
                }
                
                tbody.innerHTML = dadosVendas.map(venda => {
                    const custoExibir = venda.custoTotal || 0;
                    const lucroExibir = venda.lucro || 0;
                    const lucroClass = lucroExibir > 0 ? 'text-green-600' : lucroExibir < 0 ? 'text-red-600' : 'text-gray-500';
                    
                    return `
                        <tr>
                            <td class="px-4 py-4 text-sm text-gray-500">${new Date(venda.dataVenda).toLocaleDateString()}</td>
                            <td class="px-4 py-4 text-sm font-medium text-gray-900">${venda.cliente}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">${venda.material}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">${venda.veiculo}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">${venda.motorista || '-'}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">${venda.pesoPedreira}t / ${venda.pesoCliente}t</td>
                            <td class="px-4 py-4 text-sm font-medium text-empresa-azul">R$ ${venda.valorTotal.toFixed(2)}</td>
                            <td class="px-4 py-4 text-sm ${lucroClass}">R$ ${lucroExibir.toFixed(2)}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">
                                <span class="px-2 py-1 text-xs rounded ${venda.statusPagamento === 'pago' ? 'bg-green-100 text-green-800' : venda.statusPagamento === 'parcial' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                    ${venda.tipoPagamento}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-sm text-gray-500">
                                <button onclick="verDetalhesVenda(${venda.id})" class="text-blue-600 hover:text-blue-900 mr-2" title="Ver detalhes">üëÅÔ∏è</button>
                                <button onclick="excluirVenda(${venda.id})" class="text-red-600 hover:text-red-900">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            function atualizarListaMovimentacoes() {
                const tbody = document.getElementById('lista-movimentacoes');
                if (dadosEstoque.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">üì¶ Nenhuma movimenta√ß√£o registrada ainda</td></tr>';
                    return;
                }
                
                let saldoAcumulado = 0;
                tbody.innerHTML = dadosEstoque.map(mov => {
                    saldoAcumulado += mov.tipo === 'credito' ? mov.valor : -mov.valor;
                    return `
                        <tr>
                            <td class="px-4 py-4 text-sm text-gray-500">${new Date(mov.data).toLocaleDateString()}</td>
                            <td class="px-4 py-4 text-sm">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${mov.tipo === 'credito' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${mov.tipo === 'credito' ? '‚ûï Cr√©dito' : '‚ûñ D√©bito'}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-sm text-gray-500">${mov.descricao}</td>
                            <td class="px-4 py-4 text-sm ${mov.tipo === 'credito' ? 'text-green-600' : 'text-red-600'}">
                                ${mov.tipo === 'credito' ? '+' : '-'} R$ ${mov.valor.toFixed(2)}
                            </td>
                            <td class="px-4 py-4 text-sm font-medium text-gray-900">R$ ${saldoAcumulado.toFixed(2)}</td>
                        </tr>
                    `;
                }).join('');
            }

            // ===== FUN√á√ïES DE DESPESAS =====
            
            function atualizarResumoDespesas() {
                const hoje = new Date();
                const inicioMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                const inicioSemana = new Date(hoje.setDate(hoje.getDate() - hoje.getDay()));
                const inicioHoje = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
                
                const despesasMes = dadosDespesas.filter(d => new Date(d.data) >= inicioMes);
                const despesasSemana = dadosDespesas.filter(d => new Date(d.data) >= inicioSemana);
                const despesasHoje = dadosDespesas.filter(d => {
                    const dataDespesa = new Date(d.data);
                    return dataDespesa >= inicioHoje;
                });
                
                const totalMes = despesasMes.reduce((total, d) => total + d.valor, 0);
                const totalSemana = despesasSemana.reduce((total, d) => total + d.valor, 0);
                const totalHoje = despesasHoje.reduce((total, d) => total + d.valor, 0);
                
                document.getElementById('despesas-total-mes').textContent = totalMes.toFixed(2).replace('.', ',');
                document.getElementById('despesas-semana').textContent = totalSemana.toFixed(2).replace('.', ',');
                document.getElementById('despesas-hoje').textContent = totalHoje.toFixed(2).replace('.', ',');
                document.getElementById('despesas-quantidade').textContent = dadosDespesas.length;
            }
            
            function atualizarListaDespesas() {
                const tbody = document.getElementById('lista-despesas');
                if (dadosDespesas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">üí∏ Nenhuma despesa registrada ainda</td></tr>';
                    return;
                }
                
                const despesasOrdenadas = [...dadosDespesas].sort((a, b) => new Date(b.data) - new Date(a.data));
                
                tbody.innerHTML = despesasOrdenadas.map(despesa => {
                    const iconeCategoria = {
                        'combustivel': '‚õΩ',
                        'manutencao': 'üîß',
                        'alimentacao': 'üçΩÔ∏è',
                        'pedagio': 'üõ£Ô∏è',
                        'seguro': 'üõ°Ô∏è',
                        'impostos': 'üìã',
                        'equipamentos': '‚öôÔ∏è',
                        'outros': 'üìù'
                    };
                    
                    const statusClass = despesa.urgente ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800';
                    const statusText = despesa.urgente ? '‚ö° Urgente' : '‚úÖ Normal';
                    
                    return `
                        <tr class="${despesa.urgente ? 'bg-red-50' : ''}">
                            <td class="px-4 py-4 text-sm text-gray-500">${new Date(despesa.data).toLocaleDateString()}</td>
                            <td class="px-4 py-4 text-sm">
                                <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">
                                    ${iconeCategoria[despesa.categoria]} ${despesa.categoria.charAt(0).toUpperCase() + despesa.categoria.slice(1)}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-sm text-gray-900">${despesa.descricao}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">${despesa.veiculo || '-'}</td>
                            <td class="px-4 py-4 text-sm font-medium text-red-600">R$ ${despesa.valor.toFixed(2).replace('.', ',')}</td>
                            <td class="px-4 py-4 text-sm">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">
                                    ${statusText}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-sm text-gray-500">
                                <button onclick="verDetalhesDespesa(${despesa.id})" class="text-blue-600 hover:text-blue-900 mr-2" title="Ver detalhes">üëÅÔ∏è</button>
                                <button onclick="excluirDespesa(${despesa.id})" class="text-red-600 hover:text-red-900" title="Excluir">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            function atualizarSelectsVeiculosDespesa() {
                const select = document.getElementById('veiculo-despesa');
                const filtroSelect = document.getElementById('filtro-veiculo-despesa');
                
                const options = dadosVeiculos.map(veiculo => 
                    `<option value="${veiculo.placa}">${veiculo.placa} - ${veiculo.modelo}</option>`
                ).join('');
                
                select.innerHTML = '<option value="">N√£o espec√≠fico</option>' + options;
                filtroSelect.innerHTML = '<option value="">Todos os ve√≠culos</option>' + options;
            }
            
            async function salvarDespesa(despesaData) {
                try {
                    if (navigator.onLine && window.offlineManager) {
                        // Online: tentar salvar no Firebase e offline como backup
                        await window.offlineManager.saveDespesaOffline(despesaData);
                    } else {
                        // Offline: salvar apenas localmente
                        await window.offlineManager.saveDespesaOffline(despesaData);
                    }
                    
                    // Adicionar aos dados locais
                    dadosDespesas.push(despesaData);
                    
                    // Atualizar interface
                    atualizarResumoDespesas();
                    atualizarListaDespesas();
                    salvarDados();
                    
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar despesa:', error);
                    return false;
                }
            }

            // Fun√ß√µes globais para edi√ß√£o/exclus√£o
            window.editarMinerio = function(id) {
                alert('Fun√ß√£o de edi√ß√£o em desenvolvimento');
            };

            window.excluirMinerio = function(id) {
                if (confirm('Tem certeza que deseja excluir este material?')) {
                    dadosMinerios = dadosMinerios.filter(m => m.id !== id);
                    salvarDados();
                    atualizarDashboard();
                    atualizarListaMinerios();
                }
            };

            window.editarCliente = function(id) {
                alert('Fun√ß√£o de edi√ß√£o em desenvolvimento');
            };

            window.excluirCliente = function(id) {
                if (confirm('Tem certeza que deseja excluir este cliente?')) {
                    dadosClientes = dadosClientes.filter(c => c.id !== id);
                    salvarDados();
                    atualizarDashboard();
                    atualizarListaClientes();
                }
            };
            
            window.editarPrecosCliente = function(nomeCliente) {
                const cliente = dadosClientes.find(c => c.nome === nomeCliente);
                if (!cliente) return;
                
                // Mostrar modal de pre√ßos
                document.getElementById('modal-precos').classList.remove('hidden');
                
                // Preencher informa√ß√µes do cliente
                document.getElementById('info-cliente-modal').innerHTML = `
                    <h4 class="font-semibold text-empresa-azul mb-2">Cliente: ${cliente.nome}</h4>
                    <p class="text-sm text-gray-600">üìû ${cliente.telefone} | üìç ${cliente.endereco}</p>
                `;
                
                // Atualizar select de materiais
                const selectMaterial = document.getElementById('select-material');
                selectMaterial.innerHTML = '<option value="">Selecione um material</option>';
                dadosMinerios.filter(m => m.status === 'ativo').forEach(material => {
                    selectMaterial.innerHTML += `<option value="${material.nome}">${material.nome} - ${material.categoria}</option>`;
                });
                
                // Carregar pre√ßos existentes para o cliente
                atualizarListaPrecosCliente(nomeCliente);
                
                // Armazenar cliente atual
                document.getElementById('modal-precos').setAttribute('data-cliente', nomeCliente);
            };

            window.editarVeiculo = function(id) {
                alert('Fun√ß√£o de edi√ß√£o em desenvolvimento');
            };

            window.excluirVeiculo = function(id) {
                if (confirm('Tem certeza que deseja excluir este ve√≠culo?')) {
                    dadosVeiculos = dadosVeiculos.filter(v => v.id !== id);
                    salvarDados();
                    atualizarDashboard();
                    atualizarListaVeiculos();
                }
            };

            window.editarMotorista = function(id) {
                alert('Fun√ß√£o de edi√ß√£o em desenvolvimento');
            };

            window.excluirMotorista = function(id) {
                if (confirm('Tem certeza que deseja excluir este motorista?')) {
                    dadosMotoristas = dadosMotoristas.filter(m => m.id !== id);
                    salvarDados();
                    atualizarDashboard();
                    atualizarListaMotoristas();
                }
            };

            window.excluirVenda = function(id) {
                if (confirm('Tem certeza que deseja excluir esta venda?')) {
                    dadosVendas = dadosVendas.filter(v => v.id !== id);
                    salvarDados();
                    atualizarDashboard();
                    atualizarListaVendas();
                    atualizarListaCobrancas();
                    atualizarResumoCobrancas();
                }
            };
            
            // Fun√ß√µes globais para despesas
            window.excluirDespesa = function(id) {
                if (confirm('Tem certeza que deseja excluir esta despesa?')) {
                    dadosDespesas = dadosDespesas.filter(d => d.id !== id);
                    salvarDados();
                    atualizarResumoDespesas();
                    atualizarListaDespesas();
                }
            };
            
            window.verDetalhesDespesa = function(id) {
                const despesa = dadosDespesas.find(d => d.id === id);
                if (!despesa) return;
                
                const iconeCategoria = {
                    'combustivel': '‚õΩ',
                    'manutencao': 'üîß',
                    'alimentacao': 'üçΩÔ∏è',
                    'pedagio': 'üõ£Ô∏è',
                    'seguro': 'üõ°Ô∏è',
                    'impostos': 'üìã',
                    'equipamentos': '‚öôÔ∏è',
                    'outros': 'üìù'
                };
                
                const detalhes = `
üí∏ DETALHES DA DESPESA

üóìÔ∏è Data: ${new Date(despesa.data).toLocaleDateString()}
${iconeCategoria[despesa.categoria]} Categoria: ${despesa.categoria.charAt(0).toUpperCase() + despesa.categoria.slice(1)}
üìù Descri√ß√£o: ${despesa.descricao}
üí∞ Valor: R$ ${despesa.valor.toFixed(2).replace('.', ',')}
üöõ Ve√≠culo: ${despesa.veiculo || 'N√£o espec√≠fico'}
üí≥ Pagamento: ${despesa.formaPagamento}
${despesa.recorrente ? 'üîÑ Despesa recorrente' : ''}
${despesa.urgente ? '‚ö° Despesa urgente' : ''}
${despesa.observacoes ? '\nüìã Observa√ß√µes: ' + despesa.observacoes : ''}
                `;
                
                alert(detalhes);
            };
            


            window.verDetalhesVenda = function(id) {
                const venda = dadosVendas.find(v => v.id === id);
                if (!venda) return;
                
                const detalhes = `
üìã DETALHES DA VENDA

üóìÔ∏è Data: ${new Date(venda.dataVenda).toLocaleDateString()}
üë• Cliente: ${venda.cliente}
‚õèÔ∏è Material: ${venda.material}
üöõ Ve√≠culo: ${venda.veiculo}
üë®‚Äçüíº Motorista: ${venda.motorista || '-'}

‚öñÔ∏è PESOS:
‚Ä¢ Peso Pedreira: ${venda.pesoPedreira} t
‚Ä¢ Peso Cliente: ${venda.pesoCliente} t

üí∞ VALORES:
‚Ä¢ Pre√ßo por tonelada: R$ ${(venda.precoTonelada || 0).toFixed(2)}
‚Ä¢ Valor Total: R$ ${venda.valorTotal.toFixed(2)}
‚Ä¢ Custo Total: R$ ${(venda.custoTotal || 0).toFixed(2)}
‚Ä¢ Lucro: R$ ${(venda.lucro || 0).toFixed(2)}

üí≥ PAGAMENTO:
‚Ä¢ Tipo: ${venda.tipoPagamento}
‚Ä¢ Status: ${venda.statusPagamento}
‚Ä¢ Valor Pago: R$ ${venda.valorPago.toFixed(2)}
‚Ä¢ Saldo: R$ ${venda.saldo.toFixed(2)}

üìù Observa√ß√µes: ${venda.observacoes || 'Nenhuma'}
                `;
                
                alert(detalhes);
            };

            // Fun√ß√£o para atualizar os selects da venda
            function atualizarSelectsVenda() {
                // Atualizar select de materiais
                const selectMaterial = document.getElementById('material-venda');
                selectMaterial.innerHTML = '<option value="">Selecione um material</option>';
                dadosMinerios.filter(m => m.status === 'ativo').forEach(minerio => {
                    selectMaterial.innerHTML += `<option value="${minerio.nome}">${minerio.nome} - ${minerio.categoria}</option>`;
                });
                
                // Atualizar select de clientes
                const selectCliente = document.getElementById('cliente-venda');
                selectCliente.innerHTML = '<option value="">Selecione um cliente</option>';
                dadosClientes.filter(c => c.status === 'ativo').forEach(cliente => {
                    selectCliente.innerHTML += `<option value="${cliente.nome}">${cliente.nome}</option>`;
                });
                
                // Atualizar select de ve√≠culos com motoristas
                const selectVeiculo = document.getElementById('veiculo-venda');
                selectVeiculo.innerHTML = '<option value="">Selecione um ve√≠culo</option>';
                dadosVeiculos.filter(v => v.status === 'ativo').forEach(veiculo => {
                    const motorista = veiculo.motorista || 'Sem motorista';
                    const isSelected = configDia.veiculoPadrao === veiculo.placa ? 'selected' : '';
                    selectVeiculo.innerHTML += `<option value="${veiculo.placa}" data-motorista="${veiculo.motorista || ''}" ${isSelected}>${veiculo.placa} - ${veiculo.modelo} (${motorista})</option>`;
                });
                
                // Se h√° ve√≠culo padr√£o selecionado, atualizar informa√ß√µes do motorista
                if (configDia.veiculoPadrao) {
                    atualizarInfoMotorista();
                }
                
                // Atualizar select de motoristas para ve√≠culos
                const selectMotoristaVeiculo = document.getElementById('motorista-veiculo');
                if (selectMotoristaVeiculo) {
                    selectMotoristaVeiculo.innerHTML = '<option value="">Selecione um motorista</option>';
                    dadosMotoristas.filter(m => m.status === 'ativo').forEach(motorista => {
                        selectMotoristaVeiculo.innerHTML += `<option value="${motorista.nome}">${motorista.nome}</option>`;
                    });
                }
            }
            
            // Fun√ß√£o para atualizar informa√ß√µes do motorista na venda
            function atualizarInfoMotorista() {
                const selectVeiculo = document.getElementById('veiculo-venda');
                const infoMotorista = document.getElementById('info-motorista');
                const nomeMotorista = document.getElementById('nome-motorista-vinculado');
                
                if (selectVeiculo.value) {
                    const veiculoSelecionado = dadosVeiculos.find(v => v.placa === selectVeiculo.value);
                    if (veiculoSelecionado && veiculoSelecionado.motorista) {
                        infoMotorista.classList.remove('hidden');
                        nomeMotorista.textContent = veiculoSelecionado.motorista;
                    } else {
                        infoMotorista.classList.add('hidden');
                    }
                } else {
                    infoMotorista.classList.add('hidden');
                }
            }
            
            // Fun√ß√£o para atualizar c√°lculos da venda em tempo real
            function atualizarCalculosVenda() {
                const materialNome = document.getElementById('material-venda').value;
                const clienteNome = document.getElementById('cliente-venda').value;
                const pesoPedreira = parseFloat(document.getElementById('peso-pedreira').value) || 0;
                const pesoCliente = parseFloat(document.getElementById('peso-cliente').value) || 0;
                
                // Encontrar o material selecionado
                const materialSelecionado = dadosMinerios.find(m => m.nome === materialNome);
                
                if (materialSelecionado) {
                    // Calcular volumes baseados na densidade
                    if (materialSelecionado.densidade && materialSelecionado.densidade > 0) {
                        const volumePedreira = pesoPedreira / materialSelecionado.densidade;
                        const volumeCliente = pesoCliente / materialSelecionado.densidade;
                        
                        document.getElementById('volume-pedreira').textContent = volumePedreira.toFixed(2) + ' m¬≥';
                        document.getElementById('volume-cliente').textContent = volumeCliente.toFixed(2) + ' m¬≥';
                    } else {
                        document.getElementById('volume-pedreira').textContent = '- m¬≥';
                        document.getElementById('volume-cliente').textContent = '- m¬≥';
                    }
                    
                    // CORRE√á√ÉO: Usar o pre√ßo de tonelada do material como custo
                    const custoPorTonelada = materialSelecionado.precoTonelada; // Custo real do material
                    document.getElementById('custo-tonelada').textContent = custoPorTonelada.toFixed(2);
                    
                    // F√ìRMULA CORRETA: Custo do Material √ó Peso = Total
                    const custoTotal = pesoPedreira * custoPorTonelada;
                    document.getElementById('custo-total').textContent = custoTotal.toFixed(2);
                    document.getElementById('preview-custo').textContent = custoTotal.toFixed(2);
                    
                    // DETERMINAR: Pre√ßo individual por tonelada para o cliente espec√≠fico
                    let precoClienteTonelada = materialSelecionado.precoTonelada; // Pre√ßo padr√£o do material
                    let usoPrecoEspecifico = false;
                    
                    // PRIORIDADE 1: Verificar se existe pre√ßo individual na tabela de pre√ßos espec√≠ficos
                    if (clienteNome && materialNome) {
                        // Verificar pre√ßo espec√≠fico por tonelada
                        const precoEspecificoTon = dadosPrecos.find(p => 
                            p.cliente === clienteNome && 
                            p.material === materialNome && 
                            p.tipo === 'tonelada'
                        );
                        
                        // Verificar pre√ßo espec√≠fico por metro c√∫bico
                        const precoEspecificoM3 = dadosPrecos.find(p => 
                            p.cliente === clienteNome && 
                            p.material === materialNome && 
                            p.tipo === 'metro'
                        );
                        
                        if (precoEspecificoTon) {
                            // Usar pre√ßo espec√≠fico por tonelada
                            precoClienteTonelada = precoEspecificoTon.preco;
                            usoPrecoEspecifico = true;
                            document.getElementById('indicador-tipo-preco').textContent = '(por ton)';
                            document.getElementById('indicador-tipo-preco').classList.remove('hidden');
                        } else if (precoEspecificoM3 && materialSelecionado.densidade > 0) {
                            // Converter pre√ßo por m¬≥ para pre√ßo por tonelada
                            precoClienteTonelada = precoEspecificoM3.preco / materialSelecionado.densidade;
                            usoPrecoEspecifico = true;
                            document.getElementById('indicador-tipo-preco').textContent = '(convertido de m¬≥)';
                            document.getElementById('indicador-tipo-preco').classList.remove('hidden');
                        }
                        
                        if (usoPrecoEspecifico) {
                            // Indicar que est√° usando pre√ßo espec√≠fico
                            document.getElementById('preco-cliente-ton').style.color = '#22c55e';
                            document.getElementById('preco-cliente-ton').style.fontWeight = 'bold';
                            document.getElementById('preco-cliente-ton').title = 'Pre√ßo espec√≠fico do cliente';
                            document.getElementById('indicador-preco-especifico').classList.remove('hidden');
                        } else {
                            // Usando pre√ßo padr√£o
                            document.getElementById('preco-cliente-ton').style.color = '#6b7280';
                            document.getElementById('preco-cliente-ton').style.fontWeight = 'normal';
                            document.getElementById('preco-cliente-ton').title = 'Pre√ßo padr√£o do material';
                            document.getElementById('indicador-preco-especifico').classList.add('hidden');
                            document.getElementById('indicador-tipo-preco').classList.add('hidden');
                        }
                    }
                    
                    document.getElementById('preco-cliente-ton').textContent = precoClienteTonelada.toFixed(2);
                    
                    // F√ìRMULA CORRETA: Peso Cliente √ó Pre√ßo Individual = Total da Venda
                    const valorVenda = pesoCliente * precoClienteTonelada;
                    document.getElementById('valor-venda').textContent = valorVenda.toFixed(2);
                    document.getElementById('preview-venda').textContent = valorVenda.toFixed(2);
                    
                    // Calcular lucro: Valor de Venda - Custo Total
                    const lucro = valorVenda - custoTotal;
                    document.getElementById('preview-lucro').textContent = lucro.toFixed(2);
                    
                    // Atualizar cor do lucro
                    const lucroElement = document.getElementById('preview-lucro');
                    if (lucro > 0) {
                        lucroElement.parentElement.className = 'text-lg font-semibold text-green-600';
                    } else if (lucro < 0) {
                        lucroElement.parentElement.className = 'text-lg font-semibold text-red-600';
                    } else {
                        lucroElement.parentElement.className = 'text-lg font-semibold text-gray-600';
                    }
                    
                } else {
                    // Limpar valores se n√£o houver material selecionado
                    document.getElementById('volume-pedreira').textContent = '0,00 m¬≥';
                    document.getElementById('volume-cliente').textContent = '0,00 m¬≥';
                    document.getElementById('custo-tonelada').textContent = '0,00';
                    document.getElementById('custo-total').textContent = '0,00';
                    document.getElementById('preco-cliente-ton').textContent = '0,00';
                    document.getElementById('valor-venda').textContent = '0,00';
                    document.getElementById('preview-venda').textContent = '0,00';
                    document.getElementById('preview-custo').textContent = '0,00';
                    document.getElementById('preview-lucro').textContent = '0,00';
                    
                    // Reset estilo do pre√ßo e indicadores
                    document.getElementById('preco-cliente-ton').style.color = '';
                    document.getElementById('preco-cliente-ton').style.fontWeight = '';
                    document.getElementById('preco-cliente-ton').title = '';
                    document.getElementById('indicador-preco-especifico').classList.add('hidden');
                    document.getElementById('indicador-tipo-preco').classList.add('hidden');
                    document.getElementById('indicador-tipo-preco').classList.add('hidden');
                    document.getElementById('indicador-tipo-preco').classList.add('hidden');
                }
            }

            // Event listener para mudan√ßa de ve√≠culo na venda
            document.getElementById('veiculo-venda').addEventListener('change', atualizarInfoMotorista);
            
            // Event listeners para atualizar c√°lculos em tempo real
            document.getElementById('material-venda').addEventListener('change', atualizarCalculosVenda);
            document.getElementById('cliente-venda').addEventListener('change', atualizarCalculosVenda);
            document.getElementById('peso-pedreira').addEventListener('input', atualizarCalculosVenda);
            document.getElementById('peso-cliente').addEventListener('input', atualizarCalculosVenda);
            

            
            // Event listener para trocar motorista
            document.getElementById('btn-trocar-motorista').addEventListener('click', function() {
                const selectVeiculo = document.getElementById('veiculo-venda');
                const placaVeiculo = selectVeiculo.value;
                
                if (!placaVeiculo) return;
                
                // Criar modal de sele√ß√£o de motorista
                criarModalTrocarMotorista(placaVeiculo);
            });
            
            // Fun√ß√£o para criar modal de trocar motorista
            function criarModalTrocarMotorista(placaVeiculo) {
                const veiculo = dadosVeiculos.find(v => v.placa === placaVeiculo);
                if (!veiculo) return;
                
                // Criar modal
                const modal = document.createElement('div');
                modal.id = 'modal-trocar-motorista';
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                
                const motoristasAtivos = dadosMotoristas.filter(m => m.status === 'ativo');
                
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-empresa-azul">üîÑ Trocar Motorista</h3>
                            <button id="fechar-modal-motorista" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                        </div>
                        
                        <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                            <p class="text-sm text-gray-600">
                                <strong>Ve√≠culo:</strong> ${veiculo.placa} - ${veiculo.modelo}
                            </p>
                            <p class="text-sm text-gray-600">
                                <strong>Motorista Atual:</strong> ${veiculo.motorista || 'Nenhum'}
                            </p>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Novo Motorista</label>
                            <select id="select-novo-motorista" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="">Selecione um motorista</option>
                                ${motoristasAtivos.map(motorista => `
                                    <option value="${motorista.nome}" ${motorista.nome === veiculo.motorista ? 'selected' : ''}>
                                        ${motorista.nome}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div class="flex justify-end gap-3">
                            <button id="cancelar-trocar-motorista" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button id="confirmar-trocar-motorista" class="px-4 py-2 bg-empresa-verde text-white rounded-lg hover:bg-empresa-verde-dark">
                                ‚úÖ Confirmar
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Event listeners do modal
                document.getElementById('fechar-modal-motorista').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                document.getElementById('cancelar-trocar-motorista').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                document.getElementById('confirmar-trocar-motorista').addEventListener('click', () => {
                    const novoMotorista = document.getElementById('select-novo-motorista').value;
                    
                    if (novoMotorista) {
                        veiculo.motorista = novoMotorista;
                        salvarDados();
                        atualizarSelectsVenda();
                        atualizarListaVeiculos();
                        atualizarInfoMotorista();
                        alert('‚úÖ Motorista alterado com sucesso!');
                        document.body.removeChild(modal);
                    } else {
                        alert('‚ö†Ô∏è Por favor, selecione um motorista.');
                    }
                });
                
                // Fechar modal clicando fora
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }

            // Modal para edi√ß√£o completa de motorista do ve√≠culo
            window.editarMotoristaVeiculo = function(veiculoId) {
                const veiculo = dadosVeiculos.find(v => v.id === veiculoId);
                if (!veiculo) return;
                
                // Criar modal de sele√ß√£o de motorista
                const modal = document.createElement('div');
                modal.id = 'modal-editar-motorista-veiculo';
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                
                const motoristasAtivos = dadosMotoristas.filter(m => m.status === 'ativo');
                
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-empresa-azul">üë®‚Äçüíº Editar Motorista do Ve√≠culo</h3>
                            <button id="fechar-modal-editar-motorista" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                        </div>
                        
                        <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                            <p class="text-sm text-gray-600">
                                <strong>Ve√≠culo:</strong> ${veiculo.placa} - ${veiculo.modelo}
                            </p>
                            <p class="text-sm text-gray-600">
                                <strong>Motorista Atual:</strong> ${veiculo.motorista || 'Nenhum'}
                            </p>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Selecionar Motorista</label>
                            <select id="select-motorista-veiculo" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-empresa-verde">
                                <option value="">Selecione um motorista</option>
                                ${motoristasAtivos.map(motorista => `
                                    <option value="${motorista.nome}" ${motorista.nome === veiculo.motorista ? 'selected' : ''}>
                                        ${motorista.nome}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div class="flex justify-end gap-3">
                            <button id="cancelar-editar-motorista" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button id="confirmar-editar-motorista" class="px-4 py-2 bg-empresa-verde text-white rounded-lg hover:bg-empresa-verde-dark">
                                ‚úÖ Salvar
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Event listeners do modal
                document.getElementById('fechar-modal-editar-motorista').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                document.getElementById('cancelar-editar-motorista').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                document.getElementById('confirmar-editar-motorista').addEventListener('click', () => {
                    const novoMotorista = document.getElementById('select-motorista-veiculo').value;
                    
                    if (novoMotorista) {
                        veiculo.motorista = novoMotorista;
                        salvarDados();
                        atualizarSelectsVenda();
                        atualizarListaVeiculos();
                        alert('‚úÖ Motorista do ve√≠culo alterado com sucesso!');
                        document.body.removeChild(modal);
                    } else {
                        alert('‚ö†Ô∏è Por favor, selecione um motorista.');
                    }
                });
                
                // Fechar modal clicando fora
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            };
            
            // Fun√ß√µes para Cobran√ßa
            function atualizarListaCobrancas() {
                const tbody = document.getElementById('lista-cobrancas');
                const vendasComSaldo = dadosVendas.filter(venda => venda.saldo > 0);
                
                if (vendasComSaldo.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="px-4 py-8 text-center text-gray-500">üìã Nenhuma cobran√ßa pendente</td></tr>';
                    return;
                }
                
                tbody.innerHTML = vendasComSaldo.map(venda => {
                    const statusClass = venda.saldo === venda.valorTotal ? 'bg-red-100 text-red-800' : 
                                       venda.saldo > 0 ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                    const statusText = venda.saldo === venda.valorTotal ? 'Em Aberto' : 
                                      venda.saldo > 0 ? 'Parcial' : 'Pago';
                    
                    return `
                        <tr>
                            <td class="px-4 py-4 text-sm text-gray-500">${new Date(venda.dataVenda).toLocaleDateString()}</td>
                            <td class="px-4 py-4 text-sm font-medium text-gray-900">${venda.cliente}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">${venda.material}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">R$ ${venda.valorTotal.toFixed(2)}</td>
                            <td class="px-4 py-4 text-sm text-green-600">R$ ${venda.valorPago.toFixed(2)}</td>
                            <td class="px-4 py-4 text-sm text-red-600">R$ ${venda.saldo.toFixed(2)}</td>
                            <td class="px-4 py-4 text-sm">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">
                                    ${statusText}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-sm text-gray-500">
                                <button onclick="marcarComoPago(${venda.id})" class="text-green-600 hover:text-green-900 mr-2" title="Marcar como pago">
                                    ‚úÖ
                                </button>
                                <button onclick="verHistoricoPagamentos(${venda.id})" class="text-blue-600 hover:text-blue-900" title="Ver hist√≥rico">
                                    üìã
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            function atualizarSelectsCobranca() {
                // Atualizar select de clientes para filtro
                const selectFiltroCliente = document.getElementById('filtro-cliente-cobranca');
                selectFiltroCliente.innerHTML = '<option value="">Todos os clientes</option>';
                dadosClientes.forEach(cliente => {
                    selectFiltroCliente.innerHTML += `<option value="${cliente.nome}">${cliente.nome}</option>`;
                });
                
                // Atualizar select de clientes para pagamento
                const selectClientePagamento = document.getElementById('cliente-pagamento');
                selectClientePagamento.innerHTML = '<option value="">Selecione um cliente</option>';
                
                // Apenas clientes com saldo em aberto
                const clientesComSaldo = [...new Set(dadosVendas.filter(v => v.saldo > 0).map(v => v.cliente))];
                clientesComSaldo.forEach(cliente => {
                    const saldoTotal = dadosVendas.filter(v => v.cliente === cliente && v.saldo > 0)
                                                 .reduce((sum, v) => sum + v.saldo, 0);
                    selectClientePagamento.innerHTML += `<option value="${cliente}">${cliente} (R$ ${saldoTotal.toFixed(2)})</option>`;
                });
            }
            
            function atualizarResumoCobrancas() {
                const totalAberto = dadosVendas.reduce((sum, venda) => sum + venda.saldo, 0);
                const totalPago = dadosVendas.reduce((sum, venda) => sum + venda.valorPago, 0);
                const totalPendencias = dadosVendas.filter(venda => venda.saldo > 0).length;
                
                document.getElementById('total-aberto').textContent = `R$ ${totalAberto.toFixed(2)}`;
                document.getElementById('total-pago').textContent = `R$ ${totalPago.toFixed(2)}`;
                document.getElementById('total-pendencias').textContent = totalPendencias;
            }
            
            // Fun√ß√£o para marcar venda como paga
            window.marcarComoPago = function(vendaId) {
                const venda = dadosVendas.find(v => v.id === vendaId);
                if (!venda) return;
                
                if (confirm(`Confirma que o cliente ${venda.cliente} pagou R$ ${venda.saldo.toFixed(2)}?`)) {
                    // Registrar pagamento
                    const pagamento = {
                        id: Date.now(),
                        cliente: venda.cliente,
                        valorPago: venda.saldo,
                        formaPagamento: 'manual',
                        data: new Date().toISOString(),
                        observacoes: 'Pagamento marcado como pago manualmente',
                        vendasAfetadas: [vendaId]
                    };
                    
                    dadosPagamentos.push(pagamento);
                    
                    // Atualizar venda
                    venda.valorPago += venda.saldo;
                    venda.saldo = 0;
                    venda.statusPagamento = 'pago';
                    
                    salvarDados();
                    atualizarListaCobrancas();
                    atualizarSelectsCobranca();
                    atualizarResumoCobrancas();
                    
                    alert('‚úÖ Pagamento registrado com sucesso!');
                }
            };
            
            // Fun√ß√£o para ver hist√≥rico de pagamentos
            window.verHistoricoPagamentos = function(vendaId) {
                const venda = dadosVendas.find(v => v.id === vendaId);
                if (!venda) return;
                
                const pagamentosVenda = dadosPagamentos.filter(p => p.vendasAfetadas.includes(vendaId));
                
                let historico = `üìã Hist√≥rico de Pagamentos - ${venda.cliente}\n`;
                historico += `üìÖ Venda: ${new Date(venda.dataVenda).toLocaleDateString()}\n`;
                historico += `üí∞ Valor Total: R$ ${venda.valorTotal.toFixed(2)}\n`;
                historico += `‚úÖ Valor Pago: R$ ${venda.valorPago.toFixed(2)}\n`;
                historico += `üî¥ Saldo: R$ ${venda.saldo.toFixed(2)}\n\n`;
                
                if (pagamentosVenda.length === 0) {
                    historico += '‚ùå Nenhum pagamento registrado';
                } else {
                    historico += 'üìã Pagamentos:\n';
                    pagamentosVenda.forEach(pagamento => {
                        historico += `‚Ä¢ ${new Date(pagamento.data).toLocaleDateString()} - R$ ${pagamento.valorPago.toFixed(2)} (${pagamento.formaPagamento})\n`;
                    });
                }
                
                alert(historico);
            };
            
            // ===== EVENT LISTENERS PARA DESPESAS =====
            
            // Abrir modal de despesas
            document.getElementById('btn-adicionar-despesa').addEventListener('click', function() {
                document.getElementById('modal-adicionar-despesa').classList.remove('hidden');
                document.getElementById('data-despesa').valueAsDate = new Date();
                atualizarSelectsVeiculosDespesa();
            });
            
            // Fechar modal de despesas
            document.getElementById('fechar-modal-despesa').addEventListener('click', function() {
                document.getElementById('modal-adicionar-despesa').classList.add('hidden');
            });
            
            document.getElementById('cancelar-despesa').addEventListener('click', function() {
                document.getElementById('modal-adicionar-despesa').classList.add('hidden');
            });
            
            // Submiss√£o do formul√°rio de despesas
            document.getElementById('form-adicionar-despesa').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const despesaData = {
                    id: Date.now(),
                    data: document.getElementById('data-despesa').value,
                    categoria: document.getElementById('categoria-despesa').value,
                    descricao: document.getElementById('descricao-despesa').value,
                    valor: parseFloat(document.getElementById('valor-despesa').value),
                    veiculo: document.getElementById('veiculo-despesa').value,
                    formaPagamento: document.getElementById('forma-pagamento-despesa').value,
                    observacoes: document.getElementById('observacoes-despesa').value,
                    recorrente: document.getElementById('despesa-recorrente').checked,
                    urgente: document.getElementById('despesa-urgente').checked,
                    dataCadastro: new Date().toISOString()
                };
                
                const sucesso = await salvarDespesa(despesaData);
                
                if (sucesso) {
                    document.getElementById('modal-adicionar-despesa').classList.add('hidden');
                    document.getElementById('form-adicionar-despesa').reset();
                    
                    const status = navigator.onLine ? 'salva com sucesso!' : 'salva offline - ser√° sincronizada quando voltar online';
                    mostrarToast(`üí∏ Despesa ${status}`, navigator.onLine ? 'success' : 'warning');
                } else {
                    mostrarToast('‚ùå Erro ao salvar despesa', 'error');
                }
            });
            
            // Filtro de despesas
            document.getElementById('btn-filtrar-despesas').addEventListener('click', function() {
                // Implementar filtros de despesas
                filtrarDespesas();
            });
            
            function filtrarDespesas() {
                const categoria = document.getElementById('filtro-categoria-despesa').value;
                const periodo = document.getElementById('filtro-periodo-despesa').value;
                const veiculo = document.getElementById('filtro-veiculo-despesa').value;
                
                let despesasFiltradas = [...dadosDespesas];
                
                if (categoria) {
                    despesasFiltradas = despesasFiltradas.filter(d => d.categoria === categoria);
                }
                
                if (veiculo) {
                    despesasFiltradas = despesasFiltradas.filter(d => d.veiculo === veiculo);
                }
                
                if (periodo) {
                    const hoje = new Date();
                    let dataInicio;
                    
                    switch (periodo) {
                        case 'hoje':
                            dataInicio = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
                            break;
                        case 'semana':
                            dataInicio = new Date(hoje.setDate(hoje.getDate() - hoje.getDay()));
                            break;
                        case 'mes':
                            dataInicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                            break;
                    }
                    
                    if (dataInicio) {
                        despesasFiltradas = despesasFiltradas.filter(d => new Date(d.data) >= dataInicio);
                    }
                }
                
                // Atualizar tabela com despesas filtradas
                const tbody = document.getElementById('lista-despesas');
                if (despesasFiltradas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">üîç Nenhuma despesa encontrada com os filtros aplicados</td></tr>';
                    return;
                }
                
                const despesasOrdenadas = [...despesasFiltradas].sort((a, b) => new Date(b.data) - new Date(a.data));
                
                tbody.innerHTML = despesasOrdenadas.map(despesa => {
                    const iconeCategoria = {
                        'combustivel': '‚õΩ',
                        'manutencao': 'üîß',
                        'alimentacao': 'üçΩÔ∏è',
                        'pedagio': 'üõ£Ô∏è',
                        'seguro': 'üõ°Ô∏è',
                        'impostos': 'üìã',
                        'equipamentos': '‚öôÔ∏è',
                        'outros': 'üìù'
                    };
                    
                    const statusClass = despesa.urgente ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800';
                    const statusText = despesa.urgente ? '‚ö° Urgente' : '‚úÖ Normal';
                    
                    return `
                        <tr class="${despesa.urgente ? 'bg-red-50' : ''}">
                            <td class="px-4 py-4 text-sm text-gray-500">${new Date(despesa.data).toLocaleDateString()}</td>
                            <td class="px-4 py-4 text-sm">
                                <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">
                                    ${iconeCategoria[despesa.categoria]} ${despesa.categoria.charAt(0).toUpperCase() + despesa.categoria.slice(1)}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-sm text-gray-900">${despesa.descricao}</td>
                            <td class="px-4 py-4 text-sm text-gray-500">${despesa.veiculo || '-'}</td>
                            <td class="px-4 py-4 text-sm font-medium text-red-600">R$ ${despesa.valor.toFixed(2).replace('.', ',')}</td>
                            <td class="px-4 py-4 text-sm">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">
                                    ${statusText}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-sm text-gray-500">
                                <button onclick="verDetalhesDespesa(${despesa.id})" class="text-blue-600 hover:text-blue-900 mr-2" title="Ver detalhes">üëÅÔ∏è</button>
                                <button onclick="excluirDespesa(${despesa.id})" class="text-red-600 hover:text-red-900" title="Excluir">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            // ===== SISTEMA DE MACHINE LEARNING - PREVIS√ÉO DE DEMANDA =====
            
            class PrevisaoDemanda {
                constructor() {
                    this.modelo = null;
                    this.dadosTreinamento = [];
                    this.parametros = {
                        janelaTemporal: 7, // Janela de dados para previs√£o
                        alpha: 0.3, // Par√¢metro para suaviza√ß√£o exponencial
                        beta: 0.3,  // Par√¢metro para tend√™ncia
                        gamma: 0.3, // Par√¢metro para sazonalidade
                        sazonalidade: 7 // Padr√£o semanal
                    };
                }
                
                // Preparar dados de vendas para treinamento
                prepararDados(material = null, diasAnalise = 60) {
                    let vendasFiltradas = dadosVendas;
                    
                    if (material) {
                        vendasFiltradas = dadosVendas.filter(v => v.material === material);
                    }
                    
                    // Agrupar vendas por data
                    const vendasPorDia = {};
                    const dataInicio = new Date();
                    dataInicio.setDate(dataInicio.getDate() - diasAnalise);
                    
                    // Inicializar todos os dias com 0
                    for (let i = 0; i < diasAnalise; i++) {
                        const data = new Date(dataInicio);
                        data.setDate(data.getDate() + i);
                        const dataStr = data.toISOString().split('T')[0];
                        vendasPorDia[dataStr] = { peso: 0, vendas: 0, receita: 0 };
                    }
                    
                    // Agregar dados reais
                    vendasFiltradas.forEach(venda => {
                        const dataVenda = new Date(venda.dataVenda).toISOString().split('T')[0];
                        if (vendasPorDia[dataVenda]) {
                            vendasPorDia[dataVenda].peso += venda.pesoCliente || 0;
                            vendasPorDia[dataVenda].vendas += 1;
                            vendasPorDia[dataVenda].receita += venda.valorTotal || 0;
                        }
                    });
                    
                    // Converter para array ordenado
                    this.dadosTreinamento = Object.keys(vendasPorDia)
                        .sort()
                        .map(data => ({
                            data: data,
                            peso: vendasPorDia[data].peso,
                            vendas: vendasPorDia[data].vendas,
                            receita: vendasPorDia[data].receita,
                            diaSemana: new Date(data).getDay(),
                            diaMes: new Date(data).getDate(),
                            mes: new Date(data).getMonth()
                        }));
                    
                    return this.dadosTreinamento;
                }
                
                // Algoritmo de Suaviza√ß√£o Exponencial Tripla (Holt-Winters)
                holtWinters(dados, alpha = 0.3, beta = 0.3, gamma = 0.3, sazonalidade = 7) {
                    const n = dados.length;
                    const resultado = {
                        nivel: [],
                        tendencia: [],
                        sazonais: [],
                        previsoes: []
                    };
                    
                    // Inicializa√ß√£o
                    resultado.nivel[0] = dados[0];
                    resultado.tendencia[0] = dados[1] - dados[0];
                    
                    // Inicializar fatores sazonais
                    for (let i = 0; i < sazonalidade; i++) {
                        resultado.sazonais[i] = dados[i] / (resultado.nivel[0] + resultado.tendencia[0] * i);
                    }
                    
                    // Calcular para o resto dos dados
                    for (let t = 1; t < n; t++) {
                        const sazIndex = t % sazonalidade;
                        
                        // Atualizar n√≠vel
                        const nivelAnterior = resultado.nivel[t - 1];
                        const tendenciaAnterior = resultado.tendencia[t - 1];
                        resultado.nivel[t] = alpha * (dados[t] / resultado.sazonais[sazIndex]) + 
                                           (1 - alpha) * (nivelAnterior + tendenciaAnterior);
                        
                        // Atualizar tend√™ncia
                        resultado.tendencia[t] = beta * (resultado.nivel[t] - nivelAnterior) + 
                                               (1 - beta) * tendenciaAnterior;
                        
                        // Atualizar sazonalidade
                        resultado.sazonais[sazIndex] = gamma * (dados[t] / resultado.nivel[t]) + 
                                                     (1 - gamma) * resultado.sazonais[sazIndex];
                        
                        // Calcular previs√£o para o pr√≥ximo per√≠odo
                        const proximoSazIndex = (t + 1) % sazonalidade;
                        resultado.previsoes[t] = (resultado.nivel[t] + resultado.tendencia[t]) * 
                                               resultado.sazonais[proximoSazIndex];
                    }
                    
                    return resultado;
                }
                
                // Regress√£o linear simples para tend√™ncia
                regressaoLinear(x, y) {
                    const n = x.length;
                    const somaX = x.reduce((a, b) => a + b, 0);
                    const somaY = y.reduce((a, b) => a + b, 0);
                    const somaXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
                    const somaX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
                    
                    const slope = (n * somaXY - somaX * somaY) / (n * somaX2 - somaX * somaX);
                    const intercept = (somaY - slope * somaX) / n;
                    
                    // Calcular R¬≤
                    const mediaY = somaY / n;
                    const somaQuadradosTotal = y.reduce((sum, yi) => sum + (yi - mediaY) ** 2, 0);
                    const somaQuadradosResiduo = y.reduce((sum, yi, i) => {
                        const previsao = slope * x[i] + intercept;
                        return sum + (yi - previsao) ** 2;
                    }, 0);
                    const r2 = 1 - (somaQuadradosResiduo / somaQuadradosTotal);
                    
                    return { slope, intercept, r2 };
                }
                
                // Treinar modelo
                treinarModelo(material = null, diasAnalise = 60) {
                    this.prepararDados(material, diasAnalise);
                    
                    if (this.dadosTreinamento.length < 14) {
                        throw new Error('Dados insuficientes para treinamento (m√≠nimo 14 dias)');
                    }
                    
                    // Extrair s√©rie temporal de peso
                    const serieTemporalPeso = this.dadosTreinamento.map(d => d.peso);
                    const indices = this.dadosTreinamento.map((d, i) => i);
                    
                    // Treinar modelos
                    const holtWinters = this.holtWinters(serieTemporalPeso, 
                        this.parametros.alpha, 
                        this.parametros.beta, 
                        this.parametros.gamma, 
                        this.parametros.sazonalidade
                    );
                    
                    const regressao = this.regressaoLinear(indices, serieTemporalPeso);
                    
                    // Calcular m√©tricas de avalia√ß√£o
                    const previsoes = holtWinters.previsoes.slice(7); // Pular primeiros valores
                    const reais = serieTemporalPeso.slice(7);
                    
                    const mae = this.calcularMAE(reais, previsoes);
                    const rmse = this.calcularRMSE(reais, previsoes);
                    const mape = this.calcularMAPE(reais, previsoes);
                    
                    this.modelo = {
                        tipo: 'Holt-Winters',
                        holtWinters: holtWinters,
                        regressao: regressao,
                        metricas: { mae, rmse, mape, r2: regressao.r2 },
                        material: material,
                        datasTreinamento: this.dadosTreinamento.map(d => d.data),
                        estatisticas: this.calcularEstatisticas(serieTemporalPeso)
                    };
                    
                    return this.modelo;
                }
                
                // Gerar previs√µes futuras
                prever(diasFuturos = 30) {
                    if (!this.modelo) {
                        throw new Error('Modelo n√£o foi treinado ainda');
                    }
                    
                    const previsoes = [];
                    const dataInicio = new Date();
                    dataInicio.setDate(dataInicio.getDate() + 1);
                    
                    const ultimoNivel = this.modelo.holtWinters.nivel[this.modelo.holtWinters.nivel.length - 1];
                    const ultimaTendencia = this.modelo.holtWinters.tendencia[this.modelo.holtWinters.tendencia.length - 1];
                    
                    for (let i = 1; i <= diasFuturos; i++) {
                        const data = new Date(dataInicio);
                        data.setDate(data.getDate() + i - 1);
                        
                        const sazIndex = (this.dadosTreinamento.length + i - 1) % this.parametros.sazonalidade;
                        const fatorSazonal = this.modelo.holtWinters.sazonais[sazIndex];
                        
                        // Previs√£o Holt-Winters
                        const previsaoHW = (ultimoNivel + ultimaTendencia * i) * fatorSazonal;
                        
                        // Previs√£o por regress√£o linear como backup
                        const previsaoRL = this.modelo.regressao.slope * (this.dadosTreinamento.length + i) + 
                                         this.modelo.regressao.intercept;
                        
                        // Combinar previs√µes (70% Holt-Winters, 30% Regress√£o)
                        const previsaoFinal = Math.max(0, previsaoHW * 0.7 + previsaoRL * 0.3);
                        
                        // Calcular intervalo de confian√ßa (baseado no erro hist√≥rico)
                        const margemErro = this.modelo.metricas.rmse * 1.96; // 95% confian√ßa
                        
                        previsoes.push({
                            data: data.toISOString().split('T')[0],
                            dataFormatada: data.toLocaleDateString(),
                            previsao: previsaoFinal,
                            limiteInferior: Math.max(0, previsaoFinal - margemErro),
                            limiteSuperior: previsaoFinal + margemErro,
                            confianca: this.calcularConfianca(i),
                            sazonalidade: this.identificarSazonalidade(data),
                            diaSemana: data.getDay()
                        });
                    }
                    
                    return previsoes;
                }
                
                // M√©tricas de avalia√ß√£o
                calcularMAE(reais, previsoes) {
                    const erros = reais.map((real, i) => Math.abs(real - (previsoes[i] || 0)));
                    return erros.reduce((a, b) => a + b, 0) / erros.length;
                }
                
                calcularRMSE(reais, previsoes) {
                    const erros = reais.map((real, i) => Math.pow(real - (previsoes[i] || 0), 2));
                    return Math.sqrt(erros.reduce((a, b) => a + b, 0) / erros.length);
                }
                
                calcularMAPE(reais, previsoes) {
                    const errosPercentuais = reais.map((real, i) => {
                        if (real === 0) return 0;
                        return Math.abs((real - (previsoes[i] || 0)) / real);
                    });
                    return (errosPercentuais.reduce((a, b) => a + b, 0) / errosPercentuais.length) * 100;
                }
                
                calcularConfianca(diasFuturos) {
                    // Confian√ßa diminui com a dist√¢ncia temporal
                    const confiancaBase = Math.max(0.5, 0.95 - (diasFuturos * 0.01));
                    return Math.min(0.95, confiancaBase);
                }
                
                calcularEstatisticas(dados) {
                    const media = dados.reduce((a, b) => a + b, 0) / dados.length;
                    const variancia = dados.reduce((sum, val) => sum + Math.pow(val - media, 2), 0) / dados.length;
                    const desvio = Math.sqrt(variancia);
                    const minimo = Math.min(...dados);
                    const maximo = Math.max(...dados);
                    
                    return { media, variancia, desvio, minimo, maximo };
                }
                
                identificarSazonalidade(data) {
                    const dia = data.getDay();
                    const diaMes = data.getDate();
                    
                    if (dia === 0 || dia === 6) return 'Fim de semana';
                    if (dia >= 1 && dia <= 5) return 'Dia √∫til';
                    if (diaMes <= 7) return 'In√≠cio do m√™s';
                    if (diaMes >= 25) return 'Final do m√™s';
                    return 'Meio do m√™s';
                }
                
                gerarInsights() {
                    if (!this.modelo) return [];
                    
                    const insights = [];
                    const stats = this.modelo.estatisticas;
                    const tendencia = this.modelo.regressao.slope;
                    
                    // An√°lise de tend√™ncia
                    if (tendencia > 0.1) {
                        insights.push('üìà Tend√™ncia de crescimento detectada na demanda');
                    } else if (tendencia < -0.1) {
                        insights.push('üìâ Tend√™ncia de queda detectada na demanda');
                    } else {
                        insights.push('üìä Demanda relativamente est√°vel');
                    }
                    
                    // An√°lise de variabilidade
                    const coefVariacao = stats.desvio / stats.media;
                    if (coefVariacao > 0.3) {
                        insights.push('‚ö†Ô∏è Alta variabilidade na demanda - considere estoque de seguran√ßa');
                    } else {
                        insights.push('‚úÖ Demanda com baixa variabilidade - padr√£o previs√≠vel');
                    }
                    
                    // An√°lise de sazonalidade
                    insights.push('üìÖ Padr√µes semanais identificados nos dados');
                    
                    // Qualidade do modelo
                    if (this.modelo.metricas.mape < 20) {
                        insights.push('üéØ Modelo com alta precis√£o (MAPE < 20%)');
                    } else {
                        insights.push('‚ö†Ô∏è Modelo com precis√£o moderada - mais dados podem melhorar');
                    }
                    
                    return insights;
                }
                
                gerarRecomendacoes(previsoes) {
                    const recomendacoes = [];
                    
                    // An√°lise das previs√µes
                    const mediaPrevisao = previsoes.reduce((sum, p) => sum + p.previsao, 0) / previsoes.length;
                    const mediaTreinamento = this.modelo.estatisticas.media;
                    
                    if (mediaPrevisao > mediaTreinamento * 1.2) {
                        recomendacoes.push('üî∫ Aumento significativo previsto - considere aumentar estoque');
                    } else if (mediaPrevisao < mediaTreinamento * 0.8) {
                        recomendacoes.push('üîª Redu√ß√£o prevista - otimize n√≠veis de estoque');
                    }
                    
                    // Recomenda√ß√µes por dia da semana
                    const previsoesPorDia = {};
                    previsoes.forEach(p => {
                        const dia = p.diaSemana;
                        if (!previsoesPorDia[dia]) previsoesPorDia[dia] = [];
                        previsoesPorDia[dia].push(p.previsao);
                    });
                    
                    const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab'];
                    const diaMaiorDemanda = Object.keys(previsoesPorDia)
                        .map(dia => ({
                            dia: parseInt(dia),
                            media: previsoesPorDia[dia].reduce((a, b) => a + b, 0) / previsoesPorDia[dia].length
                        }))
                        .sort((a, b) => b.media - a.media)[0];
                    
                    recomendacoes.push(`üìÖ Maior demanda esperada: ${diasSemana[diaMaiorDemanda.dia]}`);
                    
                    // Recomenda√ß√£o de log√≠stica
                    recomendacoes.push('üöõ Considere otimizar rotas nos dias de maior demanda');
                    
                    // Recomenda√ß√£o de pricing
                    if (mediaPrevisao > mediaTreinamento * 1.1) {
                        recomendacoes.push('üí∞ Momento favor√°vel para ajustes de pre√ßo');
                    }
                    
                    return recomendacoes;
                }
            }
            
            // Inst√¢ncia global do modelo
            const previsaoDemanda = new PrevisaoDemanda();
            
            // Event listeners para modal de pagamento
            document.getElementById('btn-adicionar-pagamento').addEventListener('click', function() {
                document.getElementById('modal-adicionar-pagamento').classList.remove('hidden');
                atualizarSelectsCobranca();
            });
            
            document.getElementById('fechar-modal-pagamento').addEventListener('click', function() {
                document.getElementById('modal-adicionar-pagamento').classList.add('hidden');
            });
            
            document.getElementById('cancelar-pagamento').addEventListener('click', function() {
                document.getElementById('modal-adicionar-pagamento').classList.add('hidden');
            });
            
            // Event listener para mudan√ßa de cliente no pagamento
            document.getElementById('cliente-pagamento').addEventListener('change', function() {
                const clienteSelecionado = this.value;
                const previewDiv = document.getElementById('preview-pagamento');
                const previewAplicacao = document.getElementById('preview-aplicacao');
                
                if (clienteSelecionado) {
                    const vendasCliente = dadosVendas.filter(v => v.cliente === clienteSelecionado && v.saldo > 0)
                                                    .sort((a, b) => new Date(a.dataVenda) - new Date(b.dataVenda));
                    
                    let preview = `<strong>Vendas em aberto para ${clienteSelecionado}:</strong><br>`;
                    vendasCliente.forEach(venda => {
                        preview += `‚Ä¢ ${new Date(venda.dataVenda).toLocaleDateString()} - R$ ${venda.saldo.toFixed(2)}<br>`;
                    });
                    
                    previewAplicacao.innerHTML = preview;
                    previewDiv.classList.remove('hidden');
                } else {
                    previewDiv.classList.add('hidden');
                }
            });
            
            // Event listener para mudan√ßa de valor no pagamento
            document.getElementById('valor-pagamento').addEventListener('input', function() {
                const clienteSelecionado = document.getElementById('cliente-pagamento').value;
                const valorPago = parseFloat(this.value) || 0;
                
                if (clienteSelecionado && valorPago > 0) {
                    const vendasCliente = dadosVendas.filter(v => v.cliente === clienteSelecionado && v.saldo > 0)
                                                    .sort((a, b) => new Date(a.dataVenda) - new Date(b.dataVenda));
                    
                    let valorRestante = valorPago;
                    let preview = `<strong>Aplica√ß√£o do pagamento de R$ ${valorPago.toFixed(2)}:</strong><br>`;
                    
                    vendasCliente.forEach(venda => {
                        if (valorRestante > 0) {
                            const valorAplicado = Math.min(valorRestante, venda.saldo);
                            preview += `‚Ä¢ ${new Date(venda.dataVenda).toLocaleDateString()} - R$ ${valorAplicado.toFixed(2)}`;
                            
                            if (valorAplicado === venda.saldo) {
                                preview += ' (‚úÖ Quitado)';
                            } else {
                                preview += ` (Saldo: R$ ${(venda.saldo - valorAplicado).toFixed(2)})`;
                            }
                            preview += '<br>';
                            
                            valorRestante -= valorAplicado;
                        }
                    });
                    
                    if (valorRestante > 0) {
                        preview += `<br><strong>‚ö†Ô∏è Residual: R$ ${valorRestante.toFixed(2)}</strong><br>`;
                        preview += '<em>O valor residual ficar√° como cr√©dito para futuras vendas.</em>';
                    }
                    
                    document.getElementById('preview-aplicacao').innerHTML = preview;
                    document.getElementById('preview-pagamento').classList.remove('hidden');
                }
            });
            
            // Formul√°rio de adicionar pagamento
            document.getElementById('form-adicionar-pagamento').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const cliente = document.getElementById('cliente-pagamento').value;
                const valorPago = parseFloat(document.getElementById('valor-pagamento').value) || 0;
                const formaPagamento = document.getElementById('forma-pagamento').value;
                const observacoes = document.getElementById('observacoes-pagamento').value;
                
                if (!cliente || valorPago <= 0 || !formaPagamento) {
                    alert('‚ö†Ô∏è Por favor, preencha todos os campos obrigat√≥rios.');
                    return;
                }
                
                // Aplicar pagamento nas vendas do cliente (das mais antigas para as mais recentes)
                const vendasCliente = dadosVendas.filter(v => v.cliente === cliente && v.saldo > 0)
                                                .sort((a, b) => new Date(a.dataVenda) - new Date(b.dataVenda));
                
                let valorRestante = valorPago;
                const vendasAfetadas = [];
                
                vendasCliente.forEach(venda => {
                    if (valorRestante > 0) {
                        const valorAplicado = Math.min(valorRestante, venda.saldo);
                        
                        venda.valorPago += valorAplicado;
                        venda.saldo -= valorAplicado;
                        valorRestante -= valorAplicado;
                        
                        if (venda.saldo === 0) {
                            venda.statusPagamento = 'pago';
                        } else if (venda.valorPago > 0) {
                            venda.statusPagamento = 'parcial';
                        }
                        
                        vendasAfetadas.push(venda.id);
                    }
                });
                
                // Registrar pagamento
                const pagamento = {
                    id: Date.now(),
                    cliente: cliente,
                    valorPago: valorPago,
                    valorAplicado: valorPago - valorRestante,
                    valorResidual: valorRestante,
                    formaPagamento: formaPagamento,
                    data: new Date().toISOString(),
                    observacoes: observacoes,
                    vendasAfetadas: vendasAfetadas
                };
                
                dadosPagamentos.push(pagamento);
                
                // Se sobrar valor, criar cr√©dito no estoque ou sistema de cr√©dito
                if (valorRestante > 0) {
                    // Pode ser implementado um sistema de cr√©dito por cliente
                    console.log(`Cr√©dito residual para ${cliente}: R$ ${valorRestante.toFixed(2)}`);
                }
                
                salvarDados();
                atualizarListaCobrancas();
                atualizarSelectsCobranca();
                atualizarResumoCobrancas();
                atualizarListaVendas();
                
                // Limpar e fechar modal
                this.reset();
                document.getElementById('modal-adicionar-pagamento').classList.add('hidden');
                
                let mensagem = `‚úÖ Pagamento de R$ ${valorPago.toFixed(2)} aplicado com sucesso!`;
                if (valorRestante > 0) {
                    mensagem += `\n‚ö†Ô∏è Residual de R$ ${valorRestante.toFixed(2)} registrado como cr√©dito.`;
                }
                
                alert(mensagem);
            });
            
            // Filtros de cobran√ßa
            document.getElementById('btn-filtrar-cobranca').addEventListener('click', function() {
                // Implementar filtros se necess√°rio
                atualizarListaCobrancas();
            });
            
            // Event Listeners para Previs√£o de Demanda
            document.getElementById('btn-treinar-modelo').addEventListener('click', function() {
                try {
                    // Mostrar status de treinamento
                    document.getElementById('status-treinamento').style.display = 'block';
                    
                    // Simular progresso
                    let progresso = 0;
                    const barraProgresso = document.getElementById('barra-progresso');
                    const intervalo = setInterval(() => {
                        progresso += 10;
                        barraProgresso.style.width = progresso + '%';
                        
                        if (progresso >= 100) {
                            clearInterval(intervalo);
                            
                            setTimeout(() => {
                                // Treinar modelo
                                const material = document.getElementById('material-previsao').value;
                                const diasAnalise = parseInt(document.getElementById('dias-analise').value) || 60;
                                
                                const modelo = previsaoDemanda.treinarModelo(material, diasAnalise);
                                
                                // Exibir m√©tricas
                                document.getElementById('metricas-modelo').style.display = 'grid';
                                document.getElementById('precisao-modelo').textContent = 
                                    Math.max(0, (100 - modelo.metricas.mape)).toFixed(1) + '%';
                                document.getElementById('r2-score').textContent = modelo.metricas.r2.toFixed(3);
                                document.getElementById('mae-score').textContent = modelo.metricas.mae.toFixed(2);
                                
                                // Determinar tend√™ncia
                                const tendencia = modelo.regressao.slope > 0.1 ? 'üìà Crescimento' : 
                                                modelo.regressao.slope < -0.1 ? 'üìâ Decl√≠nio' : '‚û°Ô∏è Est√°vel';
                                document.getElementById('tendencia').textContent = tendencia;
                                
                                // Habilitar bot√£o de gerar previs√£o
                                document.getElementById('btn-gerar-previsao').disabled = false;
                                document.getElementById('btn-exportar-previsao').disabled = false;
                                
                                // Ocultar status
                                document.getElementById('status-treinamento').style.display = 'none';
                                
                                alert('‚úÖ Modelo treinado com sucesso!');
                            }, 500);
                        }
                    }, 100);
                    
                } catch (error) {
                    document.getElementById('status-treinamento').style.display = 'none';
                    alert('‚ùå Erro ao treinar modelo: ' + error.message);
                }
            });
            
            document.getElementById('btn-gerar-previsao').addEventListener('click', function() {
                if (!previsaoDemanda.modelo) {
                    alert('‚ö†Ô∏è Primeiro treine o modelo antes de gerar previs√µes.');
                    return;
                }
                
                try {
                    const diasPrevisao = parseInt(document.getElementById('dias-previsao').value) || 30;
                    const previsoes = previsaoDemanda.prever(diasPrevisao);
                    
                    // Mostrar tabela de previs√µes
                    document.getElementById('container-tabela').style.display = 'block';
                    const tbody = document.getElementById('tabela-previsoes');
                    tbody.innerHTML = previsoes.map(p => {
                        const confiancaClass = p.confianca > 0.8 ? 'text-green-600' : 
                                              p.confianca > 0.6 ? 'text-yellow-600' : 'text-red-600';
                        const sazonalidadeText = p.fatorSazonal > 1.1 ? 'üìà Alta' :
                                               p.fatorSazonal < 0.9 ? 'üìâ Baixa' : '‚û°Ô∏è Normal';
                        
                        return `
                            <tr>
                                <td class="px-4 py-3 text-sm">${new Date(p.data).toLocaleDateString()}</td>
                                <td class="px-4 py-3 text-sm">${previsaoDemanda.modelo.material || 'Todos'}</td>
                                <td class="px-4 py-3 text-sm font-medium">${p.demandaPrevista.toFixed(2)} t</td>
                                <td class="px-4 py-3 text-sm">${p.intervaloMin.toFixed(2)} - ${p.intervaloMax.toFixed(2)} t</td>
                                <td class="px-4 py-3 text-sm">${sazonalidadeText}</td>
                                <td class="px-4 py-3 text-sm ${confiancaClass}">${(p.confianca * 100).toFixed(1)}%</td>
                            </tr>
                        `;
                    }).join('');
                    
                    // Gerar insights
                    gerarInsights(previsoes);
                    
                    // Mostrar containers
                    document.getElementById('container-insights').style.display = 'grid';
                    
                    alert('‚úÖ Previs√µes geradas com sucesso!');
                    
                } catch (error) {
                    alert('‚ùå Erro ao gerar previs√µes: ' + error.message);
                }
            });
            
            document.getElementById('btn-exportar-previsao').addEventListener('click', function() {
                if (!previsaoDemanda.modelo) {
                    alert('‚ö†Ô∏è Nenhum modelo dispon√≠vel para exportar.');
                    return;
                }
                
                try {
                    const diasPrevisao = parseInt(document.getElementById('dias-previsao').value) || 30;
                    const previsoes = previsaoDemanda.prever(diasPrevisao);
                    
                    // Criar CSV
                    let csv = 'Data,Material,Demanda Prevista,Intervalo Min,Intervalo Max,Fator Sazonal,Confian√ßa\n';
                    previsoes.forEach(p => {
                        csv += `${p.data},${previsaoDemanda.modelo.material || 'Todos'},${p.demandaPrevista.toFixed(2)},${p.intervaloMin.toFixed(2)},${p.intervaloMax.toFixed(2)},${p.fatorSazonal.toFixed(3)},${(p.confianca * 100).toFixed(1)}%\n`;
                    });
                    
                    // Download do arquivo
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `previsao_demanda_${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    alert('‚úÖ Dados exportados com sucesso!');
                    
                } catch (error) {
                    alert('‚ùå Erro ao exportar dados: ' + error.message);
                }
            });
            
            // Fun√ß√£o para gerar insights
            function gerarInsights(previsoes) {
                const insights = [];
                const recomendacoes = [];
                
                // Calcular m√©dias
                const mediaDemanda = previsoes.reduce((sum, p) => sum + p.demandaPrevista, 0) / previsoes.length;
                const maxDemanda = Math.max(...previsoes.map(p => p.demandaPrevista));
                const minDemanda = Math.min(...previsoes.map(p => p.demandaPrevista));
                
                // Insights b√°sicos
                insights.push(`üìä Demanda m√©dia prevista: ${mediaDemanda.toFixed(2)} toneladas`);
                insights.push(`üìà Pico de demanda: ${maxDemanda.toFixed(2)} toneladas`);
                insights.push(`üìâ Menor demanda: ${minDemanda.toFixed(2)} toneladas`);
                
                // Variabilidade
                const variacao = ((maxDemanda - minDemanda) / mediaDemanda * 100);
                if (variacao > 50) {
                    insights.push(`‚ö†Ô∏è Alta variabilidade na demanda (${variacao.toFixed(1)}%)`);
                    recomendacoes.push('üéØ Manter estoque flex√≠vel para absorver varia√ß√µes');
                }
                
                // Tend√™ncia
                const tendenciaPositiva = previsoes.filter((p, i) => i > 0 && p.demandaPrevista > previsoes[i-1].demandaPrevista).length;
                if (tendenciaPositiva > previsoes.length * 0.6) {
                    recomendacoes.push('üìà Tend√™ncia de crescimento - considere aumentar capacidade');
                } else if (tendenciaPositiva < previsoes.length * 0.4) {
                    recomendacoes.push('üìâ Tend√™ncia de queda - otimize custos operacionais');
                }
                
                // Sazonalidade
                const altaSazonalidade = previsoes.filter(p => p.fatorSazonal > 1.2 || p.fatorSazonal < 0.8).length;
                if (altaSazonalidade > previsoes.length * 0.3) {
                    recomendacoes.push('üîÑ Padr√£o sazonal forte - planeje recursos antecipadamente');
                }
                
                // Confian√ßa
                const baixaConfianca = previsoes.filter(p => p.confianca < 0.7).length;
                if (baixaConfianca > previsoes.length * 0.5) {
                    recomendacoes.push('üìä Coletar mais dados hist√≥ricos para melhor precis√£o');
                }
                
                // Exibir insights
                document.getElementById('insights-modelo').innerHTML = insights.map(i => `<p>‚Ä¢ ${i}</p>`).join('');
                document.getElementById('recomendacoes').innerHTML = recomendacoes.map(r => `<p>‚Ä¢ ${r}</p>`).join('');
            }
            
            // Fun√ß√µes para Relat√≥rios
            function atualizarSelectsRelatorio() {
                const selectCliente = document.getElementById('filtro-relatorio-cliente');
                selectCliente.innerHTML = '<option value="">Todos os clientes</option>';
                dadosClientes.forEach(cliente => {
                    selectCliente.innerHTML += `<option value="${cliente.nome}">${cliente.nome}</option>`;
                });
            }
            
            // Fun√ß√µes para Previs√£o
            function atualizarSelectsPrevisao() {
                const selectMaterial = document.getElementById('material-previsao');
                if (selectMaterial) {
                    selectMaterial.innerHTML = '<option value="">Todos os materiais</option>';
                    // Obter lista √∫nica de materiais dos dados de min√©rios
                    const materiaisUnicos = [...new Set(dadosMinerios.map(m => m.nome))];
                    materiaisUnicos.forEach(material => {
                        selectMaterial.innerHTML += `<option value="${material}">${material}</option>`;
                    });
                }
            }
            
            // Event listeners para Firebase e Sincroniza√ß√£o
            document.getElementById('btn-sync-firebase').addEventListener('click', function() {
                if (firebaseManager.isInitialized) {
                    firebaseManager.processSyncQueue();
                    firebaseManager.showSyncStatus('üîÑ Iniciando sincroniza√ß√£o...');
                } else {
                    alert('‚ö†Ô∏è Firebase n√£o est√° inicializado.');
                }
            });
            
            document.getElementById('btn-force-upload').addEventListener('click', function() {
                if (confirm('‚ö†Ô∏è Isso ir√° sobrescrever todos os dados no Firebase com os dados locais. Continuar?')) {
                    if (firebaseManager.isInitialized) {
                        firebaseManager.uploadLocalData();
                        firebaseManager.showSyncStatus('üì§ Fazendo upload for√ßado...');
                    } else {
                        alert('‚ö†Ô∏è Firebase n√£o est√° inicializado.');
                    }
                }
            });
            
            document.getElementById('btn-check-connection').addEventListener('click', function() {
                const status = isFirebaseConnected ? 'üü¢ Conectado' : 'üî¥ Desconectado';
                const queueSize = syncQueue.length;
                alert(`üì° Status da Conex√£o:\n\n${status}\nüìã Itens na fila: ${queueSize}\nüÜî User ID: ${userId || 'N√£o autenticado'}`);
            });
            
            document.getElementById('btn-manual-sync').addEventListener('click', function() {
                if (isFirebaseConnected) {
                    firebaseManager.processSyncQueue();
                    firebaseManager.uploadLocalData();
                    alert('‚úÖ Sincroniza√ß√£o manual iniciada!');
                } else {
                    alert('‚ö†Ô∏è N√£o √© poss√≠vel sincronizar. Verifique sua conex√£o com a internet.');
                }
            });
            
            document.getElementById('btn-reset-firebase').addEventListener('click', function() {
                if (confirm('‚ö†Ô∏è Isso ir√° resetar a conex√£o Firebase. Os dados locais ser√£o preservados. Continuar?')) {
                    // Limpar listeners
                    firebaseManager.listeners.forEach(unsubscribe => {
                        if (typeof unsubscribe === 'function') unsubscribe();
                    });
                    firebaseManager.listeners.clear();
                    
                    // Reinicializar
                    firebaseManager.init();
                    alert('üîß Firebase resetado. Reconectando...');
                }
            });
            
            // Monitorar status online/offline
            window.addEventListener('online', function() {
                isOnline = true;
                console.log('üü¢ Conex√£o restaurada');
                if (firebaseManager.isInitialized) {
                    firebaseManager.showConnectionStatus(true);
                    setTimeout(() => {
                        firebaseManager.processSyncQueue();
                    }, 2000);
                }
            });
            
            window.addEventListener('offline', function() {
                isOnline = false;
                console.log('üî¥ Conex√£o perdida');
                firebaseManager.showConnectionStatus(false, 'Sem internet');
            });
            
            // Atualizar status na interface periodicamente
            setInterval(() => {
                if (document.getElementById('firebase-status')) {
                    document.getElementById('firebase-status').textContent = isFirebaseConnected ? 'Conectado ‚úÖ' : 'Desconectado ‚ùå';
                }
                if (document.getElementById('sync-queue-count')) {
                    document.getElementById('sync-queue-count').textContent = syncQueue.length;
                }
                if (document.getElementById('ultima-sync')) {
                    const lastSync = localStorage.getItem('lastSyncTime');
                    if (lastSync) {
                        const time = new Date(parseInt(lastSync)).toLocaleString();
                        document.getElementById('ultima-sync').textContent = time;
                    } else {
                        document.getElementById('ultima-sync').textContent = 'Nunca';
                    }
                }
            }, 5000);
            
            // Event listeners para relat√≥rios
            document.getElementById('btn-gerar-relatorio').addEventListener('click', function() {
                const dataInicio = document.getElementById('filtro-relatorio-inicio').value;
                const dataFim = document.getElementById('filtro-relatorio-fim').value;
                const cliente = document.getElementById('filtro-relatorio-cliente').value;
                const tipoRelatorio = document.getElementById('tipo-relatorio').value;
                
                gerarRelatorio(tipoRelatorio, dataInicio, dataFim, cliente);
            });
            
            document.getElementById('btn-imprimir-pdf').addEventListener('click', function() {
                const areaRelatorio = document.getElementById('area-relatorio');
                
                if (areaRelatorio.innerHTML.includes('Selecione um tipo de relat√≥rio')) {
                    alert('‚ö†Ô∏è Por favor, gere um relat√≥rio primeiro antes de imprimir.');
                    return;
                }
                
                imprimirRelatorio();
            });
            
            document.getElementById('btn-imprimir-pdf').addEventListener('click', function() {
                const areaRelatorio = document.getElementById('area-relatorio');
                
                if (areaRelatorio.innerHTML.includes('Selecione um tipo de relat√≥rio')) {
                    alert('‚ö†Ô∏è Por favor, gere um relat√≥rio primeiro antes de imprimir.');
                    return;
                }
                
                imprimirRelatorio();
            });
            
            document.getElementById('btn-via-cliente').addEventListener('click', function() {
                const cliente = document.getElementById('filtro-relatorio-cliente').value;
                const dataInicio = document.getElementById('filtro-relatorio-inicio').value;
                const dataFim = document.getElementById('filtro-relatorio-fim').value;
                
                if (!cliente) {
                    alert('‚ö†Ô∏è Por favor, selecione um cliente para gerar a via do cliente.');
                    return;
                }
                
                gerarViaCliente(cliente, dataInicio, dataFim);
            });
            
            function gerarRelatorio(tipo, dataInicio, dataFim, cliente) {
                const areaRelatorio = document.getElementById('area-relatorio');
                let vendasFiltradas = dadosVendas;
                
                // Aplicar filtros
                if (dataInicio) {
                    vendasFiltradas = vendasFiltradas.filter(v => new Date(v.dataVenda) >= new Date(dataInicio));
                }
                if (dataFim) {
                    vendasFiltradas = vendasFiltradas.filter(v => new Date(v.dataVenda) <= new Date(dataFim));
                }
                if (cliente) {
                    vendasFiltradas = vendasFiltradas.filter(v => v.cliente === cliente);
                }
                
                let relatorioHTML = '';
                
                switch(tipo) {
                    case 'vendas':
                        relatorioHTML = gerarRelatorioVendas(vendasFiltradas, cliente);
                        break;
                    case 'clientes':
                        relatorioHTML = gerarRelatorioClientes(vendasFiltradas);
                        break;
                    case 'despesas':
                        relatorioHTML = gerarRelatorioDespesas(vendasFiltradas);
                        break;
                    case 'estoque':
                        relatorioHTML = gerarRelatorioEstoque();
                        break;
                    case 'completo':
                        relatorioHTML = gerarRelatorioCompleto(vendasFiltradas);
                        break;
                }
                
                areaRelatorio.innerHTML = relatorioHTML;
            }
            
            function gerarRelatorioVendas(vendas, clienteFiltro = '') {
                const totalVendas = vendas.length;
                const totalFaturamento = vendas.reduce((sum, v) => sum + v.valorTotal, 0);
                const totalPeso = vendas.reduce((sum, v) => sum + v.pesoCliente, 0);
                
                let html = `
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-empresa-azul mb-4">üìà Relat√≥rio de Vendas</h3>
                        ${clienteFiltro ? `<p class="text-sm text-gray-600 mb-4">Cliente: <strong>${clienteFiltro}</strong></p>` : ''}
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-700">Total de Vendas</h4>
                                <p class="text-2xl font-bold text-blue-600">${totalVendas}</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-medium text-green-700">Faturamento Total</h4>
                                <p class="text-2xl font-bold text-green-600">R$ ${totalFaturamento.toFixed(2)}</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-medium text-yellow-700">Peso Total</h4>
                                <p class="text-2xl font-bold text-yellow-600">${totalPeso.toFixed(1)} t</p>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Data</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Cliente</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Material</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Peso (t)</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Valor</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Motorista</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                vendas.forEach(venda => {
                    html += `
                        <tr>
                            <td class="border border-gray-300 px-4 py-2">${new Date(venda.dataVenda).toLocaleDateString()}</td>
                            <td class="border border-gray-300 px-4 py-2">${venda.cliente}</td>
                            <td class="border border-gray-300 px-4 py-2">${venda.material}</td>
                            <td class="border border-gray-300 px-4 py-2">${venda.pesoCliente.toFixed(1)}</td>
                            <td class="border border-gray-300 px-4 py-2">R$ ${venda.valorTotal.toFixed(2)}</td>
                            <td class="border border-gray-300 px-4 py-2">${venda.motorista}</td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                return html;
            }
            
            function gerarRelatorioClientes(vendas) {
                const clientesResumo = {};
                
                vendas.forEach(venda => {
                    if (!clientesResumo[venda.cliente]) {
                        clientesResumo[venda.cliente] = {
                            totalVendas: 0,
                            totalFaturamento: 0,
                            totalPeso: 0
                        };
                    }
                    
                    clientesResumo[venda.cliente].totalVendas++;
                    clientesResumo[venda.cliente].totalFaturamento += venda.valorTotal;
                    clientesResumo[venda.cliente].totalPeso += venda.pesoCliente;
                });
                
                let html = `
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-empresa-azul mb-4">üë• Relat√≥rio de Clientes</h3>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Cliente</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Vendas</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Faturamento</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Peso Total</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Ticket M√©dio</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                Object.entries(clientesResumo).forEach(([cliente, dados]) => {
                    const ticketMedio = dados.totalFaturamento / dados.totalVendas;
                    html += `
                        <tr>
                            <td class="border border-gray-300 px-4 py-2 font-medium">${cliente}</td>
                            <td class="border border-gray-300 px-4 py-2">${dados.totalVendas}</td>
                            <td class="border border-gray-300 px-4 py-2">R$ ${dados.totalFaturamento.toFixed(2)}</td>
                            <td class="border border-gray-300 px-4 py-2">${dados.totalPeso.toFixed(1)} t</td>
                            <td class="border border-gray-300 px-4 py-2">R$ ${ticketMedio.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                return html;
            }
            
            function gerarRelatorioDespesas(vendas) {
                const totalCustos = vendas.reduce((sum, v) => sum + (v.pesoPedreira * 15), 0); // Custo estimado
                const totalReceita = vendas.reduce((sum, v) => sum + v.valorTotal, 0);
                const lucroEstimado = totalReceita - totalCustos;
                
                return `
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-empresa-azul mb-4">üí∏ Relat√≥rio de Despesas</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-medium text-red-700">Custos Estimados</h4>
                                <p class="text-2xl font-bold text-red-600">R$ ${totalCustos.toFixed(2)}</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-medium text-green-700">Receita Total</h4>
                                <p class="text-2xl font-bold text-green-600">R$ ${totalReceita.toFixed(2)}</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-700">Lucro Estimado</h4>
                                <p class="text-2xl font-bold text-blue-600">R$ ${lucroEstimado.toFixed(2)}</p>
                            </div>
                        </div>
                        
                        <p class="text-sm text-gray-600">
                            <strong>Nota:</strong> Os valores de custo s√£o estimados baseados em R$ 15,00 por tonelada de peso da pedreira.
                        </p>
                    </div>
                `;
            }
            
            function gerarRelatorioEstoque() {
                const totalCreditos = dadosEstoque.filter(e => e.tipo === 'credito').reduce((sum, e) => sum + e.valor, 0);
                const totalDebitos = dadosEstoque.filter(e => e.tipo === 'debito').reduce((sum, e) => sum + e.valor, 0);
                const saldoAtual = totalCreditos - totalDebitos;
                
                return `
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-empresa-azul mb-4">üì¶ Relat√≥rio de Estoque</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-medium text-green-700">Total Cr√©ditos</h4>
                                <p class="text-2xl font-bold text-green-600">R$ ${totalCreditos.toFixed(2)}</p>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-medium text-red-700">Total D√©bitos</h4>
                                <p class="text-2xl font-bold text-red-600">R$ ${totalDebitos.toFixed(2)}</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-700">Saldo Atual</h4>
                                <p class="text-2xl font-bold text-blue-600">R$ ${saldoAtual.toFixed(2)}</p>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Data</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Tipo</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Descri√ß√£o</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">Valor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${dadosEstoque.map(mov => `
                                        <tr>
                                            <td class="border border-gray-300 px-4 py-2">${new Date(mov.data).toLocaleDateString()}</td>
                                            <td class="border border-gray-300 px-4 py-2">
                                                <span class="px-2 py-1 text-xs rounded ${mov.tipo === 'credito' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                    ${mov.tipo === 'credito' ? 'Cr√©dito' : 'D√©bito'}
                                                </span>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2">${mov.descricao}</td>
                                            <td class="border border-gray-300 px-4 py-2 ${mov.tipo === 'credito' ? 'text-green-600' : 'text-red-600'}">
                                                ${mov.tipo === 'credito' ? '+' : '-'} R$ ${mov.valor.toFixed(2)}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            function gerarRelatorioCompleto(vendas) {
                const totalVendas = vendas.length;
                const totalFaturamento = vendas.reduce((sum, v) => sum + v.valorTotal, 0);
                const totalPeso = vendas.reduce((sum, v) => sum + v.pesoCliente, 0);
                
                return `
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-empresa-azul mb-4">üìã Relat√≥rio Completo</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-700">Total Vendas</h4>
                                <p class="text-xl font-bold text-blue-600">${totalVendas}</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-medium text-green-700">Faturamento</h4>
                                <p class="text-xl font-bold text-green-600">R$ ${totalFaturamento.toFixed(2)}</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-medium text-yellow-700">Peso Total</h4>
                                <p class="text-xl font-bold text-yellow-600">${totalPeso.toFixed(1)} t</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-medium text-purple-700">Clientes</h4>
                                <p class="text-xl font-bold text-purple-600">${dadosClientes.length}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            ${gerarRelatorioVendas(vendas)}
                            ${gerarRelatorioClientes(vendas)}
                            ${gerarRelatorioEstoque()}
                        </div>
                    </div>
                `;
            }
            
            function gerarViaCliente(cliente, dataInicio, dataFim) {
                let vendasCliente = dadosVendas.filter(v => v.cliente === cliente);
                
                // Aplicar filtros de data
                if (dataInicio) {
                    vendasCliente = vendasCliente.filter(v => new Date(v.dataVenda) >= new Date(dataInicio));
                }
                if (dataFim) {
                    vendasCliente = vendasCliente.filter(v => new Date(v.dataVenda) <= new Date(dataFim));
                }
                
                if (vendasCliente.length === 0) {
                    alert('‚ùå Nenhuma venda encontrada para este cliente no per√≠odo selecionado.');
                    return;
                }
                
                const totalPeso = vendasCliente.reduce((sum, v) => sum + v.pesoCliente, 0);
                const totalValor = vendasCliente.reduce((sum, v) => sum + v.valorTotal, 0);
                
                // Criar nova janela para impress√£o
                const janelaImpressao = window.open('', '_blank', 'width=800,height=600');
                
                const htmlImpressao = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Via do Cliente - ${cliente}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .cabecalho { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                            .empresa { font-size: 24px; font-weight: bold; color: #22c55e; }
                            .subtitulo { font-size: 14px; color: #666; margin-top: 5px; }
                            .cliente-info { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                            .resumo { display: flex; justify-content: space-between; margin-bottom: 20px; }
                            .resumo-item { text-align: center; padding: 10px; background: #e8f4f8; border-radius: 8px; }
                            .resumo-valor { font-size: 20px; font-weight: bold; color: #2563eb; }
                            table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; font-weight: bold; }
                            .total-row { background-color: #f0f9ff; font-weight: bold; }
                            .rodape { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }
                            @media print {
                                body { margin: 0; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="cabecalho">
                            <div class="empresa">üöõ REI DA CA√áAMBINHA</div>
                            <div class="subtitulo">Sistema de Gest√£o - Transporte de Min√©rios</div>
                        </div>
                        
                        <div class="cliente-info">
                            <h3>üìã Via do Cliente</h3>
                            <p><strong>Cliente:</strong> ${cliente}</p>
                            <p><strong>Per√≠odo:</strong> ${dataInicio || 'In√≠cio'} at√© ${dataFim || 'Hoje'}</p>
                            <p><strong>Data de Emiss√£o:</strong> ${new Date().toLocaleDateString()}</p>
                        </div>
                        
                        <div class="resumo">
                            <div class="resumo-item">
                                <div>Total de Cargas</div>
                                <div class="resumo-valor">${vendasCliente.length}</div>
                            </div>
                            <div class="resumo-item">
                                <div>Peso Total</div>
                                <div class="resumo-valor">${totalPeso.toFixed(1)} t</div>
                            </div>
                            <div class="resumo-item">
                                <div>Valor Total</div>
                                <div class="resumo-valor">R$ ${totalValor.toFixed(2)}</div>
                            </div>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Material</th>
                                    <th>Peso Cliente (t)</th>
                                    <th>Valor Total</th>
                                    <th>Observa√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${vendasCliente.map(venda => `
                                    <tr>
                                        <td>${new Date(venda.dataVenda).toLocaleDateString()}</td>
                                        <td>${venda.material}</td>
                                        <td>${venda.pesoCliente.toFixed(1)}</td>
                                        <td>R$ ${venda.valorTotal.toFixed(2)}</td>
                                        <td>${venda.observacoes || '-'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="2"><strong>TOTAL</strong></td>
                                    <td><strong>${totalPeso.toFixed(1)} t</strong></td>
                                    <td><strong>R$ ${totalValor.toFixed(2)}</strong></td>
                                    <td><strong>${vendasCliente.length} cargas</strong></td>
                                </tr>
                            </tfoot>
                        </table>
                        
                        <div class="rodape">
                            <p>Este documento foi gerado automaticamente pelo Sistema Rei da Ca√ßambinha</p>
                            <p>Data: ${new Date().toLocaleDateString()} - Hora: ${new Date().toLocaleTimeString()}</p>
                        </div>
                        
                        <div class="no-print" style="margin-top: 20px; text-align: center;">
                            <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
                            <button onclick="window.close()">‚ùå Fechar</button>
                        </div>
                    </body>
                    </html>
                `;
                
                janelaImpressao.document.write(htmlImpressao);
                janelaImpressao.document.close();
                
                // Focar na janela e preparar para impress√£o
                janelaImpressao.focus();
                
                // Auto-impress√£o ap√≥s 1 segundo
                setTimeout(() => {
                    janelaImpressao.print();
                }, 1000);
            }
            
            function imprimirRelatorio() {
                const areaRelatorio = document.getElementById('area-relatorio');
                const dataInicio = document.getElementById('filtro-relatorio-inicio').value;
                const dataFim = document.getElementById('filtro-relatorio-fim').value;
                const cliente = document.getElementById('filtro-relatorio-cliente').value;
                const tipoRelatorio = document.getElementById('tipo-relatorio').value;
                
                // Determinar t√≠tulo do relat√≥rio
                let tituloRelatorio = '';
                switch(tipoRelatorio) {
                    case 'vendas': tituloRelatorio = 'üìà Relat√≥rio de Vendas'; break;
                    case 'clientes': tituloRelatorio = 'üë• Relat√≥rio de Clientes'; break;
                    case 'despesas': tituloRelatorio = 'üí∏ Relat√≥rio de Despesas'; break;
                    case 'estoque': tituloRelatorio = 'üì¶ Relat√≥rio de Estoque'; break;
                    case 'completo': tituloRelatorio = 'üìã Relat√≥rio Completo'; break;
                    default: tituloRelatorio = 'üìä Relat√≥rio';
                }
                
                // Criar nova janela para impress√£o
                const janelaImpressao = window.open('', '_blank', 'width=800,height=600');
                
                const htmlImpressao = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${tituloRelatorio} - Rei da Ca√ßambinha</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                margin: 20px; 
                                font-size: 12px; 
                            }
                            .cabecalho { 
                                text-align: center; 
                                margin-bottom: 30px; 
                                border-bottom: 2px solid #333; 
                                padding-bottom: 20px; 
                            }
                            .empresa { 
                                font-size: 24px; 
                                font-weight: bold; 
                                color: #22c55e; 
                            }
                            .subtitulo { 
                                font-size: 14px; 
                                color: #666; 
                                margin-top: 5px; 
                            }
                            .filtros-info { 
                                background: #f8f9fa; 
                                padding: 15px; 
                                border-radius: 8px; 
                                margin-bottom: 20px; 
                            }
                            .filtros-info h4 { 
                                margin: 0 0 10px 0; 
                                color: #3b82f6; 
                            }
                            table { 
                                width: 100%; 
                                border-collapse: collapse; 
                                margin: 15px 0; 
                                font-size: 11px; 
                            }
                            th, td { 
                                border: 1px solid #ddd; 
                                padding: 6px; 
                                text-align: left; 
                            }
                            th { 
                                background-color: #f2f2f2; 
                                font-weight: bold; 
                                font-size: 10px; 
                            }
                            .total-row { 
                                background-color: #f0f9ff; 
                                font-weight: bold; 
                            }
                            .resumo-cards { 
                                display: grid; 
                                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                                gap: 15px; 
                                margin: 20px 0; 
                            }
                            .card { 
                                background: #f8f9fa; 
                                padding: 10px; 
                                border-radius: 8px; 
                                text-align: center; 
                                border: 1px solid #ddd; 
                            }
                            .card h4 { 
                                margin: 0 0 5px 0; 
                                font-size: 11px; 
                                color: #666; 
                            }
                            .card .valor { 
                                font-size: 16px; 
                                font-weight: bold; 
                                color: #2563eb; 
                            }
                            .rodape { 
                                margin-top: 30px; 
                                text-align: center; 
                                font-size: 10px; 
                                color: #666; 
                                border-top: 1px solid #ddd; 
                                padding-top: 15px; 
                            }
                            @media print {
                                body { margin: 0; }
                                .no-print { display: none; }
                            }
                            .conteudo-relatorio { 
                                font-size: 11px; 
                            }
                            .conteudo-relatorio h3 { 
                                color: #3b82f6; 
                                font-size: 16px; 
                                margin: 15px 0 10px 0; 
                            }
                            .conteudo-relatorio h4 { 
                                color: #666; 
                                font-size: 12px; 
                                margin: 10px 0 5px 0; 
                            }
                        </style>
                    </head>
                    <body>
                        <div class="cabecalho">
                            <div class="empresa">üöõ REI DA CA√áAMBINHA</div>
                            <div class="subtitulo">Sistema de Gest√£o - Transporte de Min√©rios</div>
                        </div>
                        
                        <div class="filtros-info">
                            <h4>${tituloRelatorio}</h4>
                            <p><strong>Per√≠odo:</strong> ${dataInicio || 'In√≠cio'} at√© ${dataFim || 'Hoje'}</p>
                            ${cliente ? `<p><strong>Cliente:</strong> ${cliente}</p>` : ''}
                            <p><strong>Data de Emiss√£o:</strong> ${new Date().toLocaleDateString()} √†s ${new Date().toLocaleTimeString()}</p>
                        </div>
                        
                        <div class="conteudo-relatorio">
                            ${areaRelatorio.innerHTML}
                        </div>
                        
                        <div class="rodape">
                            <p>Este relat√≥rio foi gerado automaticamente pelo Sistema Rei da Ca√ßambinha</p>
                            <p>Data: ${new Date().toLocaleDateString()} - Hora: ${new Date().toLocaleTimeString()}</p>
                        </div>
                        
                        <div class="no-print" style="margin-top: 20px; text-align: center;">
                            <button onclick="window.print()" style="padding: 10px 20px; font-size: 14px; margin-right: 10px;">üñ®Ô∏è Imprimir</button>
                            <button onclick="window.close()" style="padding: 10px 20px; font-size: 14px;">‚ùå Fechar</button>
                        </div>
                    </body>
                    </html>
                `;
                
                janelaImpressao.document.write(htmlImpressao);
                janelaImpressao.document.close();
                
                // Focar na janela e preparar para impress√£o
                janelaImpressao.focus();
                
                // Auto-impress√£o ap√≥s 1 segundo
                setTimeout(() => {
                    janelaImpressao.print();
                }, 1000);
            }
            
            function imprimirRelatorio() {
                const areaRelatorio = document.getElementById('area-relatorio');
                const dataInicio = document.getElementById('filtro-relatorio-inicio').value;
                const dataFim = document.getElementById('filtro-relatorio-fim').value;
                const cliente = document.getElementById('filtro-relatorio-cliente').value;
                const tipoRelatorio = document.getElementById('tipo-relatorio').value;
                
                // Determinar t√≠tulo do relat√≥rio
                let tituloRelatorio = '';
                switch(tipoRelatorio) {
                    case 'vendas': tituloRelatorio = 'üìà Relat√≥rio de Vendas'; break;
                    case 'clientes': tituloRelatorio = 'üë• Relat√≥rio de Clientes'; break;
                    case 'despesas': tituloRelatorio = 'üí∏ Relat√≥rio de Despesas'; break;
                    case 'estoque': tituloRelatorio = 'üì¶ Relat√≥rio de Estoque'; break;
                    case 'completo': tituloRelatorio = 'üìã Relat√≥rio Completo'; break;
                    default: tituloRelatorio = 'üìä Relat√≥rio';
                }
                
                // Criar nova janela para impress√£o
                const janelaImpressao = window.open('', '_blank', 'width=800,height=600');
                
                const htmlImpressao = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${tituloRelatorio} - Rei da Ca√ßambinha</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                margin: 20px; 
                                font-size: 12px; 
                            }
                            .cabecalho { 
                                text-align: center; 
                                margin-bottom: 30px; 
                                border-bottom: 2px solid #333; 
                                padding-bottom: 20px; 
                            }
                            .empresa { 
                                font-size: 24px; 
                                font-weight: bold; 
                                color: #22c55e; 
                            }
                            .subtitulo { 
                                font-size: 14px; 
                                color: #666; 
                                margin-top: 5px; 
                            }
                            .filtros-info { 
                                background: #f8f9fa; 
                                padding: 15px; 
                                border-radius: 8px; 
                                margin-bottom: 20px; 
                            }
                            .filtros-info h4 { 
                                margin: 0 0 10px 0; 
                                color: #3b82f6; 
                            }
                            table { 
                                width: 100%; 
                                border-collapse: collapse; 
                                margin: 15px 0; 
                                font-size: 11px; 
                            }
                            th, td { 
                                border: 1px solid #ddd; 
                                padding: 6px; 
                                text-align: left; 
                            }
                            th { 
                                background-color: #f2f2f2; 
                                font-weight: bold; 
                                font-size: 10px; 
                            }
                            .total-row { 
                                background-color: #f0f9ff; 
                                font-weight: bold; 
                            }
                            .resumo-cards { 
                                display: grid; 
                                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                                gap: 15px; 
                                margin: 20px 0; 
                            }
                            .card { 
                                background: #f8f9fa; 
                                padding: 10px; 
                                border-radius: 8px; 
                                text-align: center; 
                                border: 1px solid #ddd; 
                            }
                            .card h4 { 
                                margin: 0 0 5px 0; 
                                font-size: 11px; 
                                color: #666; 
                            }
                            .card .valor { 
                                font-size: 16px; 
                                font-weight: bold; 
                                color: #2563eb; 
                            }
                            .rodape { 
                                margin-top: 30px; 
                                text-align: center; 
                                font-size: 10px; 
                                color: #666; 
                                border-top: 1px solid #ddd; 
                                padding-top: 15px; 
                            }
                            @media print {
                                body { margin: 0; }
                                .no-print { display: none; }
                            }
                            .conteudo-relatorio { 
                                font-size: 11px; 
                            }
                            .conteudo-relatorio h3 { 
                                color: #3b82f6; 
                                font-size: 16px; 
                                margin: 15px 0 10px 0; 
                            }
                            .conteudo-relatorio h4 { 
                                color: #666; 
                                font-size: 12px; 
                                margin: 10px 0 5px 0; 
                            }
                        </style>
                    </head>
                    <body>
                        <div class="cabecalho">
                            <div class="empresa">üöõ REI DA CA√áAMBINHA</div>
                            <div class="subtitulo">Sistema de Gest√£o - Transporte de Min√©rios</div>
                        </div>
                        
                        <div class="filtros-info">
                            <h4>${tituloRelatorio}</h4>
                            <p><strong>Per√≠odo:</strong> ${dataInicio || 'In√≠cio'} at√© ${dataFim || 'Hoje'}</p>
                            ${cliente ? `<p><strong>Cliente:</strong> ${cliente}</p>` : ''}
                            <p><strong>Data de Emiss√£o:</strong> ${new Date().toLocaleDateString()} √†s ${new Date().toLocaleTimeString()}</p>
                        </div>
                        
                        <div class="conteudo-relatorio">
                            ${areaRelatorio.innerHTML}
                        </div>
                        
                        <div class="rodape">
                            <p>Este relat√≥rio foi gerado automaticamente pelo Sistema Rei da Ca√ßambinha</p>
                            <p>Data: ${new Date().toLocaleDateString()} - Hora: ${new Date().toLocaleTimeString()}</p>
                        </div>
                        
                        <div class="no-print" style="margin-top: 20px; text-align: center;">
                            <button onclick="window.print()" style="padding: 10px 20px; font-size: 14px; margin-right: 10px;">üñ®Ô∏è Imprimir</button>
                            <button onclick="window.close()" style="padding: 10px 20px; font-size: 14px;">‚ùå Fechar</button>
                        </div>
                    </body>
                    </html>
                `;
                
                janelaImpressao.document.write(htmlImpressao);
                janelaImpressao.document.close();
                
                // Focar na janela e preparar para impress√£o
                janelaImpressao.focus();
                
                // Auto-impress√£o ap√≥s 1 segundo
                setTimeout(() => {
                    janelaImpressao.print();
                }, 1000);
            }
            
            // Fun√ß√µes de Importa√ß√£o
            
            // Gerar dados de exemplo
            document.getElementById('btn-gerar-dados-exemplo').addEventListener('click', function() {
                if (confirm('‚ö†Ô∏è Isso ir√° substituir todos os dados atuais por dados de exemplo. Continuar?')) {
                    gerarDadosExemplo();
                }
            });
            
            function gerarDadosExemplo() {
                // Dados de exemplo - Clientes
                dadosClientes = [
                    {
                        id: 1,
                        nome: "Construtora Silva & Cia",
                        cnpj: "12.345.678/0001-90",
                        telefone: "(11) 99999-1111",
                        endereco: "Centro, S√£o Paulo - SP",
                        distancia: 15.5,
                        status: "ativo",
                        dataCadastro: new Date('2024-01-15').toISOString()
                    },
                    {
                        id: 2,
                        nome: "Obras Oliveira Ltda",
                        cnpj: "98.765.432/0001-10",
                        telefone: "(11) 88888-2222",
                        endereco: "Vila Mariana, S√£o Paulo - SP",
                        distancia: 8.2,
                        status: "ativo",
                        dataCadastro: new Date('2024-01-20').toISOString()
                    },
                    {
                        id: 3,
                        nome: "Construtora ABC",
                        cnpj: "11.222.333/0001-44",
                        telefone: "(11) 77777-3333",
                        endereco: "Mooca, S√£o Paulo - SP",
                        distancia: 22.1,
                        status: "ativo",
                        dataCadastro: new Date('2024-02-01').toISOString()
                    },
                    {
                        id: 4,
                        nome: "Reformas Express",
                        cnpj: "55.666.777/0001-88",
                        telefone: "(11) 66666-4444",
                        endereco: "Tatuap√©, S√£o Paulo - SP",
                        distancia: 12.7,
                        status: "ativo",
                        dataCadastro: new Date('2024-02-10').toISOString()
                    },
                    {
                        id: 5,
                        nome: "Construtora Horizonte",
                        cnpj: "99.888.777/0001-66",
                        telefone: "(11) 55555-5555",
                        endereco: "Ipiranga, S√£o Paulo - SP",
                        distancia: 18.3,
                        status: "ativo",
                        dataCadastro: new Date('2024-02-15').toISOString()
                    }
                ];
                
                // Dados de exemplo - Materiais (com c√°lculo autom√°tico do pre√ßo por m¬≥)
                dadosMinerios = [
                    {
                        id: 1,
                        nome: "Areia M√©dia",
                        categoria: "Areia",
                        precoTonelada: 45.00,
                        precoMetro: 45.00 * 1.6, // Calculado automaticamente
                        densidade: 1.6,
                        unidadePrincipal: "tonelada",
                        status: "ativo",
                        observacoes: "Areia m√©dia para constru√ß√£o civil",
                        dataCadastro: new Date('2024-01-10').toISOString()
                    },
                    {
                        id: 2,
                        nome: "Brita 1",
                        categoria: "Brita",
                        precoTonelada: 50.00,
                        precoMetro: 50.00 * 1.6, // Calculado automaticamente
                        densidade: 1.6,
                        unidadePrincipal: "tonelada",
                        status: "ativo",
                        observacoes: "Brita n√∫mero 1 para concreto",
                        dataCadastro: new Date('2024-01-10').toISOString()
                    },
                    {
                        id: 3,
                        nome: "Brita 2",
                        categoria: "Brita",
                        precoTonelada: 52.00,
                        precoMetro: 52.00 * 1.7, // Calculado automaticamente
                        densidade: 1.7,
                        unidadePrincipal: "tonelada",
                        status: "ativo",
                        observacoes: "Brita n√∫mero 2 para concreto pesado",
                        dataCadastro: new Date('2024-01-10').toISOString()
                    },
                    {
                        id: 4,
                        nome: "Pedrisco",
                        categoria: "Pedrisco",
                        precoTonelada: 38.00,
                        precoMetro: 38.00 * 1.3, // Calculado automaticamente
                        densidade: 1.3,
                        unidadePrincipal: "tonelada",
                        status: "ativo",
                        observacoes: "Pedrisco para acabamento",
                        dataCadastro: new Date('2024-01-10').toISOString()
                    },
                    {
                        id: 5,
                        nome: "Rach√£o",
                        categoria: "Rach√£o",
                        precoTonelada: 35.00,
                        precoMetro: 35.00 * 1.2, // Calculado automaticamente
                        densidade: 1.2,
                        unidadePrincipal: "tonelada",
                        status: "ativo",
                        observacoes: "Rach√£o para aterro",
                        dataCadastro: new Date('2024-01-10').toISOString()
                    }
                ];
                
                // Dados de exemplo - Motoristas
                dadosMotoristas = [
                    {
                        id: 1,
                        nome: "Jo√£o Silva",
                        cnh: "12345678901",
                        vencimentoCnh: "2025-12-31",
                        vencimentoToxicologico: "2025-06-30",
                        telefone: "(11) 99999-8888",
                        status: "ativo",
                        observacoes: "Motorista experiente",
                        dataCadastro: new Date('2024-01-05').toISOString()
                    },
                    {
                        id: 2,
                        nome: "Pedro Santos",
                        cnh: "98765432109",
                        vencimentoCnh: "2025-08-15",
                        vencimentoToxicologico: "2025-04-20",
                        telefone: "(11) 88888-7777",
                        status: "ativo",
                        observacoes: "Motorista cuidadoso",
                        dataCadastro: new Date('2024-01-08').toISOString()
                    },
                    {
                        id: 3,
                        nome: "Carlos Oliveira",
                        cnh: "11111222233",
                        vencimentoCnh: "2025-10-10",
                        vencimentoToxicologico: "2025-03-15",
                        telefone: "(11) 77777-6666",
                        status: "ativo",
                        observacoes: "Motorista pontual",
                        dataCadastro: new Date('2024-01-12').toISOString()
                    }
                ];
                
                // Dados de exemplo - Ve√≠culos
                dadosVeiculos = [
                    {
                        id: 1,
                        placa: "ABC-1234",
                        modelo: "Mercedes-Benz 1620",
                        motorista: "Jo√£o Silva",
                        tara: 8500,
                        status: "ativo",
                        observacoes: "Ve√≠culo em bom estado",
                        dataCadastro: new Date('2024-01-05').toISOString()
                    },
                    {
                        id: 2,
                        placa: "DEF-5678",
                        modelo: "Volvo VM 270",
                        motorista: "Pedro Santos",
                        tara: 9200,
                        status: "ativo",
                        observacoes: "Ve√≠culo rec√©m revisado",
                        dataCadastro: new Date('2024-01-08').toISOString()
                    },
                    {
                        id: 3,
                        placa: "GHI-9012",
                        modelo: "Scania P 310",
                        motorista: "Carlos Oliveira",
                        tara: 8800,
                        status: "ativo",
                        observacoes: "Ve√≠culo com ca√ßamba nova",
                        dataCadastro: new Date('2024-01-12').toISOString()
                    }
                ];
                
                // Dados de exemplo - Vendas
                dadosVendas = [
                    {
                        id: 1,
                        material: "Areia M√©dia",
                        cliente: "Construtora Silva & Cia",
                        veiculo: "ABC-1234",
                        motorista: "Jo√£o Silva",
                        pesoPedreira: 12.5,
                        pesoCliente: 12.0,
                        valorTotal: 540.00,
                        valorPago: 540.00,
                        saldo: 0.00,
                        custoTotal: 12.5 * 45.00, // Custo: peso √ó custo do material
                        lucro: 540.00 - (12.5 * 45.00), // Lucro: venda - custo
                        precoTonelada: 45.00,
                        tipoPagamento: "pix",
                        prazoDias: 0,
                        observacoes: "Entrega para obra da Rua A",
                        dataVenda: new Date('2024-02-01').toISOString(),
                        statusPagamento: "pago"
                    },
                    {
                        id: 2,
                        material: "Brita 1",
                        cliente: "Obras Oliveira Ltda",
                        veiculo: "DEF-5678",
                        motorista: "Pedro Santos",
                        pesoPedreira: 15.0,
                        pesoCliente: 14.5,
                        valorTotal: 725.00,
                        valorPago: 300.00,
                        saldo: 425.00,
                        tipoPagamento: "prazo",
                        prazoDias: 30,
                        observacoes: "Pagamento parcial de R$ 300",
                        dataVenda: new Date('2024-02-05').toISOString(),
                        statusPagamento: "parcial"
                    },
                    {
                        id: 3,
                        material: "Brita 2",
                        cliente: "Construtora ABC",
                        veiculo: "GHI-9012",
                        motorista: "Carlos Oliveira",
                        pesoPedreira: 13.2,
                        pesoCliente: 13.0,
                        valorTotal: 676.00,
                        valorPago: 0.00,
                        saldo: 676.00,
                        tipoPagamento: "prazo",
                        prazoDias: 15,
                        observacoes: "Entrega urgente",
                        dataVenda: new Date('2024-02-10').toISOString(),
                        statusPagamento: "aberto"
                    },
                    {
                        id: 4,
                        material: "Pedrisco",
                        cliente: "Reformas Express",
                        veiculo: "ABC-1234",
                        motorista: "Jo√£o Silva",
                        pesoPedreira: 10.0,
                        pesoCliente: 9.8,
                        valorTotal: 372.40,
                        valorPago: 372.40,
                        saldo: 0.00,
                        tipoPagamento: "dinheiro",
                        prazoDias: 0,
                        observacoes: "Pagamento √† vista",
                        dataVenda: new Date('2024-02-12').toISOString(),
                        statusPagamento: "pago"
                    },
                    {
                        id: 5,
                        material: "Rach√£o",
                        cliente: "Construtora Horizonte",
                        veiculo: "DEF-5678",
                        motorista: "Pedro Santos",
                        pesoPedreira: 16.0,
                        pesoCliente: 15.5,
                        valorTotal: 542.50,
                        valorPago: 0.00,
                        saldo: 542.50,
                        tipoPagamento: "prazo",
                        prazoDias: 30,
                        observacoes: "Aterro para funda√ß√£o",
                        dataVenda: new Date('2024-02-15').toISOString(),
                        statusPagamento: "aberto"
                    },
                    {
                        id: 6,
                        material: "Areia M√©dia",
                        cliente: "Construtora Silva & Cia",
                        veiculo: "GHI-9012",
                        motorista: "Carlos Oliveira",
                        pesoPedreira: 11.8,
                        pesoCliente: 11.5,
                        valorTotal: 517.50,
                        valorPago: 200.00,
                        saldo: 317.50,
                        custoTotal: 11.8 * 45.00, // Custo correto: peso √ó custo do material
                        lucro: 517.50 - (11.8 * 45.00), // Lucro: venda - custo
                        precoTonelada: 45.00,
                        tipoPagamento: "prazo",
                        prazoDias: 15,
                        observacoes: "Segunda entrega para obra",
                        dataVenda: new Date('2024-02-18').toISOString(),
                        statusPagamento: "parcial"
                    }
                ];
                
                // Dados de exemplo - Estoque
                dadosEstoque = [
                    {
                        id: 1,
                        tipo: "credito",
                        valor: 5000.00,
                        descricao: "Investimento inicial",
                        observacoes: "Capital inicial para opera√ß√£o",
                        data: new Date('2024-01-01').toISOString()
                    },
                    {
                        id: 2,
                        tipo: "credito",
                        valor: 2500.00,
                        descricao: "Reposi√ß√£o de estoque",
                        observacoes: "Compra de materiais",
                        data: new Date('2024-01-15').toISOString()
                    },
                    {
                        id: 3,
                        tipo: "debito",
                        valor: 1200.00,
                        descricao: "Manuten√ß√£o de ve√≠culos",
                        observacoes: "Revis√£o preventiva",
                        data: new Date('2024-01-20').toISOString()
                    },
                    {
                        id: 4,
                        tipo: "debito",
                        valor: 800.00,
                        descricao: "Combust√≠vel",
                        observacoes: "Abastecimento da frota",
                        data: new Date('2024-02-01').toISOString()
                    },
                    {
                        id: 5,
                        tipo: "credito",
                        valor: 1800.00,
                        descricao: "Recebimento de clientes",
                        observacoes: "Pagamentos √† vista",
                        data: new Date('2024-02-10').toISOString()
                    }
                ];
                
                // Dados de exemplo - Pagamentos
                dadosPagamentos = [
                    {
                        id: 1,
                        cliente: "Construtora Silva & Cia",
                        valorPago: 540.00,
                        valorAplicado: 540.00,
                        valorResidual: 0.00,
                        formaPagamento: "pix",
                        data: new Date('2024-02-01').toISOString(),
                        observacoes: "Pagamento √† vista",
                        vendasAfetadas: [1]
                    },
                    {
                        id: 2,
                        cliente: "Obras Oliveira Ltda",
                        valorPago: 300.00,
                        valorAplicado: 300.00,
                        valorResidual: 0.00,
                        formaPagamento: "transferencia",
                        data: new Date('2024-02-08').toISOString(),
                        observacoes: "Pagamento parcial",
                        vendasAfetadas: [2]
                    },
                    {
                        id: 3,
                        cliente: "Reformas Express",
                        valorPago: 372.40,
                        valorAplicado: 372.40,
                        valorResidual: 0.00,
                        formaPagamento: "dinheiro",
                        data: new Date('2024-02-12').toISOString(),
                        observacoes: "Pagamento √† vista",
                        vendasAfetadas: [4]
                    },
                    {
                        id: 4,
                        cliente: "Construtora Silva & Cia",
                        valorPago: 200.00,
                        valorAplicado: 200.00,
                        valorResidual: 0.00,
                        formaPagamento: "pix",
                        data: new Date('2024-02-20').toISOString(),
                        observacoes: "Pagamento parcial da segunda venda",
                        vendasAfetadas: [6]
                    }
                ];
                
                // Configura√ß√£o padr√£o do dia (exemplo)
                configDia = {
                    veiculoPadrao: "ABC-1234",
                    motoristaPadrao: "Jo√£o Silva"
                };
                
                // Salvar todos os dados
                salvarDados();
                
                // Atualizar todas as interfaces
                atualizarDashboard();
                atualizarListaMinerios();
                atualizarListaClientes();
                atualizarListaVeiculos();
                atualizarListaMotoristas();
                atualizarListaVendas();
                atualizarListaMovimentacoes();
                atualizarListaCobrancas();
                atualizarSelectsVenda();
                atualizarSelectsCobranca();
                atualizarSelectsRelatorio();
                atualizarResumoCobrancas();
                
                alert('‚úÖ Dados de exemplo carregados com sucesso!\n\nüìä Resumo dos dados carregados:\n‚Ä¢ 5 Clientes\n‚Ä¢ 5 Materiais\n‚Ä¢ 3 Motoristas\n‚Ä¢ 3 Ve√≠culos\n‚Ä¢ 6 Vendas\n‚Ä¢ 5 Movimenta√ß√µes de Estoque\n‚Ä¢ 4 Pagamentos\n\nAgora voc√™ pode testar todas as funcionalidades do sistema!');
            }
            
            // Importar arquivo JSON completo
            document.getElementById('btn-import-completo').addEventListener('click', function() {
                const fileInput = document.getElementById('import-completo');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('‚ö†Ô∏è Por favor, selecione um arquivo JSON para importar.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const dadosImportados = JSON.parse(e.target.result);
                        
                        // Validar estrutura dos dados
                        if (!dadosImportados || typeof dadosImportados !== 'object') {
                            throw new Error('Formato de arquivo inv√°lido');
                        }
                        
                        // Importar dados se existirem
                        if (dadosImportados.clientes) dadosClientes = dadosImportados.clientes;
                        if (dadosImportados.minerios) dadosMinerios = dadosImportados.minerios;
                        if (dadosImportados.motoristas) dadosMotoristas = dadosImportados.motoristas;
                        if (dadosImportados.veiculos) dadosVeiculos = dadosImportados.veiculos;
                        if (dadosImportados.vendas) dadosVendas = dadosImportados.vendas;
                        if (dadosImportados.estoque) dadosEstoque = dadosImportados.estoque;
                        if (dadosImportados.pagamentos) dadosPagamentos = dadosImportados.pagamentos;
                        
                        // Salvar e atualizar interface
                        salvarDados();
                        atualizarTodasAsListas();
                        
                        alert('‚úÖ Dados importados com sucesso!');
                        
                    } catch (error) {
                        alert('‚ùå Erro ao importar dados: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            });
            
            // Importar clientes
            document.getElementById('btn-import-clientes').addEventListener('click', function() {
                const fileInput = document.getElementById('import-clientes');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('‚ö†Ô∏è Por favor, selecione um arquivo para importar.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let dadosImportados;
                        
                        if (file.name.endsWith('.json')) {
                            dadosImportados = JSON.parse(e.target.result);
                            if (dadosImportados.clientes) {
                                dadosImportados = dadosImportados.clientes;
                            }
                        } else if (file.name.endsWith('.csv')) {
                            dadosImportados = parseCSV(e.target.result, 'clientes');
                        }
                        
                        // Validar e importar dados
                        if (Array.isArray(dadosImportados) && dadosImportados.length > 0) {
                            dadosClientes = dadosImportados.map((cliente, index) => ({
                                id: cliente.id || Date.now() + index,
                                nome: cliente.nome || '',
                                cnpj: cliente.cnpj || '',
                                telefone: cliente.telefone || '',
                                endereco: cliente.endereco || '',
                                distancia: parseFloat(cliente.distancia) || 0,
                                status: cliente.status || 'ativo',
                                dataCadastro: cliente.dataCadastro || new Date().toISOString()
                            }));
                            
                            salvarDados();
                            atualizarListaClientes();
                            atualizarSelectsVenda();
                            atualizarSelectsCobranca();
                            atualizarSelectsRelatorio();
                            atualizarDashboard();
                            
                            alert(`‚úÖ ${dadosClientes.length} clientes importados com sucesso!`);
                        } else {
                            throw new Error('Formato de dados inv√°lido');
                        }
                        
                    } catch (error) {
                        alert('‚ùå Erro ao importar clientes: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            });
            
            // Importar materiais
            document.getElementById('btn-import-materiais').addEventListener('click', function() {
                const fileInput = document.getElementById('import-materiais');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('‚ö†Ô∏è Por favor, selecione um arquivo para importar.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let dadosImportados;
                        
                        if (file.name.endsWith('.json')) {
                            dadosImportados = JSON.parse(e.target.result);
                            if (dadosImportados.materiais || dadosImportados.minerios) {
                                dadosImportados = dadosImportados.materiais || dadosImportados.minerios;
                            }
                        } else if (file.name.endsWith('.csv')) {
                            dadosImportados = parseCSV(e.target.result, 'materiais');
                        }
                        
                        // Validar e importar dados
                        if (Array.isArray(dadosImportados) && dadosImportados.length > 0) {
                            dadosMinerios = dadosImportados.map((material, index) => {
                                const precoTonelada = parseFloat(material.precoTonelada) || 0;
                                const densidade = parseFloat(material.densidade) || 0;
                                const precoMetro = densidade > 0 ? precoTonelada * densidade : (parseFloat(material.precoMetro) || 0);
                                
                                return {
                                    id: material.id || Date.now() + index,
                                    nome: material.nome || '',
                                    categoria: material.categoria || 'Outros',
                                    precoTonelada: precoTonelada,
                                    precoMetro: precoMetro,
                                    densidade: densidade,
                                    unidadePrincipal: material.unidadePrincipal || 'tonelada',
                                    status: material.status || 'ativo',
                                    observacoes: material.observacoes || '',
                                    dataCadastro: material.dataCadastro || new Date().toISOString()
                                };
                            });
                            
                            salvarDados();
                            atualizarListaMinerios();
                            atualizarSelectsVenda();
                            atualizarDashboard();
                            
                            alert(`‚úÖ ${dadosMinerios.length} materiais importados com sucesso!`);
                        } else {
                            throw new Error('Formato de dados inv√°lido');
                        }
                        
                    } catch (error) {
                        alert('‚ùå Erro ao importar materiais: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            });
            
            // Fun√ß√£o para converter CSV em JSON
            function parseCSV(csvText, tipo) {
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    const obj = {};
                    
                    headers.forEach((header, index) => {
                        obj[header] = values[index] || '';
                    });
                    
                    data.push(obj);
                }
                
                return data;
            }
            
            // Fun√ß√£o para atualizar todas as listas
            function atualizarTodasAsListas() {
                atualizarDashboard();
                atualizarListaMinerios();
                atualizarListaClientes();
                atualizarListaVeiculos();
                atualizarListaMotoristas();
                atualizarListaVendas();
                atualizarListaMovimentacoes();
                atualizarListaCobrancas();
                atualizarSelectsVenda();
                atualizarSelectsCobranca();
                atualizarSelectsRelatorio();
                atualizarResumoCobrancas();
            }
            
            // Fun√ß√£o para atualizar lista de pre√ßos espec√≠ficos do cliente
            function atualizarListaPrecosCliente(nomeCliente) {
                const tbody = document.getElementById('lista-precos-cliente');
                const precosCliente = dadosPrecos.filter(p => p.cliente === nomeCliente);
                
                if (precosCliente.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-6 text-center text-gray-500">üí∞ Nenhum pre√ßo configurado ainda</td></tr>';
                    return;
                }
                
                tbody.innerHTML = precosCliente.map(preco => {
                    const material = dadosMinerios.find(m => m.nome === preco.material);
                    return `
                        <tr>
                            <td class="px-4 py-2 text-sm font-medium text-gray-900">${preco.material}</td>
                            <td class="px-4 py-2 text-sm text-gray-500">${material ? material.categoria : '-'}</td>
                            <td class="px-4 py-2 text-sm text-gray-500">${preco.tipo === 'tonelada' ? 'Por Tonelada' : 'Por Metro'}</td>
                            <td class="px-4 py-2 text-sm font-medium text-empresa-verde">R$ ${preco.preco.toFixed(2)}</td>
                            <td class="px-4 py-2 text-sm text-gray-500">
                                <button onclick="excluirPrecoCliente('${nomeCliente}', '${preco.material}', '${preco.tipo}')" class="text-red-600 hover:text-red-900" title="Excluir pre√ßo">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Event listeners para modal de pre√ßos
            document.getElementById('fechar-modal').addEventListener('click', function() {
                document.getElementById('modal-precos').classList.add('hidden');
            });
            
            document.getElementById('btn-add-preco').addEventListener('click', function() {
                const nomeCliente = document.getElementById('modal-precos').getAttribute('data-cliente');
                const material = document.getElementById('select-material').value;
                const tipo = document.getElementById('tipo-preco').value;
                const preco = parseFloat(document.getElementById('preco-cliente').value);
                
                if (!material || !preco || preco <= 0) {
                    alert('‚ö†Ô∏è Por favor, preencha todos os campos corretamente.');
                    return;
                }
                
                // Verificar se j√° existe pre√ßo para este material e tipo
                const precoExistente = dadosPrecos.find(p => 
                    p.cliente === nomeCliente && 
                    p.material === material && 
                    p.tipo === tipo
                );
                
                if (precoExistente) {
                    if (confirm('J√° existe um pre√ßo configurado para este material e tipo. Deseja substituir?')) {
                        precoExistente.preco = preco;
                        precoExistente.dataAtualizacao = new Date().toISOString();
                    } else {
                        return;
                    }
                } else {
                    // Adicionar novo pre√ßo
                    const novoPreco = {
                        id: Date.now(),
                        cliente: nomeCliente,
                        material: material,
                        tipo: tipo,
                        preco: preco,
                        dataCriacao: new Date().toISOString()
                    };
                    
                    dadosPrecos.push(novoPreco);
                }
                
                salvarDados();
                atualizarListaPrecosCliente(nomeCliente);
                
                // Limpar campos
                document.getElementById('select-material').value = '';
                document.getElementById('preco-cliente').value = '';
                
                alert('‚úÖ Pre√ßo adicionado com sucesso!');
            });
            
            document.getElementById('salvar-precos').addEventListener('click', function() {
                document.getElementById('modal-precos').classList.add('hidden');
                alert('‚úÖ Pre√ßos salvos com sucesso!');
            });
            
            // Fun√ß√£o para excluir pre√ßo espec√≠fico
            window.excluirPrecoCliente = function(cliente, material, tipo) {
                if (confirm(`Tem certeza que deseja excluir o pre√ßo de ${material} (${tipo}) para ${cliente}?`)) {
                    dadosPrecos = dadosPrecos.filter(p => 
                        !(p.cliente === cliente && p.material === material && p.tipo === tipo)
                    );
                    salvarDados();
                    atualizarListaPrecosCliente(cliente);
                    alert('‚úÖ Pre√ßo exclu√≠do com sucesso!');
                }
            };
            
            // Fechar modal clicando fora
            document.getElementById('modal-precos').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });
            
            // Event listeners para configura√ß√£o do dia
            document.getElementById('btn-salvar-padrao').addEventListener('click', function() {
                const veiculo = document.getElementById('veiculo-padrao-dia').value;
                const motorista = document.getElementById('motorista-padrao-dia').value;
                
                configDia.veiculoPadrao = veiculo;
                configDia.motoristaPadrao = motorista;
                
                salvarDados();
                alert('‚úÖ Configura√ß√£o padr√£o do dia salva com sucesso!');
            });
            
            document.getElementById('btn-limpar-padrao').addEventListener('click', function() {
                if (confirm('Tem certeza que deseja limpar a configura√ß√£o padr√£o do dia?')) {
                    configDia.veiculoPadrao = '';
                    configDia.motoristaPadrao = '';
                    
                    document.getElementById('veiculo-padrao-dia').value = '';
                    document.getElementById('motorista-padrao-dia').value = '';
                    
                    salvarDados();
                    alert('‚úÖ Configura√ß√£o padr√£o limpa com sucesso!');
                }
            });
            
            // Event listeners para a√ß√µes r√°pidas
            document.getElementById('btn-nova-venda-rapida').addEventListener('click', function() {
                abrirModalVendaRapida();
            });
            
            document.getElementById('btn-adicionar-pagamento-rapido').addEventListener('click', function() {
                // Mudar para aba de cobran√ßa e abrir modal
                document.getElementById('btn-cobranca').click();
                setTimeout(() => {
                    document.getElementById('btn-adicionar-pagamento').click();
                }, 100);
            });
            
            document.getElementById('btn-adicionar-credito-rapido').addEventListener('click', function() {
                // Mudar para aba de estoque
                document.getElementById('btn-estoque').click();
            });
            
            document.getElementById('btn-via-cliente-rapida').addEventListener('click', function() {
                // Mudar para aba de relat√≥rios
                document.getElementById('btn-relatorios').click();
                setTimeout(() => {
                    document.getElementById('tipo-relatorio').value = 'vendas';
                }, 100);
            });
            
            // Event listener para sele√ß√£o de material no estoque
            document.addEventListener('change', function(e) {
                if (e.target && e.target.id === 'select-material-estoque') {
                    // Calcular saldo atual do estoque
                    let saldoEstoque = 0;
                    dadosEstoque.forEach(mov => {
                        saldoEstoque += mov.tipo === 'credito' ? mov.valor : -mov.valor;
                    });
                    calcularEstoqueMaterial(saldoEstoque);
                }
            });
            
            // Atualizar hora a cada segundo
            setInterval(atualizarDataHora, 1000);
            
            // Inicializar dashboard e selects
            atualizarDashboard();
            atualizarSelectsVenda();
            atualizarListaCobrancas();
            atualizarSelectsCobranca();
            atualizarResumoCobrancas();
            atualizarSelectsRelatorio();
            
            // Inicializar sistema de alertas
            setTimeout(() => {
                carregarConfigAlertas();
            }, 2000); // Aguardar 2 segundos para carregar dados
            
            // ===== FUN√á√ïES DO MODAL DE VENDA R√ÅPIDA =====
            
            function abrirModalVendaRapida() {
                const modal = document.getElementById('modal-venda-rapida');
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // Atualizar selects do modal
                atualizarSelectsModalVenda();
                
                // Pr√©-preencher com configura√ß√µes padr√£o
                if (configDia.veiculoPadrao) {
                    setTimeout(() => {
                        document.getElementById('veiculo-venda-modal').value = configDia.veiculoPadrao;
                        atualizarInfoMotoristaModal();
                    }, 100);
                }
                
                // Focar no primeiro campo
                setTimeout(() => {
                    document.getElementById('material-venda-modal').focus();
                }, 200);
            }
            
            function fecharModalVendaRapida() {
                const modal = document.getElementById('modal-venda-rapida');
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                // Limpar formul√°rio
                document.getElementById('form-venda-rapida').reset();
                limparPreviewsModal();
            }
            
            function atualizarSelectsModalVenda() {
                // Atualizar select de materiais
                const selectMaterial = document.getElementById('material-venda-modal');
                selectMaterial.innerHTML = '<option value="">Selecione o material</option>';
                dadosMinerios.filter(m => m.status === 'ativo').forEach(minerio => {
                    selectMaterial.innerHTML += `<option value="${minerio.nome}" data-preco="${minerio.precoTonelada}" data-densidade="${minerio.densidade}" data-categoria="${minerio.categoria}">${minerio.nome} - ${minerio.categoria}</option>`;
                });
                
                // Atualizar select de clientes
                const selectCliente = document.getElementById('cliente-venda-modal');
                selectCliente.innerHTML = '<option value="">Selecione o cliente</option>';
                dadosClientes.filter(c => c.status === 'ativo').forEach(cliente => {
                    selectCliente.innerHTML += `<option value="${cliente.nome}" data-endereco="${cliente.endereco}" data-telefone="${cliente.telefone}">${cliente.nome}</option>`;
                });
                
                // Atualizar select de ve√≠culos
                const selectVeiculo = document.getElementById('veiculo-venda-modal');
                selectVeiculo.innerHTML = '<option value="">Selecione o ve√≠culo</option>';
                dadosVeiculos.filter(v => v.status === 'ativo').forEach(veiculo => {
                    const motorista = veiculo.motorista || 'Sem motorista';
                    const isSelected = configDia.veiculoPadrao === veiculo.placa ? 'selected' : '';
                    selectVeiculo.innerHTML += `<option value="${veiculo.placa}" data-motorista="${veiculo.motorista || ''}" data-modelo="${veiculo.modelo}" ${isSelected}>${veiculo.placa} - ${veiculo.modelo}</option>`;
                });
            }
            
            function atualizarInfoMaterialModal() {
                const select = document.getElementById('material-venda-modal');
                const infoDiv = document.getElementById('info-material-modal');
                
                if (select.value) {
                    const option = select.options[select.selectedIndex];
                    const preco = parseFloat(option.dataset.preco);
                    const densidade = parseFloat(option.dataset.densidade);
                    const categoria = option.dataset.categoria;
                    
                    infoDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span>üì¶ ${categoria}</span>
                            <span>üí∞ R$ ${preco.toFixed(2)}/t</span>
                        </div>
                        ${densidade ? `<div class="text-xs">‚öñÔ∏è Densidade: ${densidade.toFixed(1)} t/m¬≥</div>` : ''}
                    `;
                    infoDiv.classList.remove('hidden');
                } else {
                    infoDiv.classList.add('hidden');
                }
                
                atualizarCalculosModal();
            }
            
            function atualizarInfoClienteModal() {
                const select = document.getElementById('cliente-venda-modal');
                const infoDiv = document.getElementById('info-cliente-modal');
                
                if (select.value) {
                    const option = select.options[select.selectedIndex];
                    const endereco = option.dataset.endereco;
                    const telefone = option.dataset.telefone;
                    
                    infoDiv.innerHTML = `
                        <div class="text-xs space-y-1">
                            <div>üìç ${endereco}</div>
                            <div>üìû ${telefone}</div>
                        </div>
                    `;
                    infoDiv.classList.remove('hidden');
                } else {
                    infoDiv.classList.add('hidden');
                }
                
                atualizarCalculosModal();
            }
            
            function atualizarInfoMotoristaModal() {
                const select = document.getElementById('veiculo-venda-modal');
                const infoDiv = document.getElementById('info-motorista-modal');
                
                if (select.value) {
                    const option = select.options[select.selectedIndex];
                    const motorista = option.dataset.motorista;
                    const modelo = option.dataset.modelo;
                    
                    if (motorista) {
                        infoDiv.innerHTML = `
                            <div class="text-center">
                                <div class="text-sm font-medium text-gray-800">üë®‚Äçüíº ${motorista}</div>
                                <div class="text-xs text-gray-600">${modelo}</div>
                            </div>
                        `;
                        infoDiv.className = 'flex items-center justify-center bg-green-100 p-3 rounded-lg border-2 border-green-300';
                    } else {
                        infoDiv.innerHTML = '<span class="text-red-500 text-sm">‚ö†Ô∏è Ve√≠culo sem motorista</span>';
                        infoDiv.className = 'flex items-center justify-center bg-red-100 p-3 rounded-lg border-2 border-red-300';
                    }
                } else {
                    infoDiv.innerHTML = '<span class="text-gray-500 text-sm">üë®‚Äçüíº Motorista ser√° selecionado automaticamente</span>';
                    infoDiv.className = 'flex items-center justify-center bg-gray-100 p-3 rounded-lg border-2 border-gray-300';
                }
            }
            
            function atualizarCalculosModal() {
                const materialNome = document.getElementById('material-venda-modal').value;
                const clienteNome = document.getElementById('cliente-venda-modal').value;
                const pesoPedreira = parseFloat(document.getElementById('peso-pedreira-modal').value) || 0;
                const pesoCliente = parseFloat(document.getElementById('peso-cliente-modal').value) || 0;
                
                // Encontrar o material selecionado
                const materialSelecionado = dadosMinerios.find(m => m.nome === materialNome);
                
                if (materialSelecionado) {
                    // Calcular volumes baseados na densidade
                    if (materialSelecionado.densidade && materialSelecionado.densidade > 0) {
                        const volumePedreira = pesoPedreira / materialSelecionado.densidade;
                        const volumeCliente = pesoCliente / materialSelecionado.densidade;
                        
                        document.getElementById('volume-pedreira-modal').textContent = volumePedreira.toFixed(1) + ' m¬≥';
                        document.getElementById('volume-cliente-modal').textContent = volumeCliente.toFixed(1) + ' m¬≥';
                    } else {
                        document.getElementById('volume-pedreira-modal').textContent = '- m¬≥';
                        document.getElementById('volume-cliente-modal').textContent = '- m¬≥';
                    }
                    
                    // Calcular custos
                    const custoPorTonelada = materialSelecionado.precoTonelada;
                    const custoTotal = pesoPedreira * custoPorTonelada;
                    document.getElementById('custo-total-modal').textContent = custoTotal.toFixed(2);
                    
                    // Determinar pre√ßo para o cliente
                    let precoClienteTonelada = materialSelecionado.precoTonelada;
                    let usoPrecoEspecifico = false;
                    
                    if (clienteNome && materialNome) {
                        const precoEspecificoTon = dadosPrecos.find(p => 
                            p.cliente === clienteNome && 
                            p.material === materialNome && 
                            p.tipo === 'tonelada'
                        );
                        
                        const precoEspecificoM3 = dadosPrecos.find(p => 
                            p.cliente === clienteNome && 
                            p.material === materialNome && 
                            p.tipo === 'metro'
                        );
                        
                        if (precoEspecificoTon) {
                            precoClienteTonelada = precoEspecificoTon.preco;
                            usoPrecoEspecifico = true;
                            document.getElementById('indicador-preco-modal').textContent = '‚úÖ Espec√≠fico';
                            document.getElementById('indicador-preco-modal').classList.remove('hidden');
                        } else if (precoEspecificoM3 && materialSelecionado.densidade > 0) {
                            precoClienteTonelada = precoEspecificoM3.preco / materialSelecionado.densidade;
                            usoPrecoEspecifico = true;
                            document.getElementById('indicador-preco-modal').textContent = 'üîÑ Convertido';
                            document.getElementById('indicador-preco-modal').classList.remove('hidden');
                        } else {
                            document.getElementById('indicador-preco-modal').classList.add('hidden');
                        }
                    }
                    
                    document.getElementById('preco-tonelada-modal').textContent = precoClienteTonelada.toFixed(2);
                    
                    // Calcular valor total da venda
                    const valorTotal = pesoCliente * precoClienteTonelada;
                    document.getElementById('valor-total-modal').textContent = valorTotal.toFixed(2);
                    
                    // Atualizar preview
                    document.getElementById('preview-valor-modal').textContent = valorTotal.toFixed(2);
                    document.getElementById('preview-custo-modal').textContent = custoTotal.toFixed(2);
                    
                    const lucro = valorTotal - custoTotal;
                    document.getElementById('preview-lucro-modal').textContent = lucro.toFixed(2);
                    
                    // Atualizar cor do lucro
                    const lucroContainer = document.getElementById('preview-lucro-container');
                    if (lucro > 0) {
                        lucroContainer.className = 'text-2xl font-bold text-green-600';
                    } else if (lucro < 0) {
                        lucroContainer.className = 'text-2xl font-bold text-red-600';
                    } else {
                        lucroContainer.className = 'text-2xl font-bold text-gray-600';
                    }
                    
                } else {
                    limparPreviewsModal();
                }
            }
            
            function limparPreviewsModal() {
                document.getElementById('volume-pedreira-modal').textContent = '0,0 m¬≥';
                document.getElementById('volume-cliente-modal').textContent = '0,0 m¬≥';
                document.getElementById('custo-total-modal').textContent = '0,00';
                document.getElementById('preco-tonelada-modal').textContent = '0,00';
                document.getElementById('valor-total-modal').textContent = '0,00';
                document.getElementById('preview-valor-modal').textContent = '0,00';
                document.getElementById('preview-custo-modal').textContent = '0,00';
                document.getElementById('preview-lucro-modal').textContent = '0,00';
                document.getElementById('indicador-preco-modal').classList.add('hidden');
            }
            
            // Event listeners do modal de venda r√°pida
            document.getElementById('fechar-modal-venda').addEventListener('click', fecharModalVendaRapida);
            document.getElementById('cancelar-venda-modal').addEventListener('click', fecharModalVendaRapida);
            
            // Event listeners para atualizar informa√ß√µes
            document.getElementById('material-venda-modal').addEventListener('change', atualizarInfoMaterialModal);
            document.getElementById('cliente-venda-modal').addEventListener('change', atualizarInfoClienteModal);
            document.getElementById('veiculo-venda-modal').addEventListener('change', atualizarInfoMotoristaModal);
            
            // Event listeners para c√°lculos em tempo real
            document.getElementById('peso-pedreira-modal').addEventListener('input', atualizarCalculosModal);
            document.getElementById('peso-cliente-modal').addEventListener('input', atualizarCalculosModal);
            
            // Event listeners para forma de pagamento
            document.querySelectorAll('input[name="tipo-pagamento-modal"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const campoPrazo = document.getElementById('campo-prazo-modal');
                    if (this.value === 'prazo') {
                        campoPrazo.classList.remove('hidden');
                    } else {
                        campoPrazo.classList.add('hidden');
                    }
                });
            });
            
            // Event listener para fechar modal clicando fora
            document.getElementById('modal-venda-rapida').addEventListener('click', function(e) {
                if (e.target === this) {
                    fecharModalVendaRapida();
                }
            });
            
            // Event listener para tecla ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !document.getElementById('modal-venda-rapida').classList.contains('hidden')) {
                    fecharModalVendaRapida();
                }
            });
            
            // Formul√°rio de venda r√°pida
            document.getElementById('form-venda-rapida').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const materialNome = document.getElementById('material-venda-modal').value;
                const clienteNome = document.getElementById('cliente-venda-modal').value;
                const veiculoPlaca = document.getElementById('veiculo-venda-modal').value;
                const pesoPedreira = parseFloat(document.getElementById('peso-pedreira-modal').value) || 0;
                const pesoCliente = parseFloat(document.getElementById('peso-cliente-modal').value) || 0;
                const tipoPagamento = document.querySelector('input[name="tipo-pagamento-modal"]:checked')?.value;
                const observacoes = document.getElementById('observacoes-venda-modal').value;
                
                if (!materialNome || !clienteNome || !veiculoPlaca || !pesoPedreira || !pesoCliente || !tipoPagamento) {
                    alert('‚ö†Ô∏è Por favor, preencha todos os campos obrigat√≥rios.');
                    return;
                }
                
                // Encontrar o material selecionado
                const materialSelecionado = dadosMinerios.find(m => m.nome === materialNome);
                if (!materialSelecionado) {
                    alert('‚ö†Ô∏è Material n√£o encontrado!');
                    return;
                }
                
                // Encontrar o ve√≠culo e motorista
                const veiculoSelecionado = dadosVeiculos.find(v => v.placa === veiculoPlaca);
                const motoristaNome = veiculoSelecionado ? veiculoSelecionado.motorista : '-';
                
                // Calcular pre√ßos
                let precoClienteTonelada = materialSelecionado.precoTonelada;
                
                const precoEspecificoTon = dadosPrecos.find(p => 
                    p.cliente === clienteNome && 
                    p.material === materialNome && 
                    p.tipo === 'tonelada'
                );
                
                const precoEspecificoM3 = dadosPrecos.find(p => 
                    p.cliente === clienteNome && 
                    p.material === materialNome && 
                    p.tipo === 'metro'
                );
                
                if (precoEspecificoTon) {
                    precoClienteTonelada = precoEspecificoTon.preco;
                } else if (precoEspecificoM3 && materialSelecionado.densidade > 0) {
                    precoClienteTonelada = precoEspecificoM3.preco / materialSelecionado.densidade;
                }
                
                const custoPorTonelada = materialSelecionado.precoTonelada;
                const custoTotal = pesoPedreira * custoPorTonelada;
                const valorVenda = pesoCliente * precoClienteTonelada;
                const lucro = valorVenda - custoTotal;
                
                // Determinar status de pagamento
                let statusPagamento = 'aberto';
                let valorPago = 0;
                let saldo = valorVenda;
                let prazoDias = 0;
                
                if (tipoPagamento === 'pix' || tipoPagamento === 'dinheiro' || tipoPagamento === 'cheque') {
                    statusPagamento = 'pago';
                    valorPago = valorVenda;
                    saldo = 0;
                } else if (tipoPagamento === 'prazo') {
                    prazoDias = parseInt(document.getElementById('prazo-dias-modal').value) || 30;
                }
                
                const novaVenda = {
                    id: Date.now(),
                    material: materialNome,
                    cliente: clienteNome,
                    veiculo: veiculoPlaca,
                    motorista: motoristaNome,
                    pesoPedreira: pesoPedreira,
                    pesoCliente: pesoCliente,
                    valorTotal: valorVenda,
                    valorPago: valorPago,
                    saldo: saldo,
                    custoTotal: custoTotal,
                    lucro: lucro,
                    precoTonelada: precoClienteTonelada,
                    tipoPagamento: tipoPagamento,
                    prazoDias: prazoDias,
                    observacoes: observacoes,
                    dataVenda: new Date().toISOString(),
                    statusPagamento: statusPagamento
                };
                
                dadosVendas.push(novaVenda);
                
                // Registrar movimenta√ß√µes no estoque
                if (statusPagamento === 'pago') {
                    const pagamento = {
                        id: Date.now() + 1,
                        cliente: clienteNome,
                        valorPago: valorVenda,
                        valorAplicado: valorVenda,
                        valorResidual: 0,
                        formaPagamento: tipoPagamento,
                        data: new Date().toISOString(),
                        observacoes: 'Pagamento √† vista da venda r√°pida',
                        vendasAfetadas: [novaVenda.id]
                    };
                    dadosPagamentos.push(pagamento);
                    
                    const movimentacaoEstoque = {
                        id: Date.now() + 2,
                        tipo: 'credito',
                        valor: valorVenda,
                        descricao: `Venda r√°pida para ${clienteNome} - ${materialNome}`,
                        observacoes: `Pagamento √† vista - ${tipoPagamento}`,
                        data: new Date().toISOString()
                    };
                    dadosEstoque.push(movimentacaoEstoque);
                }
                
                const movimentacaoCusto = {
                    id: Date.now() + 3,
                    tipo: 'debito',
                    valor: custoTotal,
                    descricao: `Custo de material - ${materialNome}`,
                    observacoes: `Custo da venda r√°pida para ${clienteNome} - ${pesoPedreira}t`,
                    data: new Date().toISOString()
                };
                dadosEstoque.push(movimentacaoCusto);
                
                salvarDados();
                atualizarDashboard();
                atualizarListaVendas();
                atualizarListaCobrancas();
                atualizarSelectsCobranca();
                atualizarResumoCobrancas();
                atualizarListaMovimentacoes();
                
                fecharModalVendaRapida();
                
                // Mostrar confirma√ß√£o com detalhes
                alert(`‚úÖ Venda registrada com sucesso!\n\nüìã Resumo:\n‚Ä¢ Cliente: ${clienteNome}\n‚Ä¢ Material: ${materialNome}\n‚Ä¢ Peso: ${pesoCliente}t\n‚Ä¢ Valor: R$ ${valorVenda.toFixed(2)}\n‚Ä¢ Lucro: R$ ${lucro.toFixed(2)}\n‚Ä¢ Pagamento: ${statusPagamento === 'pago' ? '√Ä vista' : 'A prazo'}`);
                
                // Animar bot√£o de sucesso
                const botaoOriginal = document.getElementById('btn-nova-venda-rapida');
                botaoOriginal.innerHTML = `
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-lg">‚úÖ</span>
                        <div>
                            <div class="font-bold">Venda Registrada!</div>
                            <div class="text-xs opacity-90">Sucesso</div>
                        </div>
                    </div>
                `;
                botaoOriginal.className = 'w-full bg-green-600 text-white p-3 rounded-lg font-medium hover:bg-green-700 transition-colors transform hover:scale-105 animate-pulse-custom';
                
                setTimeout(() => {
                    botaoOriginal.innerHTML = `
                        <div class="flex items-center justify-center gap-2">
                            <span class="text-lg">üí∞</span>
                            <div>
                                <div class="font-bold">Nova Venda</div>
                                <div class="text-xs opacity-90">Registro r√°pido</div>
                            </div>
                        </div>
                    `;
                    botaoOriginal.className = 'w-full bg-empresa-verde text-white p-3 rounded-lg font-medium hover:bg-empresa-verde-dark transition-colors transform hover:scale-105';
                }, 3000);
            });
            
            // ===== SISTEMA DE ALERTAS =====
            
            let intervalAlertas = null;
            
            // Fun√ß√£o para carregar configura√ß√µes de alertas
            function carregarConfigAlertas() {
                const configSalva = localStorage.getItem('configAlertas');
                if (configSalva) {
                    configAlertas = {...configAlertas, ...JSON.parse(configSalva)};
                }
                
                // Atualizar interface das configura√ß√µes
                document.getElementById('popup-estoque-baixo').checked = configAlertas.popupEstoqueBaixo;
                document.getElementById('popup-cnh-vencimento').checked = configAlertas.popupCnhVencimento;
                document.getElementById('popup-toxicologico-vencimento').checked = configAlertas.popupToxicologicoVencimento;
                document.getElementById('popup-vendas-atraso').checked = configAlertas.popupVendasAtraso;
                document.getElementById('popup-vendas-vencendo').checked = configAlertas.popupVendasVencendo;
                document.getElementById('frequencia-alertas').value = configAlertas.frequencia;
                document.getElementById('timeout-alertas').value = configAlertas.timeout;
                
                // Iniciar sistema de verifica√ß√£o de alertas
                iniciarSistemaAlertas();
            }
            
            // Fun√ß√£o para iniciar o sistema de alertas
            function iniciarSistemaAlertas() {
                // Limpar intervalo anterior se existir
                if (intervalAlertas) {
                    clearInterval(intervalAlertas);
                }
                
                // Verificar alertas imediatamente
                verificarTodosAlertas();
                
                // Configurar intervalo de verifica√ß√£o
                intervalAlertas = setInterval(verificarTodosAlertas, configAlertas.frequencia);
            }
            
            // Fun√ß√£o para verificar todos os alertas
            function verificarTodosAlertas() {
                const agora = Date.now();
                
                // Verificar estoque baixo
                if (configAlertas.popupEstoqueBaixo) {
                    const chaveAlerta = 'estoque-baixo';
                    const ultimoAlerta = configAlertas.ultimosAlertas[chaveAlerta] || 0;
                    
                    if (agora - ultimoAlerta > configAlertas.timeout) {
                        let saldoEstoque = 0;
                        dadosEstoque.forEach(mov => {
                            saldoEstoque += mov.tipo === 'credito' ? mov.valor : -mov.valor;
                        });
                        
                        if (saldoEstoque < configEstoque.minimo) {
                            mostrarAlerta({
                                tipo: 'warning',
                                titulo: 'Estoque Baixo',
                                subtitulo: 'Aten√ß√£o necess√°ria',
                                icone: '‚ö†Ô∏è',
                                conteudo: `
                                    <div class="text-center mb-4">
                                        <div class="text-lg mb-2">üí∞ <strong>Saldo atual: R$ ${saldoEstoque.toFixed(2)}</strong></div>
                                        <div class="text-sm text-gray-600">Limite m√≠nimo: R$ ${configEstoque.minimo.toFixed(2)}</div>
                                    </div>
                                    <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                                        <p class="text-sm text-yellow-800">
                                            <strong>üìã Recomenda√ß√£o:</strong> Adicione cr√©dito ao estoque para manter as opera√ß√µes.
                                        </p>
                                    </div>
                                `,
                                acaoPrincipal: () => {
                                    fecharAlerta();
                                    document.getElementById('btn-estoque').click();
                                },
                                chaveAlerta: chaveAlerta
                            });
                        }
                    }
                }
                
                // Verificar vencimento de CNH
                if (configAlertas.popupCnhVencimento) {
                    const chaveAlerta = 'cnh-vencimento';
                    const ultimoAlerta = configAlertas.ultimosAlertas[chaveAlerta] || 0;
                    
                    if (agora - ultimoAlerta > configAlertas.timeout) {
                        const cnhsVencendo = dadosMotoristas.filter(m => {
                            if (m.vencimentoCnh && m.status === 'ativo') {
                                const vencimento = new Date(m.vencimentoCnh);
                                const hoje = new Date();
                                const diasParaVencer = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                                return diasParaVencer <= 30 && diasParaVencer > 0;
                            }
                            return false;
                        });
                        
                        if (cnhsVencendo.length > 0) {
                            mostrarAlerta({
                                tipo: 'danger',
                                titulo: 'CNH Vencendo',
                                subtitulo: `${cnhsVencendo.length} motorista(s) com CNH vencendo`,
                                icone: 'üìã',
                                conteudo: `
                                    <div class="mb-4">
                                        <p class="text-sm text-gray-700 mb-3">Os seguintes motoristas t√™m CNH vencendo em at√© 30 dias:</p>
                                        <div class="space-y-2">
                                            ${cnhsVencendo.map(motorista => {
                                                const vencimento = new Date(motorista.vencimentoCnh);
                                                const hoje = new Date();
                                                const dias = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                                                return `
                                                    <div class="bg-red-50 p-2 rounded border border-red-200">
                                                        <div class="font-medium text-red-800">${motorista.nome}</div>
                                                        <div class="text-xs text-red-600">Vence em ${dias} dia(s) - ${vencimento.toLocaleDateString()}</div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `,
                                acaoPrincipal: () => {
                                    fecharAlerta();
                                    document.getElementById('btn-motoristas').click();
                                },
                                chaveAlerta: chaveAlerta
                            });
                        }
                    }
                }
                
                // Verificar vencimento de toxicol√≥gico
                if (configAlertas.popupToxicologicoVencimento) {
                    const chaveAlerta = 'toxicologico-vencimento';
                    const ultimoAlerta = configAlertas.ultimosAlertas[chaveAlerta] || 0;
                    
                    if (agora - ultimoAlerta > configAlertas.timeout) {
                        const toxicologicosVencendo = dadosMotoristas.filter(m => {
                            if (m.vencimentoToxicologico && m.status === 'ativo') {
                                const vencimento = new Date(m.vencimentoToxicologico);
                                const hoje = new Date();
                                const diasParaVencer = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                                return diasParaVencer <= 30 && diasParaVencer > 0;
                            }
                            return false;
                        });
                        
                        if (toxicologicosVencendo.length > 0) {
                            mostrarAlerta({
                                tipo: 'warning',
                                titulo: 'Toxicol√≥gico Vencendo',
                                subtitulo: `${toxicologicosVencendo.length} motorista(s) com exame vencendo`,
                                icone: 'üß™',
                                conteudo: `
                                    <div class="mb-4">
                                        <p class="text-sm text-gray-700 mb-3">Os seguintes motoristas t√™m exame toxicol√≥gico vencendo em at√© 30 dias:</p>
                                        <div class="space-y-2">
                                            ${toxicologicosVencendo.map(motorista => {
                                                const vencimento = new Date(motorista.vencimentoToxicologico);
                                                const hoje = new Date();
                                                const dias = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                                                return `
                                                    <div class="bg-yellow-50 p-2 rounded border border-yellow-200">
                                                        <div class="font-medium text-yellow-800">${motorista.nome}</div>
                                                        <div class="text-xs text-yellow-600">Vence em ${dias} dia(s) - ${vencimento.toLocaleDateString()}</div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `,
                                acaoPrincipal: () => {
                                    fecharAlerta();
                                    document.getElementById('btn-motoristas').click();
                                },
                                chaveAlerta: chaveAlerta
                            });
                        }
                    }
                }
                
                // Verificar vendas em atraso
                if (configAlertas.popupVendasAtraso) {
                    const chaveAlerta = 'vendas-atraso';
                    const ultimoAlerta = configAlertas.ultimosAlertas[chaveAlerta] || 0;
                    
                    if (agora - ultimoAlerta > configAlertas.timeout) {
                        const vendasEmAtraso = dadosVendas.filter(v => {
                            if (v.saldo > 0 && v.prazoDias > 0) {
                                const dataVencimento = new Date(v.dataVenda);
                                dataVencimento.setDate(dataVencimento.getDate() + v.prazoDias);
                                return dataVencimento < new Date();
                            }
                            return false;
                        });
                        
                        if (vendasEmAtraso.length > 0) {
                            const valorTotal = vendasEmAtraso.reduce((sum, v) => sum + v.saldo, 0);
                            
                            mostrarAlerta({
                                tipo: 'danger',
                                titulo: 'Vendas em Atraso',
                                subtitulo: `${vendasEmAtraso.length} venda(s) com pagamento atrasado`,
                                icone: 'üí∞',
                                conteudo: `
                                    <div class="mb-4">
                                        <div class="text-center mb-3">
                                            <div class="text-lg font-bold text-red-600">R$ ${valorTotal.toFixed(2)}</div>
                                            <div class="text-sm text-gray-600">Total em atraso</div>
                                        </div>
                                        <div class="max-h-40 overflow-y-auto space-y-2">
                                            ${vendasEmAtraso.map(venda => {
                                                const dataVencimento = new Date(venda.dataVenda);
                                                dataVencimento.setDate(dataVencimento.getDate() + venda.prazoDias);
                                                const diasAtraso = Math.ceil((new Date() - dataVencimento) / (1000 * 60 * 60 * 24));
                                                return `
                                                    <div class="bg-red-50 p-2 rounded border border-red-200">
                                                        <div class="font-medium text-red-800">${venda.cliente}</div>
                                                        <div class="text-xs text-red-600">
                                                            R$ ${venda.saldo.toFixed(2)} ‚Ä¢ ${diasAtraso} dia(s) em atraso
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `,
                                acaoPrincipal: () => {
                                    fecharAlerta();
                                    document.getElementById('btn-cobranca').click();
                                },
                                chaveAlerta: chaveAlerta
                            });
                        }
                    }
                }
                
                // Verificar vendas vencendo em 3 dias
                if (configAlertas.popupVendasVencendo) {
                    const chaveAlerta = 'vendas-vencendo';
                    const ultimoAlerta = configAlertas.ultimosAlertas[chaveAlerta] || 0;
                    
                    if (agora - ultimoAlerta > configAlertas.timeout) {
                        const vendasVencendo = dadosVendas.filter(v => {
                            if (v.saldo > 0 && v.prazoDias > 0) {
                                const dataVencimento = new Date(v.dataVenda);
                                dataVencimento.setDate(dataVencimento.getDate() + v.prazoDias);
                                const hoje = new Date();
                                const diasParaVencer = Math.ceil((dataVencimento - hoje) / (1000 * 60 * 60 * 24));
                                return diasParaVencer <= 3 && diasParaVencer >= 0;
                            }
                            return false;
                        });
                        
                        if (vendasVencendo.length > 0) {
                            const valorTotal = vendasVencendo.reduce((sum, v) => sum + v.saldo, 0);
                            
                            mostrarAlerta({
                                tipo: 'warning',
                                titulo: 'Vendas Vencendo',
                                subtitulo: `${vendasVencendo.length} venda(s) vencendo em at√© 3 dias`,
                                icone: '‚è∞',
                                conteudo: `
                                    <div class="mb-4">
                                        <div class="text-center mb-3">
                                            <div class="text-lg font-bold text-yellow-600">R$ ${valorTotal.toFixed(2)}</div>
                                            <div class="text-sm text-gray-600">Total vencendo</div>
                                        </div>
                                        <div class="max-h-40 overflow-y-auto space-y-2">
                                            ${vendasVencendo.map(venda => {
                                                const dataVencimento = new Date(venda.dataVenda);
                                                dataVencimento.setDate(dataVencimento.getDate() + venda.prazoDias);
                                                const diasParaVencer = Math.ceil((dataVencimento - new Date()) / (1000 * 60 * 60 * 24));
                                                return `
                                                    <div class="bg-yellow-50 p-2 rounded border border-yellow-200">
                                                        <div class="font-medium text-yellow-800">${venda.cliente}</div>
                                                        <div class="text-xs text-yellow-600">
                                                            R$ ${venda.saldo.toFixed(2)} ‚Ä¢ Vence em ${diasParaVencer} dia(s)
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `,
                                acaoPrincipal: () => {
                                    fecharAlerta();
                                    document.getElementById('btn-cobranca').click();
                                },
                                chaveAlerta: chaveAlerta
                            });
                        }
                    }
                }
            }
            
            // Fun√ß√£o para mostrar alerta popup
            function mostrarAlerta({tipo, titulo, subtitulo, icone, conteudo, acaoPrincipal, chaveAlerta}) {
                const modal = document.getElementById('modal-alerta');
                const header = document.getElementById('alerta-header');
                const iconeElement = document.getElementById('alerta-icone');
                const tituloElement = document.getElementById('alerta-titulo');
                const subtituloElement = document.getElementById('alerta-subtitulo');
                const conteudoElement = document.getElementById('alerta-conteudo');
                const botaoAcao = document.getElementById('alerta-acao-principal');
                
                // Configurar cores baseado no tipo
                const cores = {
                    warning: 'bg-gradient-to-r from-yellow-500 to-orange-500',
                    danger: 'bg-gradient-to-r from-red-500 to-red-600',
                    info: 'bg-gradient-to-r from-blue-500 to-blue-600',
                    success: 'bg-gradient-to-r from-green-500 to-green-600'
                };
                
                header.className = `${cores[tipo]} p-4 rounded-t-2xl`;
                iconeElement.textContent = icone;
                tituloElement.textContent = titulo;
                subtituloElement.textContent = subtitulo;
                conteudoElement.innerHTML = conteudo;
                
                // Configurar a√ß√£o principal
                botaoAcao.onclick = () => {
                    if (acaoPrincipal) acaoPrincipal();
                    marcarAlertaComoVisto(chaveAlerta);
                };
                
                // Configurar bot√£o "N√£o mostrar mais"
                document.getElementById('alerta-nao-mostrar').setAttribute('data-chave-atual', chaveAlerta);
                
                // Mostrar modal
                modal.classList.remove('hidden');
                
                // Adicionar anima√ß√£o de rota√ß√£o para todos os alertas
                const alertaContainer = modal.querySelector('.bg-white');
                
                // Remover classes anteriores
                alertaContainer.classList.remove('animate-bounce', 'alerta-criticidade-alta', 'alerta-girada-entrada');
                
                if (tipo === 'danger') {
                    // Alertas cr√≠ticos: rota√ß√£o com efeitos especiais
                    alertaContainer.classList.add('alerta-criticidade-alta');
                    
                    // Remover a classe ap√≥s 1 segundo para parar a anima√ß√£o
                    setTimeout(() => {
                        alertaContainer.classList.remove('alerta-criticidade-alta');
                    }, 1000);
                } else {
                    // Alertas normais: rota√ß√£o simples
                    alertaContainer.classList.add('alerta-girada-entrada');
                    
                    // Remover a classe ap√≥s 1 segundo para parar a anima√ß√£o
                    setTimeout(() => {
                        alertaContainer.classList.remove('alerta-girada-entrada');
                    }, 1000);
                }
                
                // Som de alerta (se suportado pelo browser)
                try {
                    if (tipo === 'danger') {
                        // Som mais urgente para alertas cr√≠ticos
                        const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMeBTGI1Ovmg0EMA3HL7uSQPwkUYLBl5qRLEAlPo+L3tGUcBj2a2+/CQKowAAAABWAaAGQKAABQRGZJIEXCbgB/U5hLSAIDBKNOZgAAoXVfmG9QLH9vdVrqRf75UQg=');
                        audio.volume = 0.3;
                        audio.play().catch(() => {});
                    }
                } catch (e) {
                    // Ignorar erro de √°udio
                }
                
                // Auto-fechar ap√≥s 30 segundos para alertas warning e info
                if (tipo === 'warning' || tipo === 'info') {
                    setTimeout(() => {
                        if (!modal.classList.contains('hidden')) {
                            fecharAlerta();
                            marcarAlertaComoVisto(chaveAlerta);
                        }
                    }, 30000);
                }
            }
            
            // Fun√ß√£o para mostrar toast de notifica√ß√£o
            function mostrarToast(tipo, titulo, mensagem, duracao = 5000) {
                const container = document.getElementById('toast-container');
                const toastId = 'toast-' + Date.now();
                
                const toast = document.createElement('div');
                toast.id = toastId;
                toast.className = `toast toast-${tipo} text-white p-4 rounded-lg shadow-lg border-l-4`;
                
                toast.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 text-xl">
                            ${tipo === 'success' ? '‚úÖ' : tipo === 'danger' ? 'üö®' : tipo === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                        </div>
                        <div class="flex-1">
                            <div class="font-bold">${titulo}</div>
                            <div class="text-sm opacity-90">${mensagem}</div>
                        </div>
                        <button onclick="removerToast('${toastId}')" class="flex-shrink-0 text-white/80 hover:text-white">
                            &times;
                        </button>
                    </div>
                `;
                
                container.appendChild(toast);
                
                // Auto-remover ap√≥s a dura√ß√£o especificada
                setTimeout(() => {
                    removerToast(toastId);
                }, duracao);
            }
            
            // Fun√ß√£o para remover toast
            function removerToast(toastId) {
                const toast = document.getElementById(toastId);
                if (toast) {
                    toast.style.transform = 'translateX(100%)';
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }
            }
            
            // Fun√ß√£o para fechar alerta
            function fecharAlerta() {
                const modal = document.getElementById('modal-alerta');
                modal.classList.add('hidden');
            }
            
            // Fun√ß√£o para marcar alerta como visto
            function marcarAlertaComoVisto(chaveAlerta) {
                configAlertas.ultimosAlertas[chaveAlerta] = Date.now();
                salvarDados();
            }
            
            // Fun√ß√£o para desativar um tipo de alerta
            function desativarAlerta(chaveAlerta) {
                switch(chaveAlerta) {
                    case 'estoque-baixo':
                        configAlertas.popupEstoqueBaixo = false;
                        break;
                    case 'cnh-vencimento':
                        configAlertas.popupCnhVencimento = false;
                        break;
                    case 'toxicologico-vencimento':
                        configAlertas.popupToxicologicoVencimento = false;
                        break;
                    case 'vendas-atraso':
                        configAlertas.popupVendasAtraso = false;
                        break;
                    case 'vendas-vencendo':
                        configAlertas.popupVendasVencendo = false;
                        break;
                }
                salvarDados();
                carregarConfigAlertas();
                fecharAlerta();
                mostrarToast('info', 'Alerta Desativado', 'Este tipo de alerta foi desativado. Voc√™ pode reativ√°-lo nas configura√ß√µes.');
            }
            
            // Event listeners dos alertas
            document.getElementById('fechar-alerta').addEventListener('click', fecharAlerta);
            
            document.getElementById('alerta-nao-mostrar').addEventListener('click', function() {
                const chaveAlerta = this.getAttribute('data-chave-atual');
                if (chaveAlerta) {
                    desativarAlerta(chaveAlerta);
                }
            });
            
            // Event listeners das configura√ß√µes de alertas
            document.getElementById('btn-salvar-alertas').addEventListener('click', function() {
                configAlertas.popupEstoqueBaixo = document.getElementById('popup-estoque-baixo').checked;
                configAlertas.popupCnhVencimento = document.getElementById('popup-cnh-vencimento').checked;
                configAlertas.popupToxicologicoVencimento = document.getElementById('popup-toxicologico-vencimento').checked;
                configAlertas.popupVendasAtraso = document.getElementById('popup-vendas-atraso').checked;
                configAlertas.popupVendasVencendo = document.getElementById('popup-vendas-vencendo').checked;
                configAlertas.frequencia = parseInt(document.getElementById('frequencia-alertas').value);
                configAlertas.timeout = parseInt(document.getElementById('timeout-alertas').value);
                
                salvarDados();
                iniciarSistemaAlertas();
                
                mostrarToast('success', 'Configura√ß√µes Salvas', 'As configura√ß√µes de alertas foram atualizadas com sucesso.');
            });
            
            document.getElementById('btn-testar-alertas').addEventListener('click', function() {
                // Resetar √∫ltimos alertas para for√ßar exibi√ß√£o
                configAlertas.ultimosAlertas = {};
                verificarTodosAlertas();
                
                mostrarToast('info', 'Teste de Alertas', 'Verificando todos os alertas configurados...');
            });
            
            document.getElementById('btn-desativar-todos').addEventListener('click', function() {
                if (confirm('Tem certeza que deseja desativar todos os alertas popup?')) {
                    configAlertas.popupEstoqueBaixo = false;
                    configAlertas.popupCnhVencimento = false;
                    configAlertas.popupToxicologicoVencimento = false;
                    configAlertas.popupVendasAtraso = false;
                    configAlertas.popupVendasVencendo = false;
                    
                    salvarDados();
                    carregarConfigAlertas();
                    
                    if (intervalAlertas) {
                        clearInterval(intervalAlertas);
                    }
                    
                    mostrarToast('warning', 'Alertas Desativados', 'Todos os alertas popup foram desativados.');
                }
            });
            
            // Fun√ß√£o global para remover toast (dispon√≠vel no onclick)
            window.removerToast = removerToast;
            
            // Inicializar previs√£o de demanda
            atualizarSelectsPrevisao();
            
            console.log('üöõ Sistema Rei da Ca√ßambinha iniciado!');
        });
    </script>
</body>
</html>